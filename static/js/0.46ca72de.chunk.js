"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[0],{88396:function(e,t,r){r.d(t,{b:function(){return u},s:function(){return n},t:function(){return f}});var i=r(26277);function n(e,t,r){return e[0]=t,e[1]=r,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function u(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function l(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function h(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function c(e){var t=e[0],r=e[1];return t*t+r*r}function f(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}var v=h,p=a,d=s,y=o,_=u,m=l,g=c;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:n,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract:a,multiply:s,divide:o,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},scaleAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},distance:u,squaredDistance:l,length:h,squaredLength:c,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},lerp:function(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e},random:function(e,t){t=t||1;var r=2*(0,i.R)()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},transformMat2:function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},transformMat2d:f,transformMat3:function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},transformMat4:function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},rotate:function(e,t,r,i){var n=t[0]-r[0],a=t[1]-r[1],s=Math.sin(i),o=Math.cos(i);return e[0]=n*o-a*s+r[0],e[1]=n*s+a*o+r[1],e},angle:function(e,t){var r=e[0],i=e[1],n=t[0],a=t[1],s=r*r+i*i;s>0&&(s=1/Math.sqrt(s));var o=n*n+a*a;o>0&&(o=1/Math.sqrt(o));var u=(r*n+i*a)*s*o;return u>1?0:u<-1?Math.PI:Math.acos(u)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,t){var r=e[0],n=e[1],a=t[0],s=t[1];return Math.abs(r-a)<=i.E*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=i.E*Math.max(1,Math.abs(n),Math.abs(s))},projectAndScale:function(e,t,r,i,n){var a=t[0]-r[0],s=t[1]-r[1],o=(i[0]*a+i[1]*s)*(n-1);return a=i[0]*o,s=i[1]*o,e[0]=t[0]+a,e[1]=t[1]+s,e},len:v,sub:p,mul:d,div:y,dist:_,sqrDist:m,sqrLen:g})},71277:function(e,t,r){function i(e){return e=e||globalThis.location.hostname,l.some((function(t){var r;return null!=(null==(r=e)?void 0:r.match(t))}))}function n(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(a)||null!=t.match(o)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(s)||null!=t.match(u)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}r.d(t,{XO:function(){return i},pJ:function(){return n}});var a=/^devext.arcgis.com$/,s=/^qaext.arcgis.com$/,o=/^[\w-]*\.mapsdevext.arcgis.com$/,u=/^[\w-]*\.mapsqa.arcgis.com$/,l=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,s,/^jsapps.esri.com$/,o,u]},99201:function(e,t,r){r.d(t,{B1:function(){return i},DQ:function(){return l},DT:function(){return o},JJ:function(){return n},Or:function(){return h},_U:function(){return a},k3:function(){return c},sX:function(){return f}});var i=Number.POSITIVE_INFINITY,n=Math.PI,a=2*n,s=128/n,o=n/180,u=1/Math.LN2;function l(e,t){return(e%=t)>=0?e:e+t}function h(e){return l(e*s,256)}function c(e){return Math.log(e)*u}function f(e,t,r){return e*(1-r)+t*r}},60652:function(e,t,r){r.d(t,{E:function(){return s},V:function(){return i}});var i,n=r(15671),a=r(43144),s=function(){function e(t,r){(0,n.Z)(this,e),this.x=t,this.y=r}return(0,a.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e,t){return e===this.x&&t===this.y}},{key:"isEqual",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"setCoords",value:function(e,t){this.x=e,this.y=t}},{key:"normalize",value:function(){var e=this.x,t=this.y,r=Math.sqrt(e*e+t*t);this.x/=r,this.y/=r}},{key:"rightPerpendicular",value:function(){var e=this.x;this.x=this.y,this.y=-e}},{key:"move",value:function(e,t){this.x+=e,this.y+=t}},{key:"assign",value:function(e){this.x=e.x,this.y=e.y}},{key:"assignAdd",value:function(e,t){this.x=e.x+t.x,this.y=e.y+t.y}},{key:"assignSub",value:function(e,t){this.x=e.x-t.x,this.y=e.y-t.y}},{key:"rotate",value:function(e,t){var r=this.x,i=this.y;this.x=r*e-i*t,this.y=r*t+i*e}},{key:"scale",value:function(e){this.x*=e,this.y*=e}},{key:"length",value:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}}],[{key:"distance",value:function(e,t){var r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}},{key:"add",value:function(t,r){return new e(t.x+r.x,t.y+r.y)}},{key:"sub",value:function(t,r){return new e(t.x-r.x,t.y-r.y)}}]),e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(i||(i={}))},38999:function(e,t,r){var i,n;function a(e){switch(e){case"left":return i.Left;case"right":return i.Right;case"center":case"justify":return i.Center}}function s(e){switch(e){case"top":return n.Top;case"middle":return n.Center;case"baseline":return n.Baseline;case"bottom":return n.Bottom}}function o(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[i.Right,n.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[i.Center,n.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[i.Left,n.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[i.Right,n.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[i.Center,n.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[i.Left,n.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[i.Right,n.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[i.Center,n.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[i.Left,n.Top];default:return console.debug("Found invalid placement type ".concat(e)),[i.Center,n.Center]}}function u(e){switch(e){case i.Right:return-1;case i.Center:return 0;case i.Left:return 1;default:return console.debug("Found invalid horizontal alignment ".concat(e)),0}}function l(e){switch(e){case n.Top:return 1;case n.Center:return 0;case n.Bottom:case n.Baseline:return-1;default:return console.debug("Found invalid vertical alignment ".concat(e)),0}}function h(e){switch(e){case"left":return i.Left;case"right":return i.Right;case"center":case"justify":return i.Center}}function c(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}r.d(t,{Hd:function(){return h},NS:function(){return c},TR:function(){return n},b7:function(){return s},g:function(){return u},kH:function(){return a},qv:function(){return o},tf:function(){return l}}),function(e){e[e.Left=-1]="Left",e[e.Center=0]="Center",e[e.Right=1]="Right"}(i||(i={})),function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(n||(n={}))},54815:function(e,t,r){r.d(t,{Gq:function(){return M},a:function(){return k},dk:function(){return g},jj:function(){return v},m2:function(){return p},mE:function(){return x},qr:function(){return b}});var i=r(1413),n=r(11752),a=r(61120),s=r(60136),o=r(29388),u=r(15671),l=r(43144),h=r(10064),c=r(38999),f=r(80613);function v(e,t){switch(e){case f.LW.FILL:return g.from(t);case f.LW.LINE:return k.from(t);case f.LW.MARKER:return x.from(t);case f.LW.TEXT:return b.from(t);case f.LW.LABEL:return M.from(t);default:throw new Error("Unable to createMaterialKey for unknown geometryType ".concat(e))}}var p=function(){function e(t){(0,u.Z)(this,e),this._data=0,this._data=t}return(0,l.Z)(e,[{key:"data",get:function(){return this._data},set:function(e){this._data=e}},{key:"geometryType",get:function(){return this.bits(8,11)},set:function(e){this.setBits(e,8,11)}},{key:"mapAligned",get:function(){return!!this.bit(20)},set:function(e){this.setBit(20,e)}},{key:"sdf",get:function(){return!!this.bit(11)},set:function(e){this.setBit(11,e)}},{key:"pattern",get:function(){return!!this.bit(12)},set:function(e){this.setBit(12,e)}},{key:"textureBinding",get:function(){return this.bits(0,8)},set:function(e){this.setBits(e,0,8)}},{key:"geometryTypeString",get:function(){switch(this.geometryType){case f.LW.FILL:return"fill";case f.LW.MARKER:return"marker";case f.LW.LINE:return"line";case f.LW.TEXT:return"text";case f.LW.LABEL:return"label";default:throw new h.Z("Unable to handle unknown geometryType: ".concat(this.geometryType))}}},{key:"setBit",value:function(e,t){var r=1<<e;t?this._data|=r:this._data&=~r}},{key:"bit",value:function(e){return(this._data&1<<e)>>e}},{key:"setBits",value:function(e,t,r){for(var i=t,n=0;i<r;i++,n++)this.setBit(i,0!=(e&1<<n))}},{key:"bits",value:function(e,t){for(var r=0,i=e,n=0;i<t;i++,n++)r|=this.bit(i)<<n;return r}},{key:"hasVV",value:function(){return!1}},{key:"setVV",value:function(e,t){}},{key:"getVariation",value:function(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}},{key:"getVariationHash",value:function(){return this._data&~(7&this.textureBinding)}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}}]),e}();p.shared=new p(0);var d=function(e){return function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"vvSizeMinMaxValue",get:function(){return 0!==this.bit(16)},set:function(e){this.setBit(16,e)}},{key:"vvSizeScaleStops",get:function(){return 0!==this.bit(17)},set:function(e){this.setBit(17,e)}},{key:"vvSizeFieldStops",get:function(){return 0!==this.bit(18)},set:function(e){this.setBit(18,e)}},{key:"vvSizeUnitValue",get:function(){return 0!==this.bit(19)},set:function(e){this.setBit(19,e)}},{key:"hasVV",value:function(){return(0,n.Z)((0,a.Z)(r.prototype),"hasVV",this).call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}},{key:"setVV",value:function(e,t){(0,n.Z)((0,a.Z)(r.prototype),"setVV",this).call(this,e,t);var i=function(e,t){var r=f.X.SIZE_FIELD_STOPS|f.X.SIZE_MINMAX_VALUE|f.X.SIZE_SCALE_STOPS|f.X.SIZE_UNIT_VALUE,i=(e&(f.mf.FIELD_TARGETS_OUTLINE|f.mf.MINMAX_TARGETS_OUTLINE|f.mf.SCALE_TARGETS_OUTLINE|f.mf.UNIT_TARGETS_OUTLINE))>>>4;return t.isOutline||t.isOutlinedFill?r&i:r&~i}(e,t)&e;this.vvSizeMinMaxValue=!!(i&f.X.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(i&f.X.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(i&f.X.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(i&f.X.SIZE_SCALE_STOPS)}}]),r}(e)},y=function(e){return function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"vvRotation",get:function(){return 0!==this.bit(15)},set:function(e){this.setBit(15,e)}},{key:"hasVV",value:function(){return(0,n.Z)((0,a.Z)(r.prototype),"hasVV",this).call(this)||this.vvRotation}},{key:"setVV",value:function(e,t){(0,n.Z)((0,a.Z)(r.prototype),"setVV",this).call(this,e,t),this.vvRotation=!t.isOutline&&!!(e&f.X.ROTATION)}}]),r}(e)},_=function(e){return function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"vvColor",get:function(){return 0!==this.bit(13)},set:function(e){this.setBit(13,e)}},{key:"hasVV",value:function(){return(0,n.Z)((0,a.Z)(r.prototype),"hasVV",this).call(this)||this.vvColor}},{key:"setVV",value:function(e,t){(0,n.Z)((0,a.Z)(r.prototype),"setVV",this).call(this,e,t),this.vvColor=!t.isOutline&&!!(e&f.X.COLOR)}}]),r}(e)},m=function(e){return function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"vvOpacity",get:function(){return 0!==this.bit(14)},set:function(e){this.setBit(14,e)}},{key:"hasVV",value:function(){return(0,n.Z)((0,a.Z)(r.prototype),"hasVV",this).call(this)||this.vvOpacity}},{key:"setVV",value:function(e,t){(0,n.Z)((0,a.Z)(r.prototype),"setVV",this).call(this,e,t),this.vvOpacity=!t.isOutline&&!!(e&f.X.OPACITY)}}]),r}(e)},g=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"getVariation",value:function(){return(0,i.Z)((0,i.Z)({},(0,n.Z)((0,a.Z)(r.prototype),"getVariation",this).call(this)),{},{dotDensity:this.dotDensity,outlinedFill:this.outlinedFill,simple:this.simple,vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}},{key:"dotDensity",get:function(){return!!this.bit(15)},set:function(e){this.setBit(15,e)}},{key:"simple",get:function(){return!!this.bit(22)},set:function(e){this.setBit(22,e)}},{key:"outlinedFill",get:function(){return!!this.bit(21)},set:function(e){this.setBit(21,e)}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=f.LW.FILL,t.dotDensity="dot-density"===e.stride.fill,t.simple="simple"===e.stride.fill,t.outlinedFill=e.isOutlinedFill,t.dotDensity||t.setVV(e.vvFlags,e),t.data}}]),r}(_(m(d(p))));g.shared=new g(0);var x=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"getVariation",value:function(){return(0,i.Z)((0,i.Z)({},(0,n.Z)((0,a.Z)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=f.LW.MARKER,t.setVV(e.vvFlags,e),t.data}}]),r}(_(m(y(d(p)))));x.shared=new x(0);var k=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"getVariation",value:function(){return(0,i.Z)((0,i.Z)({},(0,n.Z)((0,a.Z)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=f.LW.LINE,t.setVV(e.vvFlags,e),t.data}}]),r}(_(m(d(p))));k.shared=new k(0);var b=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"getVariation",value:function(){return(0,i.Z)((0,i.Z)({},(0,n.Z)((0,a.Z)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=f.LW.TEXT,t.setVV(e.vvFlags,e),t.data}}]),r}(_(m(y(d(p)))));b.shared=new b(0);var M=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"getVariation",value:function(){return(0,i.Z)((0,i.Z)({},(0,n.Z)((0,a.Z)(r.prototype),"getVariation",this).call(this)),{},{vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=f.LW.LABEL,t.setVV(e.vvFlags,e),t.mapAligned=(0,c.NS)(e.placement),t.data}}]),r}(d(p));M.shared=new M(0)},81735:function(e,t,r){r.d(t,{Z:function(){return f}});var i=r(15671),n=r(43144),a=r(60136),s=r(29388),o=r(27366),u=r(41691),l=r(49861),h=(r(63780),r(93169),r(25243),r(69912)),c=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,n.Z)(r,[{key:"initialize",value:function(){}},{key:"destroy",value:function(){}},{key:"supportsTileUpdates",get:function(){return!1}},{key:"spatialReference",get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}}]),r}(u.r);(0,o._)([(0,l.Cb)({readOnly:!0})],c.prototype,"supportsTileUpdates",null),(0,o._)([(0,l.Cb)({constructOnly:!0})],c.prototype,"remoteClient",void 0),(0,o._)([(0,l.Cb)({constructOnly:!0})],c.prototype,"service",void 0),(0,o._)([(0,l.Cb)()],c.prototype,"spatialReference",null),(0,o._)([(0,l.Cb)({constructOnly:!0})],c.prototype,"tileInfo",void 0),(0,o._)([(0,l.Cb)({constructOnly:!0})],c.prototype,"tileStore",void 0);var f=c=(0,o._)([(0,h.j)("esri.views.2d.layers.features.processors.BaseProcessor")],c)},8e4:function(e,t,r){r.r(t),r.d(t,{default:function(){return ds}});var i=r(37762),n=r(15861),a=r(15671),s=r(43144),o=r(60136),u=r(29388),l=r(87757),h=r(27366),c=new(r(8961).Z);function f(e){return c.hasBidiChar(e)?(t="rtl"===c.checkContextual(e)?"IDNNN":"ICNNN",[c.bidiTransform(e,t,"VLYSN"),!0]):[e,!1];var t}var v=r(10064),p=r(93169),d=r(32718),y=r(92026),_=r(75298),m=(r(25243),r(63780),r(75366),r(69912)),g=r(48732),x=r(78952),k=r(84328),b=r(4942),M=r(85015),S=r(49861),w=r(88396),P=r(12502);var C=new Set,Z=[],L=new Map,I=[0,0],T=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e))._keyToItem=new Map,i.concurrency=6,i.strategy="scale-first",i.tileInfoView=null,i}return(0,s.Z)(r,[{key:"initialize",value:function(){var e=this,t=this.concurrency,r=this.process;this._queue=new P.e({concurrency:t,process:function(t,i){var n=e._keyToItem.get(t);return r(n,{signal:i})},peeker:function(e){return e.values().next().value}})}},{key:"destroy",value:function(){this.clear(),this._queue.destroy(),this._queue=null}},{key:"length",get:function(){return this._queue?this._queue.length:0}},{key:"onGoingCount",get:function(){return this._keyToItem.size}},{key:"updating",get:function(){return this.length>0||this.onGoingCount>0}},{key:"abort",value:function(e){var t="string"==typeof e?e:e.id;this._queue.abort(t)}},{key:"clear",value:function(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}},{key:"has",value:function(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}},{key:"isOngoing",value:function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}},{key:"pause",value:function(){this._queue.pause()}},{key:"push",value:function(e,t){var r=this,i=e.key.id+"-"+t;if(this.has(i))return this.get(i);var n=this._queue.push(i),a=function(){r._keyToItem.delete(i),r.notifyChange("updating")};return this._keyToItem.set(i,e),n.then(a,a),this.notifyChange("updating"),n}},{key:"reset",value:function(){this._queue.reset(),this.notifyChange("updating")}},{key:"resume",value:function(){this._queue.resume()}},{key:"_peekByScaleFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var r=this.tileInfoView,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach((function(e){var r=t._keyToItem.get(e),a=t.tileInfoView.getTileScale(r.key);L.has(a)||(L.set(a,[]),i=Math.max(a,i),n=Math.min(a,n)),L.get(a).push(r.key),C.add(a)}));var a=this.state.scale;L.has(a)||(function(e,t){e.length=0,t.forEach((function(t){return e.push(t)}))}(Z,C),Z.sort((function(e,t){return e-t})),a=Z.reduce((function(e,t){return Math.abs(t-a)<Math.abs(e-a)?t:e}),Z[0])),a=Math.min(a,i),a=Math.max(a,n);var s=L.get(a),o=r.getClosestInfoForScale(a),u=o.getColumnForX(this.state.center[0]),l=o.getRowForY(this.state.center[1]);return s.sort((function(e,t){var r=o.denormalizeCol(e.col,e.world),i=o.denormalizeCol(t.col,t.world);return Math.sqrt((u-r)*(u-r)+(l-e.row)*(l-e.row))-Math.sqrt((u-i)*(u-i)+(l-t.row)*(l-t.row))})),C.clear(),L.clear(),s[0].id}},{key:"_peekByCenterFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var r=this.tileInfoView,i=this.state.center,n=Number.POSITIVE_INFINITY,a=null;return e.forEach((function(e){var s=t._keyToItem.get(e);r.getTileCoords(I,s.key);var o=(0,w.b)(I,i);o<n&&(n=o,a=s.key)})),a.id}}]),r}(M.Z);(0,h._)([(0,S.Cb)({constructOnly:!0})],T.prototype,"concurrency",void 0),(0,h._)([(0,S.Cb)({constructOnly:!0})],T.prototype,"process",void 0),(0,h._)([(0,S.Cb)()],T.prototype,"state",void 0),(0,h._)([(0,S.Cb)({constructOnly:!0})],T.prototype,"strategy",void 0),(0,h._)([(0,S.Cb)({constructOnly:!0})],T.prototype,"tileInfoView",void 0),(0,h._)([(0,S.Cb)({readOnly:!0})],T.prototype,"updating",null),T=(0,h._)([(0,m.j)("esri.views.2d.tiling.PagedTileQueue")],T);r(37995);var z=r(73828);var E=new Set,F=[],A=new Map,R=[0,0],O=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e))._keyToItem=new Map,i.concurrency=6,i.strategy="scale-first",i.tileInfoView=null,i}return(0,s.Z)(r,[{key:"initialize",value:function(){var e=this,t=this.concurrency,r=this.process,i=this.strategy;this._queue=new P.e({concurrency:t,process:function(t,i){var n=e._keyToItem.get(t);return r(n,{signal:i})},peeker:"scale-first"===i?function(t){return e._peekByScaleFirst(t)}:function(t){return e._peekByCenterFirst(t)}})}},{key:"destroy",value:function(){this.clear(),this._queue.destroy(),this._queue=null}},{key:"length",get:function(){return this._queue?this._queue.length:0}},{key:"onGoingCount",get:function(){return this._keyToItem.size}},{key:"updating",get:function(){return this.length>0||this.onGoingCount>0}},{key:"abort",value:function(e){var t="string"==typeof e?e:e.id;this._queue.abort(t)}},{key:"clear",value:function(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}},{key:"has",value:function(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}},{key:"isOngoing",value:function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}},{key:"pause",value:function(){this._queue.pause()}},{key:"push",value:function(e){var t=this,r=e.key.id;if(this._queue.has(r))return this._queue.get(r);var i=this._queue.push(r),n=function(){t._keyToItem.delete(r),t.notifyChange("updating")};return this._keyToItem.set(r,e),i.then(n,n),this.notifyChange("updating"),i}},{key:"reset",value:function(){this._queue.reset()}},{key:"resume",value:function(){this._queue.resume()}},{key:"_peekByScaleFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var r=this.tileInfoView,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach((function(e){var r=t._keyToItem.get(e),a=t.tileInfoView.getTileScale(r.key);A.has(a)||(A.set(a,[]),i=Math.max(a,i),n=Math.min(a,n)),A.get(a).push(r.key),E.add(a)}));var a=this.state.scale;A.has(a)||(function(e,t){e.length=0,t.forEach((function(t){return e.push(t)}))}(F,E),F.sort((function(e,t){return e-t})),a=F.reduce((function(e,t){return Math.abs(t-a)<Math.abs(e-a)?t:e}),F[0])),a=Math.min(a,i),a=Math.max(a,n);var s=A.get(a),o=r.getClosestInfoForScale(a),u=o.getColumnForX(this.state.center[0]),l=o.getRowForY(this.state.center[1]);return s.sort((function(e,t){var r=o.denormalizeCol(e.col,e.world),i=o.denormalizeCol(t.col,t.world);return Math.sqrt((u-r)*(u-r)+(l-e.row)*(l-e.row))-Math.sqrt((u-i)*(u-i)+(l-t.row)*(l-t.row))})),E.clear(),A.clear(),s[0].id}},{key:"_peekByCenterFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var r=this.tileInfoView,i=this.state.center,n=Number.POSITIVE_INFINITY,a=null;return e.forEach((function(e){var s=t._keyToItem.get(e);r.getTileCoords(R,s.key);var o=(0,w.b)(R,i);o<n&&(n=o,a=s.key)})),a.id}}]),r}(M.Z);(0,h._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"concurrency",void 0),(0,h._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"process",void 0),(0,h._)([(0,S.Cb)()],O.prototype,"state",void 0),(0,h._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"strategy",void 0),(0,h._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"tileInfoView",void 0),(0,h._)([(0,S.Cb)({readOnly:!0})],O.prototype,"updating",null),O=(0,h._)([(0,m.j)("esri.views.2d.tiling.TileQueue")],O);var W=r(65156);r(48790),new z.Z(0,0,0,0),new Map;var N=r(94109),V=r(80613),G=r(46640),D=new Map;D.set(V.LW.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),D.set(V.LW.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),D.set(V.LW.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),D.set(V.LW.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),D.set(V.LW.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var B=function(){function e(t,r){(0,a.Z)(this,e),this._pos=0;var i=r?this._roundToNearest(r,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}return(0,s.Z)(e,[{key:"length",get:function(){return this._pos}},{key:"_roundToNearest",value:function(e,t){var r=Math.round(e);return r+(t-r%t)}},{key:"_ensureSize",value:function(e){if(this._pos+e>=this._buffer.length){var t=this._roundToNearest(1.25*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),i=new this._ctor(r);i.set(this._buffer,0),this._array=r,this._buffer=i,this._i16View=new Int16Array(this._array)}}},{key:"ensureSize",value:function(e){this._ensureSize(e)}},{key:"writeF32",value:function(e){this._ensureSize(1);var t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}},{key:"push",value:function(e){this._ensureSize(1);var t=this._pos;return this._buffer[this._pos++]=e,t}},{key:"writeFixed",value:function(e){this._buffer[this._pos++]=e}},{key:"setValue",value:function(e,t){this._buffer[e]=t}},{key:"i1616Add",value:function(e,t,r){this._i16View[2*e]+=t,this._i16View[2*e+1]+=r}},{key:"getValue",value:function(e){return this._buffer[e]}},{key:"incr",value:function(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}},{key:"decr",value:function(e){this._buffer[e]--}},{key:"writeRegion",value:function(e){this._ensureSize(e.length);var t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}},{key:"writeManyFrom",value:function(e,t,r){this._ensureSize(r-t);for(var i=t;i!==r;i++)this.writeFixed(e._buffer[i])}},{key:"buffer",value:function(){var e=this._array.slice(0,4*this._pos);return this.destroy(),e}},{key:"toArray",value:function(){for(var e=this._array,t=[],r=0;r<e.byteLength/4;r++)t.push(e[r]);return t}},{key:"seek",value:function(e){this._pos=e}},{key:"destroy",value:function(){this._array=null,this._buffer=null}}]),e}(),X=function(){function e(t,r,i){(0,a.Z)(this,e),this._start={index:0,vertex:0};var n=function(e,t,r){var i=D.get(e),n=i.indicesPerRecord,a=i.multiplier,s=i.verticesPerRecord;return{recordBytes:r*N.XJ*Uint32Array.BYTES_PER_ELEMENT,indexBytes:a*n*r*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:a*s*r*t}}(t,r,i),s=r/4;this.geometryType=t,this._records=new B(Int32Array,n.recordBytes),this._indices=new B(Uint32Array,n.indexBytes),this._vertices=new B(Uint32Array,n.vertexBytes),this._metrics=new B(Float32Array,0),this._strideInt=s}return(0,s.Z)(e,[{key:"serialize",value:function(e){var t=this._records.buffer(),r=this._indices.buffer(),i=this._vertices.buffer(),n=this._metrics.length?this._metrics.buffer():null,a=4*this._strideInt;return e.push(t,r,i),{stride:a,records:t,indices:r,vertices:i,metrics:n}}},{key:"strideInt",get:function(){return this._strideInt}},{key:"recordCount",get:function(){return this._records.length/N.XJ}},{key:"vertexCount",get:function(){return this._vertices.length/this._strideInt}},{key:"indexCount",get:function(){return this._indices.length}},{key:"indexWriter",get:function(){return this._indices}},{key:"vertexWriter",get:function(){return this._vertices}},{key:"metricWriter",get:function(){return this._metrics}},{key:"vertexEnsureSize",value:function(e){this._vertices.ensureSize(e)}},{key:"indexEnsureSize",value:function(e){this._indices.ensureSize(e)}},{key:"recordStart",value:function(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}},{key:"recordEnd",value:function(e,t,r,i,n,a,s,o){this._records.push(e),this._records.push(t),this._records.push(r),this._records.push(i),this._records.push(n),this._records.push(a),this._records.push(s),this._records.writeF32(o)}},{key:"writeIndex",value:function(e){this._indices.push(e)}},{key:"writeVertex",value:function(e){this._vertices.push(e)}},{key:"writeVertexF32",value:function(e){this._vertices.writeF32(e)}},{key:"copyLastFrom",value:function(e,t,r){for(var i=e._records.length-N.XJ,n=e._records.getValue(i),a=e._records.getValue(i+1),s=e._records.getValue(i+2),o=e._records.getValue(i+4),u=e._records.getValue(i+6),l=e._records.getValue(i+7),h=this._vertices.length,c=(e._start.vertex-this._vertices.length)/this._strideInt,f=this._indices.length,v=this.vertexCount,p=e._start.index;p!==e._indices.length;p++){var d=e._indices.getValue(p);this._indices.push(d-c)}for(var y=e._start.vertex;y!==e._vertices.length;y++){var _=e._vertices.getValue(y);this._vertices.push(_)}for(var m=h;m<=this._vertices.length;m+=this._strideInt)this._vertices.i1616Add(m,t,r);this._records.push(n),this._records.push(a),this._records.push(s),this._records.push(f),this._records.push(o),this._records.push(v),this._records.push(u),this._records.push(l)}}]),e}(),U=r(35092),H=128;function Y(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case H:return 1}}function J(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case H:return 1}}var q=function(){function e(t,r,i,n,s){(0,a.Z)(this,e),this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=r,this.tileKey=t,this._hasAggregate=n,this._pixelBufferEnabled=s,this._strideOptions=i}return(0,s.Z)(e,[{key:"hasAggregates",get:function(){return this._hasAggregate}},{key:"hasPixelBufferEnabled",get:function(){return this._pixelBufferEnabled}},{key:"serialize",value:function(e){var t=this,r=[];return r.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((function(i,n){var a=1<<n,s=Y(a),o=J(a),u=(0,U.M)(new z.Z(t.tileKey),s,o,e),l=t._serializeTileVertexData(t.tileKey,u.id,i.vertexData);l.message.bufferIds=i.displayIds,r.push(l)})),r}},{key:"_serializeTileVertexData",value:function(e,t,r){var i,n,a,s,o,u,l=new Array;return{message:{tileKeyOrigin:e,tileKey:t,data:(i={},(0,b.Z)(i,V.LW.MARKER,null==(n=r.get(V.LW.MARKER))?void 0:n.serialize(l)),(0,b.Z)(i,V.LW.FILL,null==(a=r.get(V.LW.FILL))?void 0:a.serialize(l)),(0,b.Z)(i,V.LW.LINE,null==(s=r.get(V.LW.LINE))?void 0:s.serialize(l)),(0,b.Z)(i,V.LW.TEXT,null==(o=r.get(V.LW.TEXT))?void 0:o.serialize(l)),(0,b.Z)(i,V.LW.LABEL,null==(u=r.get(V.LW.LABEL))?void 0:u.serialize(l)),i)},transferList:l}}},{key:"featureStart",value:function(e,t){this._current.insertAfter=e,this._current.sortKey=t}},{key:"featureEnd",value:function(){}},{key:"recordStart",value:function(e,t,r,i){this._current.writer=this._getVertexWriter(r),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=i,this._current.id=e,this._current.materialKey=t,this._current.geometryType=r,this._current.isDotDensity=!1,this._current.writer.recordStart()}},{key:"recordCount",value:function(){return this._current.writer.recordCount}},{key:"vertexCount",value:function(){return this._current.writer.vertexCount}},{key:"indexCount",value:function(){return this._current.writer.indexCount}},{key:"vertexEnsureSize",value:function(e){this._current.writer.vertexEnsureSize(e)}},{key:"indexEnsureSize",value:function(e){this._current.writer.indexEnsureSize(e)}},{key:"vertexBounds",value:function(e,t,r,i){this._current.bufferingEnabled&&this._addOverlap(e,t,r,i)}},{key:"vertexWrite",value:function(e){this._current.writer.writeVertex(e)}},{key:"vertexWriteF32",value:function(e){this._current.writer.writeVertexF32(e)}},{key:"vertexEnd",value:function(){}},{key:"vertexWriter",value:function(){return this._current.writer.vertexWriter}},{key:"indexWrite",value:function(e){this._current.writer.writeIndex(e)}},{key:"indexWriter",value:function(){return this._current.writer.indexWriter}},{key:"metricWriter",value:function(){return this._current.writer.metricWriter}},{key:"metricStart",value:function(e,t,r,i,n,a,s,o){this._current.writer=this._getVertexWriter(V.LW.LABEL);var u=this._current.writer.metricWriter;u.push((0,k.jL)(e)),u.push(t),u.push(r),u.push(i),u.push(n),u.push(a),u.push(s),u.push(o),u.push(255),this._current.metricBoxLenPointer=u.push(0)}},{key:"metricEnd",value:function(){var e=this._current.writer.metricWriter;0===e.getValue(this._current.metricBoxLenPointer)&&e.seek(e.length-10)}},{key:"metricBoxWrite",value:function(e,t,r,i){var n=this._current.writer.metricWriter;n.incr(this._current.metricBoxLenPointer),n.push(0),n.push(0),n.push(e),n.push(t),n.push(r),n.push(i)}},{key:"recordEnd",value:function(){var e=this._current.vertStart,t=this._current.writer.vertexCount-e;if(!t)return!1;this.hasRecords=!0;var r=this._current.indexStart,i=this._current.writer.indexCount-r;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,r,i,e,t,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===V.LW.LABEL)return!0;for(var n=this._current.writer,a=0;a<8;a++){var s=1<<a;if(this._current.overlaps&s){this._data.neighbors[a]||(this._data.neighbors[a]={vertexData:new Map,displayIds:new Set});var o=this._data.neighbors[a],u=this._current.geometryType;if(!o.vertexData.has(u)){var l=(0,G.$_)(u,this._strideOptions).geometry,h=new X(u,l,N.Ip);o.vertexData.set(u,h)}var c=o.vertexData.get(this._current.geometryType),f=512*-Y(s)*8,v=512*-J(s)*8;c.copyLastFrom(n,f,v),o.displayIds.add(this._current.id)}}return!0}},{key:"_addOverlap",value:function(e,t,r,i){var n=255^((e<0+r?148:e>=N.I_-r?41:189)|(t<0+i?224:t>=N.I_-i?7:231));this._current.overlaps|=n}},{key:"_getVertexWriter",value:function(e){if(!this._data.self.has(e)){var t=this._data.self,r=(0,G.$_)(e,this._strideOptions).geometry;t.set(e,new X(e,r,this.hint.records))}return this._data.self.get(e)}}]),e}(),K=r(48035),j=r(70885),$=r(16889),Q=r(17842),ee=r(48202),te=r(38999),re=r(65800),ie=r(73271),ne=r(54815),ae=100;function se(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function oe(e,t){return Math.sqrt(e*e+t*t)}function ue(e){var t=oe(e[0],e[1]);e[0]/=t,e[1]/=t}function le(e,t){return oe(e[0]-t[0],e[1]-t[1])}function he(e){return"function"==typeof e}function ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 1/Math.max(e,1)}function fe(e,t){return[!!e.minScale&&t.scaleToZoom(e.minScale)||0,!!e.maxScale&&t.scaleToZoom(e.maxScale)||ae]}function ve(e,t){return e[t+1]}function pe(e){return e.length-1}function de(e){for(var t=0,r=0;r<pe(e);r++)t+=ye(e,r);return t}function ye(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=ve(e,t),n=(0,j.Z)(i,2),a=n[0],s=n[1];return Math.sqrt(a*a+s*s)*r}var _e=function(){function e(t,r,i,n,s){(0,a.Z)(this,e),this._segments=t,this._index=r,this._distance=i,this._xStart=n,this._yStart=s,this._done=!1}return(0,s.Z)(e,[{key:"clone",value:function(){return new e(this._segments,this._index,this._distance,this.xStart,this.yStart)}},{key:"equals",value:function(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}},{key:"leq",value:function(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}},{key:"geq",value:function(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}},{key:"_segment",get:function(){return this._segments[this._index+1]}},{key:"angle",get:function(){var e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length),r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}},{key:"xStart",get:function(){return this._xStart}},{key:"yStart",get:function(){return this._yStart}},{key:"x",get:function(){return this.xStart+this.distance*this.dx}},{key:"y",get:function(){return this.yStart+this.distance*this.dy}},{key:"dx",get:function(){return this._segment[0]}},{key:"dy",get:function(){return this._segment[1]}},{key:"xMidpoint",get:function(){return this.xStart+.5*this.dx}},{key:"yMidpoint",get:function(){return this.yStart+.5*this.dy}},{key:"xEnd",get:function(){return this.xStart+this.dx}},{key:"yEnd",get:function(){return this.yStart+this.dy}},{key:"length",get:function(){var e=this.dx,t=this.dy;return Math.sqrt(e*e+t*t)}},{key:"remainingLength",get:function(){return this.length*(1-this._distance)}},{key:"backwardLength",get:function(){return this.length*this._distance}},{key:"distance",get:function(){return this._distance}},{key:"done",get:function(){return this._done}},{key:"hasPrev",value:function(){return this._index-1>=0}},{key:"hasNext",value:function(){return this._index+1<pe(this._segments)}},{key:"next",value:function(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}},{key:"prev",value:function(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}},{key:"_seekBackwards",value:function(e,t){var r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;for(var i=this.backwardLength;this.prev();){if(i+this.length>e)return this._seekBackwards(e-i);i+=this.length}return this._distance=0,t?this:null}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;for(var r=this.remainingLength;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}],[{key:"create",value:function(t){return new e(t,0,0,t[0][0],t[0][1])}}]),e}();function me(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=de(e),a=_e.create(e),s=n/2;if(!i)return a.seek(s),void r(a.clone(),0,s+0*t,n);var o=Math.max((n-t)/2,0),u=Math.floor(o/t),l=s-u*t;a.seek(l);for(var h=-u;h<=u;h++)a.x<512&&a.x>=0&&a.y<512&&a.y>=0&&r(a.clone(),h,s+h*t,n),a.seek(t)}function ge(e,t){var r=1e-6;if(!(t<=0)){var i=e.length;if(!(i<3)){var n=[],a=0;n.push(0);for(var s=1;s<i;s++)a+=le(e[s],e[s-1]),n.push(a);t=Math.min(t,.2*a);var o=[];o.push(e[0][0]),o.push(e[0][1]);var u=e[i-1][0],l=e[i-1][1],h=se([0,0],e[0],e[1]);ue(h),e[0][0]+=t*h[0],e[0][1]+=t*h[1],se(h,e[i-1],e[i-2]),ue(h),e[i-1][0]+=t*h[0],e[i-1][1]+=t*h[1];for(var c=1;c<i;c++)n[c]+=t;n[i-1]+=t;for(var f=.5*t,v=1;v<i-1;v++){for(var p=0,d=0,y=0,_=v-1;_>=0&&!(n[_+1]<n[v]-f);_--){var m=f+n[_+1]-n[v],g=n[_+1]-n[_],x=n[v]-n[_]<f?1:m/g;if(Math.abs(x)<r)break;var k=x*x,b=x*m-.5*k*g,M=x*g/t,S=e[_+1],w=e[_][0]-S[0],P=e[_][1]-S[1];p+=M/b*(S[0]*x*m+.5*k*(m*w-g*S[0])-k*x*g*w/3),d+=M/b*(S[1]*x*m+.5*k*(m*P-g*S[1])-k*x*g*P/3),y+=M}for(var C=v+1;C<i&&!(n[C-1]>n[v]+f);C++){var Z=f-n[C-1]+n[v],L=n[C]-n[C-1],I=n[C]-n[v]<f?1:Z/L;if(Math.abs(I)<r)break;var T=I*I,z=I*Z-.5*T*L,E=I*L/t,F=e[C-1],A=e[C][0]-F[0],R=e[C][1]-F[1];p+=E/z*(F[0]*I*Z+.5*T*(Z*A-L*F[0])-T*I*L*A/3),d+=E/z*(F[1]*I*Z+.5*T*(Z*R-L*F[1])-T*I*L*R/3),y+=E}o.push(p/y),o.push(d/y)}o.push(u),o.push(l);for(var O=0,W=0;O<i;O++)e[O][0]=o[W++],e[O][1]=o[W++]}}}var xe=r(83406),ke=r(84652),be=r(77981),Me=function(){function e(){(0,a.Z)(this,e),this.setIdentity()}return(0,s.Z)(e,[{key:"getAngle",value:function(){return(null==this.rz||0===this.rz&&1!==this.rz_c&&0!==this.rz_s)&&(this.rz=Math.atan2(this.rz_s,this.rz_c)),this.rz}},{key:"setIdentity",value:function(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rz_c=1,this.rz_s=0}},{key:"setTranslate",value:function(e,t){this.tx=e,this.ty=t}},{key:"setTranslateZ",value:function(e){this.tz=e}},{key:"setRotateCS",value:function(e,t){this.rz=void 0,this.rz_c=e,this.rz_s=t}},{key:"setRotate",value:function(e){this.rz=e,this.rz_c=void 0,this.rz_s=void 0}},{key:"setRotateY",value:function(e){this.ry=e}},{key:"setScale",value:function(e){this.s=e}},{key:"setMeasure",value:function(e){this.m=e}}]),e}();function Se(e){var t=(0,ke.d9)(e);return function(e){e&&((0,be.oU)(e)?Te(e.rings):(0,be.l9)(e)?Te(e.paths):(0,be.aW)(e)&&Ie(e.points),we(e))}(t),t}function we(e){if(!e)return null;(0,be.wp)(e)?e.y=-e.y:(0,be.oU)(e)?Ce(e.rings):(0,be.l9)(e)?Ce(e.paths):(0,be.aW)(e)&&Pe(e.points)}function Pe(e){if(e)for(var t=e.length,r=0;r<t;r++)e[r][1]=-e[r][1]}function Ce(e){if(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){Pe(t.value)}}catch(n){r.e(n)}finally{r.f()}}}function Ze(e){if(e)for(var t=e.length-1;t>0;--t)e[t][0]-=e[t-1][0],e[t][1]-=e[t-1][1]}function Le(e){if(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){Ze(t.value)}}catch(n){r.e(n)}finally{r.f()}}}function Ie(e){if(e)for(var t=e.length,r=1;r<t;++r)e[r][0]+=e[r-1][0],e[r][1]+=e[r-1][1]}function Te(e){if(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){Ie(t.value)}}catch(n){r.e(n)}finally{r.f()}}}function ze(e){if(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){Ee(t.value)}}catch(n){r.e(n)}finally{r.f()}}}function Ee(e){e&&e.reverse()}function Fe(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]}function Ae(e){return e[4]}function Re(e,t){e[4]=t}var Oe=function(){function e(t,r,i,n){(0,a.Z)(this,e),this.acceptPolygon=r,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1,t&&((0,be.oU)(t)?r&&(this.multiPath=t.rings,this.isClosed=!0):(0,be.l9)(t)?i&&(this.multiPath=t.paths,this.isClosed=!1):(0,be.YX)(t)&&r&&(this.multiPath=Ne(t).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length)),this.internalPlacement=new Me}return(0,s.Z)(e,[{key:"next",value:function(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var e=this.processPath(this.multiPath[this.pathIndex]);if(e)return e}return this.pathCount=-1,this.pathIndex=-1,this.multiPath=null,null}}]),e}(),We=function(){function e(t,r,i,n){(0,a.Z)(this,e),this.inputGeometries=t,this.acceptPolygon=r,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1}return(0,s.Z)(e,[{key:"next",value:function(){for(;;){if(!this.multiPath){for(var e=this.inputGeometries.next();e;){if((0,be.oU)(e)?this.acceptPolygon&&(this.multiPath=e.rings,this.isClosed=!0):(0,be.l9)(e)?this.acceptPolyline&&(this.multiPath=e.paths,this.isClosed=!1):(0,be.YX)(e)&&this.acceptPolygon&&(this.multiPath=Ne(e).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length,this.pathIndex=-1;break}e=this.inputGeometries.next()}if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var t=this.processPath(this.multiPath[this.pathIndex]);if(t)return t}this.pathCount=-1,this.pathIndex=-1,this.multiPath=null}}}]),e}();function Ne(e){return{rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}}var Ve=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new Ge(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Ve.instance=null;var Ge=function(){function e(t,r,i){(0,a.Z)(this,e),this._inputGeometries=t,this._angleTolerance=void 0!==r.angleTolerance?r.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}return(0,s.Z)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if((0,be.oU)(e)){this._isClosed=!0;var t=(0,ke.d9)(e);return this._processMultipath(t.rings),t}if((0,be.l9)(e)){this._isClosed=!1;var r=(0,ke.d9)(e);return this._processMultipath(r.paths),r}if((0,be.YX)(e)){if(this._maxCosAngle)return e;this._isClosed=!0;var i=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];return this._processPath(i),{rings:[i]}}e=this._inputGeometries.next()}return null}},{key:"_processMultipath",value:function(e){if(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._processPath(n)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"_processPath",value:function(e){if(e){var t,r,i,n,a,s,o=e.length,u=e[0];this._isClosed&&++o;for(var l=1;l<o;++l){var h,c=(h=this._isClosed&&l===o-1?e[0]:e[l])[0]-u[0],f=h[1]-u[1],v=Math.sqrt(c*c+f*f);l>1&&v>0&&i>0&&(t*c+r*f)/v/i<=this._maxCosAngle&&Re(u,1),1===l&&(n=c,a=f,s=v),v>0&&(u=h,t=c,r=f,i=v)}this._isClosed&&i>0&&s>0&&(t*n+r*a)/s/i<=this._maxCosAngle&&Re(e[0],1)}}}]),e}(),De=.03,Be=function(){function e(){(0,a.Z)(this,e),this._path=[]}return(0,s.Z)(e,[{key:"path",value:function(){return this._path}},{key:"addPath",value:function(e,t){t||e.reverse(),Array.prototype.push.apply(this._path,e),t||e.reverse()}},{key:"startPath",value:function(e){this._path.push(e)}},{key:"lineTo",value:function(e){this._path.push(e)}},{key:"close",value:function(){var e=this._path;e.length>1&&(e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]))}}],[{key:"mergePath",value:function(e,t){t&&Array.prototype.push.apply(e,t)}}]),e}(),Xe=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"normalize",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);e[0]/=t,e[1]/=t}},{key:"calculateLength",value:function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}},{key:"calculateSegLength",value:function(e,t){return this.calculateLength(e[t],e[t+1])}},{key:"calculatePathLength",value:function(e){for(var t=0,r=e?e.length:0,i=0;i<r-1;++i)t+=this.calculateSegLength(e,i);return t}},{key:"calculatePathArea",value:function(e){for(var t=0,r=e?e.length:0,i=0;i<r-1;++i)t+=(e[i+1][0]-e[i][0])*(e[i+1][1]+e[i][1]);return t/2}},{key:"getCoord2D",value:function(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]}},{key:"getSegCoord2D",value:function(e,t,r){return this.getCoord2D(e[t],e[t+1],r)}},{key:"getAngle",value:function(e,t,r){var i=t[0]-e[0],n=t[1]-e[1];return Math.atan2(n,i)}},{key:"getSegAngle",value:function(e,t,r){return this.getAngle(e[t],e[t+1],r)}},{key:"getAngleCS",value:function(e,t,r){var i=t[0]-e[0],n=t[1]-e[1],a=Math.sqrt(i*i+n*n);return a>0?[i/a,n/a]:[1,0]}},{key:"getSegAngleCS",value:function(e,t,r){return this.getAngleCS(e[t],e[t+1],r)}},{key:"cut",value:function(e,t,r,i){return[r<=0?e[t]:this.getSegCoord2D(e,t,r),i>=1?e[t+1]:this.getSegCoord2D(e,t,i)]}},{key:"addSegment",value:function(e,t,r){r&&e.push(t[0]),e.push(t[1])}},{key:"getSubCurve",value:function(e,t,r){var i=[];return this.appendSubCurve(i,e,t,r)?i:null}},{key:"appendSubCurve",value:function(e,t,r,i){for(var n=t?t.length-1:0,a=0,s=!0,o=0;o<n;){var u=this.calculateSegLength(t,o);if(0!==u){if(s){if(a+u>r){var l=(r-a)/u,h=1,c=!1;a+u>=i&&(h=(i-a)/u,c=!0);var f=this.cut(t,o,l,h);if(f&&this.addSegment(e,f,s),c)break;s=!1}}else{if(a+u>i){var v=this.cut(t,o,0,(i-a)/u);v&&this.addSegment(e,v,s);break}this.addSegment(e,[t[o],t[o+1]],s)}a+=u,++o}else++o}return!0}},{key:"getCIMPointAlong",value:function(e,t){for(var r=e?e.length-1:0,i=0,n=-1;n<r;){++n;var a=this.calculateSegLength(e,n);if(0!==a){if(i+a>t){var s=(t-i)/a;return this.getCoord2D(e[n],e[n+1],s)}i+=a}}return null}},{key:"isEmpty",value:function(e,t){if(!e||e.length<=1)return!0;for(var r=e?e.length-1:0,i=-1;i<r;){if(e[++i+1][0]!==e[i][0]||e[i+1][1]!==e[i][1])return!1;if(t&&e[i+1][2]!==e[i][2])return!1}return!0}},{key:"offset",value:function(e,t,r,i,n){if(!e||e.length<2)return null;for(var a=0,s=e[a++],o=a;a<e.length;){var u=e[a];u[0]===s[0]&&u[1]===s[1]||(a!==o&&(e[o]=e[a]),s=e[o++]),a++}var l=e[0][0]===e[o-1][0]&&e[0][1]===e[o-1][1];if(l&&--o,o<(l?3:2))return null;var h=[];s=l?e[o-1]:null;for(var c=e[0],f=0;f<o;f++){var v=f===o-1?l?e[0]:null:e[f+1];if(s)if(v){var p=[v[0]-c[0],v[1]-c[1]];this.normalize(p);var d=[c[0]-s[0],c[1]-s[1]];this.normalize(d);var y=d[0]*p[1]-d[1]*p[0],_=d[0]*p[0]+d[1]*p[1];if(y>=0==t<=0){if(_<1){var m=[p[0]-d[0],p[1]-d[1]];this.normalize(m);var g=Math.sqrt((1+_)/2);if(g>1/i){var x=-Math.abs(t)/g;h.push([c[0]-m[0]*x,c[1]-m[1]*x])}}}else switch(r){case ee.id.Mitered:var k=Math.sqrt((1+_)/2);if(k>0&&1/k<i){var b=[p[0]-d[0],p[1]-d[1]];this.normalize(b);var M=Math.abs(t)/k;h.push([c[0]-b[0]*M,c[1]-b[1]*M]);break}case ee.id.Bevelled:h.push([c[0]+d[1]*t,c[1]-d[0]*t]),h.push([c[0]+p[1]*t,c[1]-p[0]*t]);break;case ee.id.Rounded:if(_<1){h.push([c[0]+d[1]*t,c[1]-d[0]*t]);var S=Math.floor(2.5*(1-_));if(S>0)for(var w=1/S,P=w,C=1;C<S;C++,P+=w){var Z=[d[1]*(1-P)+p[1]*P,-d[0]*(1-P)-p[0]*P];this.normalize(Z),h.push([c[0]+Z[0]*t,c[1]+Z[1]*t])}h.push([c[0]+p[1]*t,c[1]-p[0]*t])}break;case ee.id.Square:default:if(y<0)h.push([c[0]+(d[1]+d[0])*t,c[1]+(d[1]-d[0])*t]),h.push([c[0]+(p[1]-p[0])*t,c[1]-(p[0]+p[1])*t]);else{var L=Math.sqrt((1+Math.abs(_))/2),I=[p[0]-d[0],p[1]-d[1]];this.normalize(I);var T=t/L;h.push([c[0]-I[0]*T,c[1]-I[1]*T])}}}else{var z=[c[0]-s[0],c[1]-s[1]];this.normalize(z),h.push([c[0]+z[1]*t,c[1]-z[0]*t])}else{var E=[v[0]-c[0],v[1]-c[1]];this.normalize(E),h.push([c[0]+E[1]*t,c[1]-E[0]*t])}s=c,c=v}return h.length<(l?3:2)?null:(l&&h.push([h[0][0],h[0][1]]),h)}}]),e}(),Ue=1.7320508075688772,He=ee.TF.OpenEnded,Ye=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new Je(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Ye.instance=null;var Je=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;return(0,a.Z)(this,r),(s=t.call(this,e,!1,!0))._curveHelper=new Xe,s._width=(void 0!==i.width?i.width:5)*n,s._arrowType=void 0!==i.geometricEffectArrowType?i.geometricEffectArrowType:void 0!==i.arrowType?i.arrowType:He,s._offsetFlattenError=De*n,s}return(0,s.Z)(r,[{key:"processPath",value:function(e){switch(this._arrowType){case ee.TF.OpenEnded:default:return this._constructSimpleArrow(e,!0);case ee.TF.Block:return this._constructSimpleArrow(e,!1);case ee.TF.Crossed:return this._constructCrossedArrow(e)}}},{key:"_constructSimpleArrow",value:function(e,t){var r=this._curveHelper.calculatePathLength(e),i=this._width;r<2*i&&(i=r/2);var n=this._curveHelper.getSubCurve(e,0,r-i);if(!n)return null;var a=i/2;if(this._curveHelper.isEmpty(n,!1))return null;var s=this._constructOffset(n,-a);if(!s)return null;var o=this._constructOffset(n,a);if(!o)return null;var u=this._constructArrowBasePoint(s,-a/2);if(!u)return null;var l=this._constructArrowBasePoint(o,a/2);if(!l)return null;var h=e[e.length-1];t||(this._makeControlPoint(o,!0),this._makeControlPoint(s,!0));var c=new Be;return c.addPath(o,!0),c.lineTo(l),this._makeControlPoint(c.path()),c.lineTo(h),this._makeControlPoint(c.path()),c.lineTo(u),this._makeControlPoint(c.path()),c.addPath(s,!1),t?{paths:[c.path()]}:(c.close(),{rings:[c.path()]})}},{key:"_constructCrossedArrow",value:function(e){var t=this._curveHelper.calculatePathLength(e),r=this._width;t<3.732050807568877*r&&(r=t/3.732050807568877);var i=this._curveHelper.getSubCurve(e,0,t-r*(1+Ue));if(!i)return null;var n=r/2;if(this._curveHelper.isEmpty(i,!1))return null;var a=this._constructOffset(i,n);if(!a)return null;var s=this._constructOffset(i,-n);if(!s)return null;var o=this._curveHelper.getSubCurve(e,0,t-r);if(!o)return null;if(this._curveHelper.isEmpty(o,!1))return null;var u=this._constructOffset(o,n);if(!u)return null;var l=this._constructOffset(o,-n);if(!l)return null;var h=u[u.length-1],c=this._constructArrowBasePoint(u,n/2);if(!c)return null;var f=l[l.length-1],v=this._constructArrowBasePoint(l,-n/2);if(!v)return null;var p=e[e.length-1];this._makeControlPoint(a,!1),this._makeControlPoint(s,!1);var d=new Be;return d.addPath(a,!0),this._makeControlPoint(d.path()),d.lineTo(f),d.lineTo(v),this._makeControlPoint(d.path()),d.lineTo(p),this._makeControlPoint(d.path()),d.lineTo(c),this._makeControlPoint(d.path()),d.lineTo(h),this._makeControlPoint(d.path()),d.addPath(s,!1),{paths:[d.path()]}}},{key:"_constructOffset",value:function(e,t){return this._curveHelper.offset(e,t,ee.id.Rounded,4,this._offsetFlattenError)}},{key:"_constructArrowBasePoint",value:function(e,t){if(!e||e.length<2)return null;var r=e[e.length-2],i=e[e.length-1],n=[i[0]-r[0],i[1]-r[1]];return this._curveHelper.normalize(n),[i[0]+n[1]*t,i[1]-n[0]*t]}},{key:"_makeControlPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Re(t?e[0]:e[e.length-1],1)}}]),r}(We),qe=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new Ke(e,t,r,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();qe.instance=null;var Ke=function(){function e(t,r,i,n){(0,a.Z)(this,e),this._inputGeometries=t,this._curveHelper=new Xe,this._size=(void 0!==r.size?r.size:1)*i,this._offsetFlattenError=De*i}return(0,s.Z)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if((0,be.YX)(e))if(this._size>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],r=this._curveHelper.offset(t,this._size,ee.id.Rounded,4,this._offsetFlattenError);if(r)return{rings:[r]}}else{if(!(this._size<0))return e;if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return{xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size}}if((0,be.oU)(e)){if(0===this._size)return e;var n,a=[],s=(0,i.Z)(e.rings);try{for(s.s();!(n=s.n()).done;){var o=n.value,u=this._curveHelper.offset(o,this._size,ee.id.Rounded,4,this._offsetFlattenError);u&&a.push(u)}}catch(y){s.e(y)}finally{s.f()}if(a.length)return{rings:a}}if((0,be.l9)(e)&&this._size>0){var l,h=[],c=(0,i.Z)(e.paths);try{for(c.s();!(l=c.n()).done;){var f=l.value;if(f&&f.length>1){var v=this._curveHelper.offset(f,this._size,ee.id.Rounded,4,this._offsetFlattenError),p=this._curveHelper.offset(f,-this._size,ee.id.Rounded,4,this._offsetFlattenError);if(v&&p){for(var d=p.length-1;d>=0;d--)v.push(p[d]);v.push([v[0][0],v[0][1]]),h.push(v)}}}}catch(y){c.e(y)}finally{c.f()}if(h.length)return{rings:h}}(0,be.wp)(e)&&this._size,e=this._inputGeometries.next()}return null}}]),e}(),je=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new $e(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();je.instance=null;var $e=function(){function e(t,r,i){var n;(0,a.Z)(this,e),this._default_point_size=20,this._inputGeometries=t,this._geomUnitsPerPoint=i,this._rule=null!=(n=r.rule)?n:ee.Em.FullGeometry,this._default_size=this._default_point_size*i}return(0,s.Z)(e,[{key:"next",value:function(){for(var e;e=this._inputGeometries.next();){var t=void 0;if((0,be.wp)(e)?t=this._processGeom([[[e.x,e.y]]]):(0,be.aW)(e)?t=this._processGeom([e.points]):(0,be.l9)(e)?t=this._processGeom(e.paths):(0,be.oU)(e)&&(t=this._processGeom(e.rings)),t&&t.length)return{paths:t}}return null}},{key:"_clone",value:function(e){return[e[0],e[1]]}},{key:"_mid",value:function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}},{key:"_mix",value:function(e,t,r,i){return[e[0]*t+r[0]*i,e[1]*t+r[1]*i]}},{key:"_add",value:function(e,t){return[e[0]+t[0],e[1]+t[1]]}},{key:"_add2",value:function(e,t,r){return[e[0]+t,e[1]+r]}},{key:"_sub",value:function(e,t){return[e[0]-t[0],e[1]-t[1]]}},{key:"_dist",value:function(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}},{key:"_norm",value:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}},{key:"_normalize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=t/this._norm(e);e[0]*=r,e[1]*=r}},{key:"_leftPerpendicular",value:function(e){var t=-e[1],r=e[0];e[0]=t,e[1]=r}},{key:"_leftPerp",value:function(e){return[-e[1],e[0]]}},{key:"_rightPerpendicular",value:function(e){var t=e[1],r=-e[0];e[0]=t,e[1]=r}},{key:"_rightPerp",value:function(e){return[e[1],-e[0]]}},{key:"_dotProduct",value:function(e,t){return e[0]*t[0]+e[1]*t[1]}},{key:"_crossProduct",value:function(e,t){return e[0]*t[1]-e[1]*t[0]}},{key:"_rotateDirect",value:function(e,t,r){var i=e[0]*t-e[1]*r,n=e[0]*r+e[1]*t;e[0]=i,e[1]=n}},{key:"_makeCtrlPt",value:function(e){var t=[e[0],e[1]];return Re(t,1),t}},{key:"_addAngledTicks",value:function(e,t,r,i){var n=this._sub(r,t);this._normalize(n);var a,s=this._crossProduct(n,this._sub(i,t));a=s>0?this._rightPerp(n):this._leftPerp(n);var o=Math.abs(s)/2,u=[];u.push([t[0]+(a[0]-n[0])*o,t[1]+(a[1]-n[1])*o]),u.push(t),u.push(r),u.push([r[0]+(a[0]+n[0])*o,r[1]+(a[1]+n[1])*o]),e.push(u)}},{key:"_addBezier2",value:function(e,t,r,i,n){if(0!=n--){var a=this._mid(t,r),s=this._mid(r,i),o=this._mid(a,s);this._addBezier2(e,t,a,o,n),this._addBezier2(e,o,s,i,n)}else e.push(i)}},{key:"_addBezier3",value:function(e,t,r,i,n,a){if(0!=a--){var s=this._mid(t,r),o=this._mid(r,i),u=this._mid(i,n),l=this._mid(s,o),h=this._mid(o,u),c=this._mid(l,h);this._addBezier3(e,t,s,l,c,a),this._addBezier3(e,c,h,u,n,a)}else e.push(n)}},{key:"_add90DegArc",value:function(e,t,r,i,n){var a=null!=n?n:this._crossProduct(this._sub(r,t),this._sub(i,t))>0,s=this._mid(t,r),o=this._sub(s,t);a?this._leftPerpendicular(o):this._rightPerpendicular(o),s[0]+=o[0],s[1]+=o[1],this._addBezier3(e,t,this._mix(t,.33333,s,.66667),this._mix(r,.33333,s,.66667),r,4)}},{key:"_addArrow",value:function(e,t,r){var i=t[0],n=t[1],a=t[t.length-1],s=this._sub(i,n);this._normalize(s);var o=this._crossProduct(s,this._sub(a,n)),u=.5*o,l=this._leftPerp(s),h=[a[0]-l[0]*o,a[1]-l[1]*o],c=t.length-1,f=[];f.push(r?[-l[0],-l[1]]:l);for(var v=[-s[0],-s[1]],p=1;p<c-1;p++){var d=this._sub(t[p+1],t[p]);this._normalize(d);var y=this._dotProduct(d,v),_=this._crossProduct(d,v),m=Math.sqrt((1+y)/2),g=this._sub(d,v);this._normalize(g),g[0]/=m,g[1]/=m,f.push(_<0?[-g[0],-g[1]]:g),v=d}f.push(this._rightPerp(v));for(var x=f.length-1;x>0;x--)e.push([t[x][0]+f[x][0]*u,t[x][1]+f[x][1]*u]);e.push([h[0]+f[0][0]*u,h[1]+f[0][1]*u]),e.push([h[0]+f[0][0]*o,h[1]+f[0][1]*o]),e.push(i),e.push([h[0]-f[0][0]*o,h[1]-f[0][1]*o]),e.push([h[0]-f[0][0]*u,h[1]-f[0][1]*u]);for(var k=1;k<f.length;k++)e.push([t[k][0]-f[k][0]*u,t[k][1]-f[k][1]*u])}},{key:"_cp2",value:function(e,t,r){return e.length>=2?e[1]:this._add2(e[0],t*this._default_size,r*this._default_size)}},{key:"_cp3",value:function(e,t,r,i){if(e.length>=3)return e[2];var n=this._mix(e[0],1-r,t,r),a=this._sub(t,e[0]);return this._normalize(a),this._rightPerpendicular(a),[n[0]+a[0]*i*this._default_size,n[1]+a[1]*i*this._default_size]}},{key:"_arrowPath",value:function(e){if(e.length>2)return e;var t=e[0],r=this._cp2(e,-4,0),i=this._sub(t,r);this._normalize(i);var n=this._rightPerp(i);return[t,r,[t[0]+(n[0]-i[0])*this._default_size,t[1]+(n[1]-i[1])*this._default_size]]}},{key:"_arrowLastSeg",value:function(e){var t,r=e[0],i=this._cp2(e,-4,0);if(e.length>=3)t=e[e.length-1];else{var n=this._sub(r,i);this._normalize(n);var a=this._rightPerp(n);t=[r[0]+(a[0]-n[0])*this._default_size,r[1]+(a[1]-n[1])*this._default_size]}return[i,t]}},{key:"_processGeom",value:function(e){if(!e)return null;var t,r=[],n=(0,i.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a&&0!==a.length){var s=a.length,o=a[0];switch(this._rule){case ee.Em.PerpendicularFromFirstSegment:var u=this._cp2(a,0,-1),l=this._cp3(a,u,.5,4),h=[];h.push(l),h.push(this._mid(o,u)),r.push(h);break;case ee.Em.ReversedFirstSegment:var c=this._cp2(a,0,-1);r.push([c,o]);break;case ee.Em.PerpendicularToSecondSegment:var f=this._cp2(a,-4,1),v=this._cp3(a,f,.882353,-1.94),p=[];p.push(this._mid(f,v)),p.push(o),r.push(p);break;case ee.Em.SecondSegmentWithTicks:var d=this._cp2(a,-4,1),y=this._cp3(a,d,.882353,-1.94),_=this._sub(y,d),m=void 0;m=this._crossProduct(_,this._sub(o,d))>0?this._rightPerp(m):this._leftPerp(_);var g=[];g.push([d[0]+(m[0]-_[0])/3,d[1]+(m[1]-_[1])/3]),g.push(d),g.push(y),g.push([y[0]+(m[0]+_[0])/3,y[1]+(m[1]+_[1])/3]),r.push(g);break;case ee.Em.DoublePerpendicular:var x=this._cp2(a,0,-1),k=this._cp3(a,x,.5,3),b=this._mid(o,x),M=this._sub(b,k);this._normalize(M);var S=this._crossProduct(M,this._sub(o,k));this._leftPerpendicular(M);var w=[];w.push(o),w.push([k[0]+M[0]*S,k[1]+M[1]*S]),r.push(w);var P=[];P.push([k[0]-M[0]*S,k[1]-M[1]*S]),P.push(x),r.push(P);break;case ee.Em.OppositeToFirstSegment:var C=this._cp2(a,0,-1),Z=this._cp3(a,C,.5,3),L=this._mid(o,C),I=this._sub(L,Z);this._normalize(I);var T=this._crossProduct(I,this._sub(o,Z));this._leftPerpendicular(I);var z=[];z.push([Z[0]+I[0]*T,Z[1]+I[1]*T]),z.push([Z[0]-I[0]*T,Z[1]-I[1]*T]),r.push(z);break;case ee.Em.TriplePerpendicular:var E=this._cp2(a,0,-1),F=this._cp3(a,E,.5,4),A=this._mid(o,E),R=this._sub(A,F);this._normalize(R);var O=this._crossProduct(R,this._sub(o,F));this._leftPerpendicular(R);var W=[];W.push([F[0]+R[0]*O*.8,F[1]+R[1]*O*.8]),W.push([A[0]+.8*(o[0]-A[0]),A[1]+.8*(o[1]-A[1])]),r.push(W),r.push([F,A]);var N=[];N.push([F[0]-R[0]*O*.8,F[1]-R[1]*O*.8]),N.push([A[0]+.8*(E[0]-A[0]),A[1]+.8*(E[1]-A[1])]),r.push(N);break;case ee.Em.HalfCircleFirstSegment:var V=this._cp2(a,0,-1),G=this._cp3(a,V,.5,4),D=this._mid(o,V),B=this._sub(V,o),X=Math.cos(Math.PI/18),U=Math.sin(Math.PI/18),H=Math.sqrt((1+X)/2),Y=Math.sqrt((1-X)/2),J=[],q=void 0;this._crossProduct(B,this._sub(G,o))>0?(J.push(o),B=this._sub(o,D),q=V):(J.push(V),B=this._sub(V,D),q=o),this._rotateDirect(B,H,Y),B[0]/=H,B[1]/=H;for(var K=1;K<=18;K++)J.push(this._add(D,B)),this._rotateDirect(B,X,U);J.push(q),r.push(J);break;case ee.Em.HalfCircleSecondSegment:var $=this._cp2(a,0,-1),Q=this._cp3(a,$,1,-1),te=this._sub(o,$);this._normalize(te);var re=this._crossProduct(te,this._sub(Q,$))/2;this._leftPerpendicular(te);var ie=[$[0]+te[0]*re,$[1]+te[1]*re];te=this._sub($,ie);var ne=Math.cos(Math.PI/18),ae=Math.sin(Math.PI/18);re>0&&(ae=-ae);for(var se=[$],oe=1;oe<=18;oe++)this._rotateDirect(te,ne,ae),se.push(this._add(ie,te));r.push(se);break;case ee.Em.HalfCircleExtended:var ue=this._cp2(a,0,-2),le=this._cp3(a,ue,1,-1),he=void 0;if(s>=4)he=a[3];else{var ce=this._sub(o,ue);he=this._add(le,ce)}var fe=this._dist(ue,le)/2/.75,ve=this._sub(ue,o);this._normalize(ve,fe);var pe=this._sub(le,he);this._normalize(pe,fe);var de=[he,le];r.push(de);var ye=[this._clone(le)];this._addBezier3(ye,le,this._add(le,pe),this._add(ue,ve),ue,4),ye.push(o),r.push(ye);break;case ee.Em.OpenCircle:for(var _e=this._cp2(a,-2,0),me=this._sub(_e,o),ge=Math.cos(Math.PI/18),xe=-Math.sin(Math.PI/18),ke=[_e],be=1;be<=33;be++)this._rotateDirect(me,ge,xe),ke.push(this._add(o,me));r.push(ke);break;case ee.Em.CoverageEdgesWithTicks:var Me=this._cp2(a,0,-1),Se=void 0,we=void 0;if(s>=3)Se=a[2];else{var Pe=this._sub(Me,o),Ce=this._leftPerp(Pe);Se=[o[0]+Ce[0]-.25*Pe[0],o[1]+Ce[1]-.25*Pe[1]]}if(s>=4)we=a[3];else{var Ze=this._mid(o,Me),Le=this._sub(o,Me);this._normalize(Le),this._leftPerpendicular(Le);var Ie=this._crossProduct(Le,this._sub(Se,Ze));this._rightPerpendicular(Le),we=[Se[0]+Le[0]*Ie*2,Se[1]+Le[1]*Ie*2]}var Te=this._sub(Me,o),ze=void 0,Ee=void 0;ze=this._crossProduct(Te,this._sub(Se,o))>0?this._rightPerp(Te):this._leftPerp(Te),(Ee=[]).push(Se),Ee.push(o),Ee.push([o[0]+(ze[0]-Te[0])/3,o[1]+(ze[1]-Te[1])/3]),r.push(Ee),ze=this._crossProduct(Te,this._sub(we,Me))>0?this._rightPerp(ze):this._leftPerp(Te),(Ee=[]).push([Me[0]+(ze[0]+Te[0])/3,Me[1]+(ze[1]+Te[1])/3]),Ee.push(Me),Ee.push(we),r.push(Ee);break;case ee.Em.GapExtentWithDoubleTicks:var Fe=this._cp2(a,0,2),Ae=this._cp3(a,Fe,0,1),Oe=void 0;if(s>=4)Oe=a[3];else{var We=this._sub(Fe,o);Oe=this._add(Ae,We)}this._addAngledTicks(r,o,Fe,this._mid(Ae,Oe)),this._addAngledTicks(r,Ae,Oe,this._mid(o,Fe));break;case ee.Em.GapExtentMidline:var Ne=this._cp2(a,2,0),Ve=this._cp3(a,Ne,0,1),Ge=void 0;if(s>=4)Ge=a[3];else{var De=this._sub(Ne,o);Ge=this._add(Ve,De)}var Be=[];Be.push(this._mid(o,Ve)),Be.push(this._mid(Ne,Ge)),r.push(Be);break;case ee.Em.Chevron:var Xe=this._cp2(a,-1,-1),Ue=void 0;if(s>=3)Ue=a[2];else{var He=this._sub(Xe,o);this._leftPerpendicular(He),Ue=this._add(o,He)}r.push([Xe,this._makeCtrlPt(o),Ue]);break;case ee.Em.PerpendicularWithArc:var Ye=this._cp2(a,0,-2),Je=this._cp3(a,Ye,.5,-1),qe=this._sub(Ye,o),Ke=this._norm(qe);qe[0]/=Ke,qe[1]/=Ke;var je=this._crossProduct(qe,this._sub(Je,o)),$e=this._dotProduct(qe,this._sub(Je,o));$e<.05*Ke?$e=.05*Ke:$e>.95*Ke&&($e=.95*Ke);var Qe=[o[0]+qe[0]*$e,o[1]+qe[1]*$e];this._leftPerpendicular(qe);var et=[];et.push([Qe[0]-qe[0]*je,Qe[1]-qe[1]*je]),et.push([Qe[0]+qe[0]*je,Qe[1]+qe[1]*je]),r.push(et);var tt=[Ye[0]+qe[0]*je,Ye[1]+qe[1]*je];qe=this._sub(Ye,tt);var rt=Math.cos(Math.PI/18),it=Math.sin(Math.PI/18);je<0&&(it=-it),et=[o,Ye];for(var nt=1;nt<=9;nt++)this._rotateDirect(qe,rt,it),et.push(this._add(tt,qe));r.push(et);break;case ee.Em.ClosedHalfCircle:for(var at=this._cp2(a,2,0),st=this._mid(o,at),ot=this._sub(at,st),ut=Math.cos(Math.PI/18),lt=Math.sin(Math.PI/18),ht=[o,at],ct=1;ct<=18;ct++)this._rotateDirect(ot,ut,lt),ht.push(this._add(st,ot));r.push(ht);break;case ee.Em.TripleParallelExtended:var ft=this._cp2(a,0,-2),vt=this._cp3(a,ft,1,-2),pt=this._mid(o,ft),dt=this._sub(vt,ft);this._normalize(dt);var yt=Math.abs(this._crossProduct(dt,this._sub(pt,ft)))/2,_t=this._dist(ft,vt),mt=[ft,o];mt.push([o[0]+dt[0]*_t*.5,o[1]+dt[1]*_t*.5]),r.push(mt);var gt=[];gt.push([pt[0]-dt[0]*yt,pt[1]-dt[1]*yt]),gt.push([pt[0]+dt[0]*_t*.375,pt[1]+dt[1]*_t*.375]),Re(gt[gt.length-1],1),gt.push([pt[0]+dt[0]*_t*.75,pt[1]+dt[1]*_t*.75]),r.push(gt);var xt=[ft,vt];r.push(xt);break;case ee.Em.ParallelWithTicks:var kt=this._cp2(a,3,0),bt=this._cp3(a,kt,.5,-1),Mt=this._sub(bt,kt);this._normalize(Mt);var St=this._crossProduct(Mt,this._sub(bt,o));this._leftPerpendicular(Mt),this._addAngledTicks(r,o,kt,bt),this._addAngledTicks(r,this._mix(o,1,Mt,St),this._mix(kt,1,Mt,St),this._mid(o,kt));break;case ee.Em.Parallel:var wt=this._cp2(a,3,0),Pt=this._cp3(a,wt,.5,-1),Ct=this._sub(wt,o);this._normalize(Ct);var Zt=this._leftPerp(Ct),Lt=this._crossProduct(Ct,this._sub(Pt,o)),It=[o,wt];r.push(It),(It=[]).push([o[0]+Zt[0]*Lt,o[1]+Zt[1]*Lt]),It.push([wt[0]+Zt[0]*Lt,wt[1]+Zt[1]*Lt]),r.push(It);break;case ee.Em.PerpendicularToFirstSegment:var Tt=this._cp2(a,3,0),zt=this._cp3(a,Tt,.5,-1),Et=this._mid(o,Tt),Ft=this._sub(Tt,o);this._normalize(Ft);var At=this._crossProduct(Ft,this._sub(zt,o));this._leftPerpendicular(Ft);var Rt=[];Rt.push([Et[0]-Ft[0]*At*.25,Et[1]-Ft[1]*At*.25]),Rt.push([Et[0]+Ft[0]*At*1.25,Et[1]+Ft[1]*At*1.25]),r.push(Rt);break;case ee.Em.ParallelOffset:var Ot=this._cp2(a,3,0),Wt=this._cp3(a,Ot,.5,-1),Nt=this._sub(Ot,o);this._normalize(Nt);var Vt=this._crossProduct(Nt,this._sub(Wt,o));this._leftPerpendicular(Nt);var Gt=[];Gt.push([o[0]-Nt[0]*Vt,o[1]-Nt[1]*Vt]),Gt.push([Ot[0]-Nt[0]*Vt,Ot[1]-Nt[1]*Vt]),r.push(Gt);var Dt=[];Dt.push([o[0]+Nt[0]*Vt,o[1]+Nt[1]*Vt]),Dt.push([Ot[0]+Nt[0]*Vt,Ot[1]+Nt[1]*Vt]),r.push(Dt);break;case ee.Em.OffsetOpposite:var Bt=this._cp2(a,3,0),Xt=this._cp3(a,Bt,.5,-1),Ut=this._sub(Bt,o);this._normalize(Ut);var Ht=this._crossProduct(Ut,this._sub(Xt,o));this._leftPerpendicular(Ut);var Yt=[];Yt.push([o[0]-Ut[0]*Ht,o[1]-Ut[1]*Ht]),Yt.push([Bt[0]-Ut[0]*Ht,Bt[1]-Ut[1]*Ht]),r.push(Yt);break;case ee.Em.OffsetSame:var Jt=this._cp2(a,3,0),qt=this._cp3(a,Jt,.5,-1),Kt=this._sub(Jt,o);this._normalize(Kt);var jt=this._crossProduct(Kt,this._sub(qt,o));this._leftPerpendicular(Kt);var $t=[];$t.push([o[0]+Kt[0]*jt,o[1]+Kt[1]*jt]),$t.push([Jt[0]+Kt[0]*jt,Jt[1]+Kt[1]*jt]),r.push($t);break;case ee.Em.CircleWithArc:var Qt=this._cp2(a,3,0),er=this._cp3(a,Qt,.5,-1),tr=void 0,rr=void 0;if(s>=4)tr=a[3],rr=this._crossProduct(this._sub(tr,Qt),this._sub(er,Qt))>0;else{tr=Qt,rr=this._crossProduct(this._sub(tr,o),this._sub(er,o))>0;var ir=24*this._geomUnitsPerPoint,nr=this._sub(tr,o);this._normalize(nr,ir);var ar=Math.sqrt(2)/2;this._rotateDirect(nr,ar,rr?ar:-ar),Qt=this._add(o,nr)}for(var sr=this._sub(Qt,o),or=Math.cos(Math.PI/18),ur=Math.sin(Math.PI/18),lr=[Qt],hr=1;hr<=36;hr++)this._rotateDirect(sr,or,ur),lr.push(this._add(o,sr));this._add90DegArc(lr,Qt,tr,er,rr),Re(lr[lr.length-8],1),r.push(lr);break;case ee.Em.DoubleJog:var cr=void 0,fr=void 0,vr=this._cp2(a,-3,1);if(cr=s>=3?a[2]:this._add(o,this._sub(o,vr)),s>=4)fr=a[3];else{var pr=o;o=vr,fr=cr;var dr=this._dist(o,pr),yr=this._dist(fr,pr),_r=30*this._geomUnitsPerPoint;.5*dr<_r&&(_r=.5*dr),.5*yr<_r&&(_r=.5*yr),vr=this._mix(o,_r/dr,pr,(dr-_r)/dr),cr=this._mix(fr,_r/yr,pr,(yr-_r)/yr)}var mr=this._mid(o,vr),gr=this._mid(fr,cr),xr=this._dist(o,vr),kr=this._dist(cr,fr),br=Math.min(xr,kr)/8;br=Math.min(br,24*this._geomUnitsPerPoint);var Mr=Math.cos(Math.PI/4),Sr=this._sub(o,vr);this._normalize(Sr,br),this._crossProduct(Sr,this._sub(fr,vr))>0?this._rotateDirect(Sr,Mr,-Mr):this._rotateDirect(Sr,Mr,Mr);var wr=[];wr.push(vr),wr.push(this._add(mr,Sr)),wr.push(this._sub(mr,Sr)),wr.push(o),r.push(wr),Sr=this._sub(fr,cr),this._normalize(Sr,br),this._crossProduct(Sr,this._sub(o,cr))<0?this._rotateDirect(Sr,Mr,Mr):this._rotateDirect(Sr,Mr,-Mr),(wr=[]).push(cr),wr.push(this._add(gr,Sr)),wr.push(this._sub(gr,Sr)),wr.push(fr),r.push(wr);break;case ee.Em.PerpendicularOffset:var Pr=this._cp2(a,-4,1),Cr=this._cp3(a,Pr,.882353,-1.94),Zr=this._sub(Cr,Pr);this._crossProduct(Zr,this._sub(o,Pr))>0?this._rightPerpendicular(Zr):this._leftPerpendicular(Zr);var Lr=[Zr[0]/8,Zr[1]/8],Ir=this._sub(this._mid(Pr,Cr),Lr);r.push([Ir,o]);break;case ee.Em.LineExcludingLastSegment:for(var Tr=this._arrowPath(a),zr=[],Er=Tr.length-2;Er--;)zr.push(Tr[Er]);r.push(zr);break;case ee.Em.MultivertexArrow:var Fr=this._arrowPath(a),Ar=[];this._addArrow(Ar,Fr,!1),r.push(Ar);break;case ee.Em.CrossedArrow:var Rr=this._arrowPath(a),Or=[];this._addArrow(Or,Rr,!0),r.push(Or);break;case ee.Em.ChevronArrow:var Wr=this._arrowLastSeg(a),Nr=(0,j.Z)(Wr,2),Vr=Nr[0],Gr=Nr[1],Dr=10*this._geomUnitsPerPoint,Br=this._sub(o,Vr);this._normalize(Br);var Xr=this._crossProduct(Br,this._sub(Gr,Vr)),Ur=this._leftPerp(Br),Hr=[Gr[0]-Ur[0]*Xr*2,Gr[1]-Ur[1]*Xr*2],Yr=[];Yr.push([Gr[0]+Br[0]*Dr,Gr[1]+Br[1]*Dr]),Yr.push(o),Yr.push([Hr[0]+Br[0]*Dr,Hr[1]+Br[1]*Dr]),r.push(Yr);break;case ee.Em.ChevronArrowOffset:var Jr=this._arrowLastSeg(a),qr=(0,j.Z)(Jr,2),Kr=qr[0],jr=qr[1],$r=this._sub(o,Kr);this._normalize($r);var Qr=this._crossProduct($r,this._sub(jr,Kr));this._leftPerpendicular($r);var ei=[jr[0]-$r[0]*Qr,jr[1]-$r[1]*Qr],ti=[];ti.push([ei[0]+$r[0]*Qr*.5,ei[1]+$r[1]*Qr*.5]),ti.push(this._mid(ei,o)),ti.push([ei[0]-$r[0]*Qr*.5,ei[1]-$r[1]*Qr*.5]),r.push(ti);break;case ee.Em.PartialFirstSegment:var ri=this._arrowLastSeg(a),ii=(0,j.Z)(ri,2),ni=ii[0],ai=ii[1],si=this._sub(o,ni);this._normalize(si);var oi=this._crossProduct(si,this._sub(ai,ni));this._leftPerpendicular(si);var ui=[ai[0]-si[0]*oi,ai[1]-si[1]*oi];r.push([ni,ui]);break;case ee.Em.Arch:var li=this._cp2(a,0,-1),hi=this._cp3(a,li,.5,1),ci=this._sub(o,li),fi=this._mix(hi,1,ci,.55),vi=this._mix(hi,1,ci,-.55),pi=[o];this._addBezier2(pi,o,fi,hi,4),this._addBezier2(pi,hi,vi,li,4),r.push(pi);break;case ee.Em.CurvedParallelTicks:var di=this._cp2(a,-4,1),yi=this._cp3(a,di,.882353,-1.94),_i=this._sub(yi,di);this._crossProduct(_i,this._sub(o,di))>0?this._rightPerpendicular(_i):this._leftPerpendicular(_i);var mi=[_i[0]/8,_i[1]/8],gi=this._sub(this._mid(di,yi),mi),xi=this._sub(this._mix(di,.75,yi,.25),mi),ki=this._sub(this._mix(di,.25,yi,.75),mi),bi=[di];this._addBezier2(bi,di,xi,gi,3),this._addBezier2(bi,gi,ki,yi,3),r.push(bi);for(var Mi=0;Mi<8;Mi++){var Si=bi[2*Mi+1],wi=[this._clone(Si)];wi.push(this._add(Si,[_i[0]/4,_i[1]/4])),r.push(wi)}break;case ee.Em.Arc90Degrees:var Pi=this._cp2(a,0,-1),Ci=this._cp3(a,Pi,.5,1),Zi=[Pi];this._add90DegArc(Zi,Pi,o,Ci),r.push(Zi);break;case ee.Em.FullGeometry:default:r.push(a)}}}}catch(Li){n.e(Li)}finally{n.f()}return r}}]),e}(),Qe=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new tt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Qe.instance=null;var et,tt=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;return(0,a.Z)(this,r),(s=t.call(this,e,!0,!0))._curveHelper=new Xe,s._beginCut=(void 0!==i.beginCut?i.beginCut:1)*n,s._endCut=(void 0!==i.endCut?i.endCut:1)*n,s._middleCut=(void 0!==i.middleCut?i.middleCut:0)*n,s._invert=void 0!==i.invert&&i.invert,s._beginCut<0&&(s._beginCut=0),s._endCut<0&&(s._endCut=0),s._middleCut<0&&(s._middleCut=0),s}return(0,s.Z)(r,[{key:"processPath",value:function(e){var t=this._beginCut,r=this._endCut,i=this._middleCut,n=this._curveHelper.calculatePathLength(e),a=[];if(this._invert)if(0===t&&0===r&&0===i);else if(t+r+i>=n)a.push(e);else{var s=this._curveHelper.getSubCurve(e,0,t);s&&a.push(s),(s=this._curveHelper.getSubCurve(e,.5*(n-i),.5*(n+i)))&&a.push(s),(s=this._curveHelper.getSubCurve(e,n-r,r))&&a.push(s)}else if(0===t&&0===r&&0===i)a.push(e);else if(t+r+i>=n);else if(0===i){var o=this._curveHelper.getSubCurve(e,t,n-r);o&&a.push(o)}else{var u=this._curveHelper.getSubCurve(e,t,.5*(n-i));u&&a.push(u),(u=this._curveHelper.getSubCurve(e,.5*(n+i),n-r))&&a.push(u)}return 0===a.length?null:{paths:a}}}]),r}(We),rt=1e-7,it=function(){function e(){(0,a.Z)(this,e),this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}return(0,s.Z)(e,[{key:"isEmpty",value:function(){return 0===this._values.length}},{key:"size",value:function(){return this._values.length}},{key:"init",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._setEmpty(),!e||0===e.length)return!1;for(var i=0;i<e.length;i++){var n=Math.abs(e[i]);r&&n<rt&&(n=rt),this._values.push(n),this._length+=n}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}},{key:"scale",value:function(e){for(var t=this._values?this._values.length:0,r=0;r<t;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}},{key:"addValue",value:function(e){this._length+=e,this._values.push(e)}},{key:"firstValue",value:function(){return this._values[0]}},{key:"lastValue",value:function(){return this._values[this._values.length-1]}},{key:"nextValue",value:function(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}},{key:"reset",value:function(){this._currentValue=-1}},{key:"length",value:function(){return this._length}},{key:"_setEmpty",value:function(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}]),e}();!function(e){e[e.FAIL=0]="FAIL",e[e.END=1]="END",e[e.CONTINUE=2]="CONTINUE"}(et||(et={}));var nt=function(){function e(){(0,a.Z)(this,e),this.reset()}return(0,s.Z)(e,[{key:"reset",value:function(){this.segment=-1,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}},{key:"isValid",value:function(){return-1!==this.segment}},{key:"copyTo",value:function(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}]),e}(),at=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.Z)(this,r),(e=t.call(this,i,n))._tolerance=De,e._currentPosition=new nt,e}return(0,s.Z)(r,[{key:"updateTolerance",value:function(e){this._tolerance=De*e}},{key:"init",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return r?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._path=e,this._seg=-1,this._setPosAtNextPart()}},{key:"curPositionIsValid",value:function(){return this._currentPosition.isValid()}},{key:"nextPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:et.FAIL,r=new nt;return!!this._nextPosition(e,r,null,t)&&(r.copyTo(this._currentPosition),!0)}},{key:"curPointAndAngle",value:function(e){e.pt=this._getPoint(this._currentPosition);var t=this._getAngle(this._currentPosition),r=(0,j.Z)(t,2),i=r[0],n=r[1];e.ca=i,e.sa=n}},{key:"nextPointAndAngle",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:et.FAIL,i=new nt;if(!this._nextPosition(e,i,null,r))return!1;i.copyTo(this._currentPosition),t.pt=this._getPoint(i);var n=this._getAngle(i),a=(0,j.Z)(n,2),s=a[0],o=a[1];return t.ca=s,t.sa=o,!0}},{key:"nextCurve",value:function(e){if(0===e)return null;var t=[],r=new nt;return this._nextPosition(e,r,t,et.END)?(r.copyTo(this._currentPosition),t):null}},{key:"isPathEnd",value:function(){return this._currentPosition.isPathEnd}},{key:"getPathEnd",value:function(){if(-1===this._currentPosition.segment)throw new Error("missing segment");return this._path[this._currentPosition.segment+1]}},{key:"_nextPosition",value:function(e,t,r,i){if(this._currentPosition.isPathEnd)return!1;var n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(r){if(0===r.length)if(0===n){var a=this._path[t.segment];r.push([a[0],a[1]])}else r.push(this.getSegCoord2D(this._path,t.segment,n));var s=this._path[t.segment+1];r.push([s[0],s[1]])}if(n=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.calculateSegLength(this._path,t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return i!==et.FAIL&&(t.segmentLength=this.calculateSegLength(this._path,t.segment),t.isPartEnd=!0,i===et.END?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,r){if(0===r.length)if(0===n){var o=this._path[t.segment];r.push([o[0],o[1]])}else r.push(this.getSegCoord2D(this._path,t.segment,n));var u=t.abscissa/t.segmentLength;if(1===u){var l=this._path[t.segment+1];r.push([l[0],l[1]])}else r.push(this.getSegCoord2D(this._path,t.segment,u))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}},{key:"_getPoint",value:function(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._path,e.segment,t)}},{key:"_getAngle",value:function(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._path,e.segment,t)}},{key:"_setPosAtNextPart",value:function(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this._nextSegment()),this._partSegCount++,1===Ae(this._path[this._getEndPointIndex()])){this._partIsLast=!this._hasNextSegment();break}for(var e=this._partSegCount;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;var t=this._getStartPointIndex();this._ctrlPtBegin=1===Ae(this._path[t]);var r=t+this._partSegCount+1;if(r>=this._path.length&&(r=0),this._ctrlPtEnd=1===Ae(this._path[r]),this._patternLength>0){var i=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,n=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap,a=Math.round((this._partLength-(i+n))/this._patternLength);a<=0&&(a=i+n>0?0:1),this._partLengthRatio=this._partLength/(i+n+a*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}},{key:"_hasNextSegment",value:function(){return this._seg<this._path.length-2}},{key:"_previousSegment",value:function(){return--this._seg}},{key:"_nextSegment",value:function(){return++this._seg}},{key:"_getStartPointIndex",value:function(){return this._seg}},{key:"_getEndPointIndex",value:function(){return this._seg+1}}]),r}(Xe),st=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new ot(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();st.instance=null;var ot=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s,o,u;return(0,a.Z)(this,r),(s=t.call(this,e,!0,!0))._walker=new at,s._walker.updateTolerance(n),s._endings=i.lineDashEnding,s._customDashPos=-(null!=(o=i.offsetAlongLine)?o:0)*n,s._offsetAtEnd=(null!=(u=i.customEndingOffset)?u:0)*n,s._pattern=new it,s._pattern.init(i.dashTemplate,!0),s._pattern.scale(n),s}return(0,s.Z)(r,[{key:"processPath",value:function(e){if(0===this._pattern.length())return this.iteratePath=!1,{paths:[e]};if(!this.iteratePath){var t=!0;switch(this._endings){case ee.sj.HalfPattern:case ee.sj.HalfGap:default:this._pattern.extPtGap=0;break;case ee.sj.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case ee.sj.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case ee.sj.NoConstraint:this.isClosed||(t=!1);break;case ee.sj.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var r=this._walker.calculatePathLength(e);if(this._pattern.isEmpty()||r<.1*this._pattern.length())return{paths:[e]};if(!this._walker.init(e,this._pattern,t))return{paths:[e]}}var i;if(this.iteratePath)i=this._pattern.nextValue();else{var n;switch(this._endings){case ee.sj.HalfPattern:default:n=.5*this._pattern.firstValue();break;case ee.sj.HalfGap:n=.5*-this._pattern.lastValue();break;case ee.sj.FullGap:n=-this._pattern.lastValue();break;case ee.sj.FullPattern:n=0;break;case ee.sj.NoConstraint:case ee.sj.Custom:n=-this._customDashPos}var a=n/this._pattern.length();n=(a-=Math.floor(a))*this._pattern.length(),this._pattern.reset(),i=this._pattern.nextValue();for(var s=!1;n>=i;)n-=i,i=this._pattern.nextValue(),s=!s;i-=n,s?(this._walker.nextPosition(i),i=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(i),i=this._pattern.nextValue(),this._walker.nextPosition(i),i=this._pattern.nextValue())}var o=this._walker.nextCurve(i);return o?this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(this._firstCurve.splice(0,1),Be.mergePath(o,this._firstCurve),this._firstCurve=null)):(i=this._pattern.nextValue(),!this._walker.nextPosition(i)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(o=this._firstCurve,this._firstCurve=null)):this.iteratePath=!0):(this.iteratePath=!1,o=this._firstCurve,this._firstCurve=null),{paths:[o]}}}]),r}(We),ut=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new lt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();ut.instance=null;var lt=function(){function e(t,r,i){switch((0,a.Z)(this,e),this._inputGeometries=t,this._curveHelper=new Xe,this._width=(void 0!==r.width?r.width:2)*i,r.method){case ee.$y.Mitered:default:this._method=ee.id.Mitered;break;case ee.$y.Bevelled:this._method=ee.id.Bevelled;break;case ee.$y.Rounded:case ee.$y.TrueBuffer:this._method=ee.id.Rounded;break;case ee.$y.Square:this._method=ee.id.Square}this._option=r.option,this._offsetFlattenError=De*i}return(0,s.Z)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if((0,be.YX)(e)&&this._width>0){if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0)return e;var t=[];return t.push([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t.push([[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]]),{rings:t}}if((0,be.oU)(e)&&this._width>0){var r,n=[],a=(0,i.Z)(e.rings);try{for(a.s();!(r=a.n()).done;){var s=r.value,o=this._curveHelper.calculatePathLength(s),u=this._curveHelper.offset(s,this._width,this._method,4,this._offsetFlattenError);u&&(o<0&&u.reverse(),n.push(u))}}catch(l){a.e(l)}finally{a.f()}if(n.length)return{rings:n}}e=this._inputGeometries.next()}return null}}]),e}(),ht=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new ct(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();ht.instance=null;var ct=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;return(0,a.Z)(this,r),(s=t.call(this,e,!1,!0))._curveHelper=new Xe,s._length=(void 0!==i.length?i.length:20)*n,s._angle=void 0!==i.angle?i.angle:225,s._position=void 0!==i.position?i.position:50,s._length<0&&(s._length=-s._length),s._position<20&&(s._position=20),s._position>80&&(s._position=80),s._mirror=!1,s}return(0,s.Z)(r,[{key:"processPath",value:function(e){if(this._curveHelper.isEmpty(e,!1))return null;var t=e[0],r=e[e.length-1],i=[r[0]-t[0],r[1]-t[1]];this._curveHelper.normalize(i);var n=[t[0]+(r[0]-t[0])*this._position/100,t[1]+(r[1]-t[1])*this._position/100],a=Math.cos((90-this._angle)/180*Math.PI),s=Math.sin((90-this._angle)/180*Math.PI);return this._mirror&&(s=-s),this._mirror=!this._mirror,{paths:[[t,[n[0]-this._length/2*a,n[1]-this._length/2*s],[n[0]+this._length/2*a,n[1]+this._length/2*s],r]]}}}]),r}(We),ft=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new vt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();ft.instance=null;var vt=function(){function e(t,r,i){(0,a.Z)(this,e),this._inputGeometries=t,this._offsetX=void 0!==r.offsetX?r.offsetX*i:0,this._offsetY=void 0!==r.offsetY?-r.offsetY*i:0}return(0,s.Z)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if((0,be.YX)(e))return{xmin:e.xmin+this._offsetX,xmax:e.xmax+this._offsetX,ymin:e.ymin+this._offsetY,ymax:e.ymax+this._offsetY};if((0,be.oU)(e)){var t=(0,ke.d9)(e);return this._moveMultipath(t.rings,this._offsetX,this._offsetY),t}if((0,be.l9)(e)){var r=(0,ke.d9)(e);return this._moveMultipath(r.paths,this._offsetX,this._offsetY),r}if((0,be.aW)(e)){var i=(0,ke.d9)(e);return this._movePath(i.points,this._offsetX,this._offsetY),i}if((0,be.wp)(e))return{x:e.x+this._offsetX,y:e.y+this._offsetY};e=this._inputGeometries.next()}return null}},{key:"_moveMultipath",value:function(e,t,r){if(e){var n,a=(0,i.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;this._movePath(s,t,r)}}catch(o){a.e(o)}finally{a.f()}}}},{key:"_movePath",value:function(e,t,r){if(e){var n,a=(0,i.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;s[0]+=t,s[1]+=r}}catch(o){a.e(o)}finally{a.f()}}}}]),e}(),pt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new dt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();pt.instance=null;var dt=function(){function e(t,r,i){var n;(0,a.Z)(this,e),this._inputGeometries=t,this._curveHelper=new Xe,this._offset=(null!=(n=r.offset)?n:1)*i,this._method=r.method,this._option=r.option,this._offsetFlattenError=De*i}return(0,s.Z)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(0===this._offset)return e;if((0,be.YX)(e)){if(this._method===ee.id.Rounded&&this._offset>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],r=this._curveHelper.offset(t,-this._offset,this._method,4,this._offsetFlattenError);return r?{rings:[r]}:null}if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return{xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset}}if((0,be.oU)(e)){var n,a=[],s=(0,i.Z)(e.rings);try{for(s.s();!(n=s.n()).done;){var o=n.value,u=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);u&&a.push(u)}}catch(p){s.e(p)}finally{s.f()}if(a.length)return{rings:a}}if((0,be.l9)(e)){var l,h=[],c=(0,i.Z)(e.paths);try{for(c.s();!(l=c.n()).done;){var f=l.value,v=this._curveHelper.offset(f,-this._offset,this._method,4,this._offsetFlattenError);v&&h.push(v)}}catch(p){c.e(p)}finally{c.f()}if(h.length)return{paths:h}}e=this._inputGeometries.next()}return null}}]),e}(),yt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new _t(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();yt.instance=null;var _t=function(){function e(t,r,i){(0,a.Z)(this,e),this._inputGeometries=t,this._reverse=void 0===r.reverse||r.reverse}return(0,s.Z)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(!this._reverse)return e;if((0,be.l9)(e)){var t=(0,ke.d9)(e);return ze(t.paths),t}e=this._inputGeometries.next()}return null}}]),e}(),mt=r(376),gt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new xt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();gt.instance=null;var xt=function(){function e(t,r,i){(0,a.Z)(this,e),this._inputGeometries=t,this._rotateAngle=void 0!==r.angle?r.angle*Math.PI/180:0}return(0,s.Z)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(0===this._rotateAngle)return e;var t=(0,W.Ue)();(0,mt.$P)(t,e);var r=(t[2]+t[0])/2,i=(t[3]+t[1])/2;if((0,be.YX)(e)){var n={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._rotateMultipath(n.rings,r,i),n}if((0,be.oU)(e)){var a=(0,ke.d9)(e);return this._rotateMultipath(a.rings,r,i),a}if((0,be.l9)(e)){var s=(0,ke.d9)(e);return this._rotateMultipath(s.paths,r,i),s}if((0,be.aW)(e)){var o=(0,ke.d9)(e);return this._rotatePath(o.points,r,i),o}if((0,be.wp)(e))return e;e=this._inputGeometries.next()}return null}},{key:"_rotateMultipath",value:function(e,t,r){if(e){var n,a=(0,i.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;this._rotatePath(s,t,r)}}catch(o){a.e(o)}finally{a.f()}}}},{key:"_rotatePath",value:function(e,t,r){if(e){var n,a=Math.cos(this._rotateAngle),s=Math.sin(this._rotateAngle),o=(0,i.Z)(e);try{for(o.s();!(n=o.n()).done;){var u=n.value,l=u[0]-t,h=u[1]-r;u[0]=t+l*a-h*s,u[1]=r+l*s+h*a}}catch(c){o.e(c)}finally{o.f()}}}}]),e}(),kt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new bt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();kt.instance=null;var bt=function(){function e(t,r,i){(0,a.Z)(this,e),this._inputGeometries=t,this._xFactor=void 0!==r.xScaleFactor?r.xScaleFactor:1.15,this._yFactor=void 0!==r.yScaleFactor?r.yScaleFactor:1.15}return(0,s.Z)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(1===this._xFactor&&1===this._yFactor)return e;var t=(0,W.Ue)();(0,mt.$P)(t,e);var r=(t[2]+t[0])/2,i=(t[3]+t[1])/2;if((0,be.YX)(e)){var n={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._scaleMultipath(n.rings,r,i),n}if((0,be.oU)(e)){var a=(0,ke.d9)(e);return this._scaleMultipath(a.rings,r,i),a}if((0,be.l9)(e)){var s=(0,ke.d9)(e);return this._scaleMultipath(s.paths,r,i),s}if((0,be.aW)(e)){var o=(0,ke.d9)(e);return this._scalePath(o.points,r,i),o}if((0,be.wp)(e))return e;e=this._inputGeometries.next()}return null}},{key:"_scaleMultipath",value:function(e,t,r){if(e){var n,a=(0,i.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;this._scalePath(s,t,r)}}catch(o){a.e(o)}finally{a.f()}}}},{key:"_scalePath",value:function(e,t,r){if(e){var n,a=(0,i.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,o=(s[0]-t)*this._xFactor,u=(s[1]-r)*this._yFactor;s[0]=t+o,s[1]=r+u}}catch(l){a.e(l)}finally{a.f()}}}}]),e}(),Mt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new St(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Mt.instance=null;var St=function(){function e(t,r,i){(0,a.Z)(this,e),this._inputGeometries=t,this._height=(void 0!==r.amplitude?r.amplitude:2)*i,this._period=(void 0!==r.period?r.period:3)*i,this._style=r.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new it,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new at,this._walker.updateTolerance(i)}return(0,s.Z)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(0===this._height||0===this._period)return e;if((0,be.l9)(e)){var t=this._processGeom(e.paths);if(t.length)return{paths:t}}if((0,be.oU)(e)){var r=this._processGeom(e.rings);if(r.length)return{rings:r}}e=this._inputGeometries.next()}return null}},{key:"_processGeom",value:function(e){var t,r=[],n=(0,i.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(this._walker.init(a,this._pattern))switch(this._style){case ee.zQ.Sinus:default:r.push(this._constructCurve(a,!1));break;case ee.zQ.Square:r.push(this._constructSquare(a));break;case ee.zQ.Triangle:r.push(this._constructTriangle(a));break;case ee.zQ.Random:r.push(this._constructCurve(a,!0))}else r.push(a)}}catch(s){n.e(s)}finally{n.f()}return r}},{key:"_constructCurve",value:function(e,t){var r=new Be,i=this._walker.calculatePathLength(e),n=Math.round(i/this._period);0===n&&(n=1);var a=16*n+1,s=i/n,o=this._period/16,u=1/a,l=2*Math.PI*i/s,h=2*Math.PI*Math.random(),c=2*Math.PI*Math.random(),f=2*Math.PI*Math.random(),v=.75-Math.random()/2,p=.75-Math.random()/2,d={};this._walker.curPointAndAngle(d),r.startPath(d.pt);for(var y=0;;){if(!this._walker.nextPointAndAngle(o,d)){r.lineTo(e[e.length-1]);break}var _=y,m=void 0;if(y+=u,t){var g=this._height/2*(1+.3*Math.sin(v*l*_+h));m=g*Math.sin(l*_+c),m+=g*Math.sin(p*l*_+f),m/=2}else m=.5*this._height*Math.sin(.5*l*_);r.lineTo([d.pt[0]-m*d.sa,d.pt[1]+m*d.ca])}return r.path()}},{key:"_constructSquare",value:function(e){var t=new Be,r=this._walker.calculatePathLength(e);Math.round(r/this._period);for(var i=!0;;){var n=!1;if(this._walker.curPositionIsValid()){var a={};this._walker.curPointAndAngle(a);var s={};if(this._walker.nextPointAndAngle(this._period,s)){var o={};this._walker.nextPointAndAngle(this._period,o)&&(i?(t.startPath(a.pt),i=!1):t.lineTo(a.pt),t.lineTo([a.pt[0]-this._height/2*a.sa,a.pt[1]+this._height/2*a.ca]),t.lineTo([s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca]),t.lineTo([s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca]),t.lineTo([o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca]),n=!0)}}if(!n){t.lineTo(this._walker.getPathEnd());break}}return t.path()}},{key:"_constructTriangle",value:function(e){var t=new Be,r=this._walker.calculatePathLength(e);Math.round(r/this._period);for(var i=!0;;){var n=!1;if(this._walker.curPositionIsValid()){var a={};this._walker.curPointAndAngle(a);var s={};if(this._walker.nextPointAndAngle(this._period/2,s)){var o={};this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(i?(t.startPath(a.pt),i=!1):t.lineTo(a.pt),t.lineTo([s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca]),t.lineTo([o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca])),n=!0)}}if(!n){t.lineTo(this._walker.getPathEnd());break}}return t.path()}}]),e}(),wt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new Pt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();wt.instance=null;var Pt=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s,o;return(0,a.Z)(this,r),(s=t.call(this,e,!0,!0))._geometryWalker=new at,s._geometryWalker.updateTolerance(n),s._angleToLine=null==(o=i.angleToLine)||o,s._offset=(i.offset?i.offset:0)*n,s._originalEndings=i.endings,s._offsetAtEnd=(i.customEndingOffset?i.customEndingOffset:0)*n,s._position=-(i.offsetAlongLine?i.offsetAlongLine:0)*n,s._pattern=new it,s._pattern.init(i.placementTemplate,!1),s._pattern.scale(n),s._endings=s._originalEndings,s}return(0,s.Z)(r,[{key:"processPath",value:function(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===ee.JS.WithFullGap&&this.isClosed?this._endings=ee.JS.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;var r,i=!0;switch(this._endings){case ee.JS.NoConstraint:r=-this._position,r=this._adjustPosition(r),i=!1;break;case ee.JS.WithHalfGap:default:r=-this._pattern.lastValue()/2;break;case ee.JS.WithFullGap:r=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case ee.JS.WithMarkers:r=0;break;case ee.JS.Custom:r=-this._position,r=this._adjustPosition(r),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,i))return null;this._pattern.reset();for(var n=0;r>n;)r-=n,n=this._pattern.nextValue();t=n-=r,this.iteratePath=!0}var a={};return this._geometryWalker.nextPointAndAngle(t,a)?this._endings===ee.JS.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===ee.JS.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(a.pt[0]-this._offset*a.sa,a.pt[1]+this._offset*a.ca),this._angleToLine&&this.internalPlacement.setRotateCS(a.ca,a.sa),this.internalPlacement):(this.iteratePath=!1,null)}},{key:"_adjustPosition",value:function(e){var t=e/this._pattern.length();return(t-=Math.floor(t))*this._pattern.length()}}]),r}(Oe),Ct=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new Zt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Ct.instance=null;var Zt=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;return(0,a.Z)(this,r),(s=t.call(this,e,!1,!0))._curveHelper=new Xe,s._angleToLine=void 0===i.angleToLine||i.angleToLine,s._offset=void 0!==i.offset?i.offset*n:0,s._type=i.extremityPlacement,s._position=void 0!==i.offsetAlongLine?i.offsetAlongLine*n:0,s._beginProcessed=!1,s}return(0,s.Z)(r,[{key:"processPath",value:function(e){var t;switch(this._type){case ee.Tx.Both:default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case ee.Tx.JustBegin:t=this._atExtremities(e,this._position,!0);break;case ee.Tx.JustEnd:t=this._atExtremities(e,this._position,!1);case ee.Tx.None:}return t}},{key:"_atExtremities",value:function(e,t,r){var i=e.length;if(i<2)return null;for(var n,a=r?1:i-2,s=r?i:-1,o=r?1:-1,u=0,l=r?e[0]:e[i-1],h=a;h!==s;h+=o){n=l,l=e[h];var c=this._curveHelper.calculateLength(n,l);if(u+c>t){var f=(t-u)/c,v=this._curveHelper.getAngleCS(n,l,f),p=(0,j.Z)(v,2),d=p[0],y=p[1],_=Fe(n,l,f);return this.internalPlacement.setTranslate(_[0]-this._offset*y,_[1]+this._offset*d),this._angleToLine&&this.internalPlacement.setRotateCS(-d,-y),this.internalPlacement}u+=c}return null}}]),r}(Oe),Lt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new It(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Lt.instance=null;var It=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;return(0,a.Z)(this,r),(s=t.call(this,e,!0,!0))._walker=new at,s._walker.updateTolerance(n),s._angleToLine=void 0===i.angleToLine||i.angleToLine,s._offset=void 0!==i.offset?i.offset*n:0,s._beginGap=void 0!==i.beginPosition?i.beginPosition*n:0,s._endGap=void 0!==i.endPosition?i.endPosition*n:0,s._flipFirst=void 0===i.flipFirst||i.flipFirst,s._pattern=new it,s._pattern.init(i.positionArray,!1,!1),s._subPathLen=0,s._posCount=s._pattern.size(),s._isFirst=!0,s._prevPos=0,s}return(0,s.Z)(r,[{key:"processPath",value:function(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath){var r=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+r;t=i-this._prevPos,this._prevPos=i}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=this._walker.calculatePathLength(e)-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();var n=this._pattern.nextValue()*this._subPathLen,a=this._beginGap+n;t=a-this._prevPos,this._prevPos=a,this.iteratePath=!0}var s={};if(!this._walker.nextPointAndAngle(t,s,et.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(s.pt[0]-this._offset*s.sa,s.pt[1]+this._offset*s.ca);var o,u,l=this._isFirst&&this._flipFirst;return this._angleToLine?(o=s.ca,u=s.sa):(o=1,u=0),l&&(o=-o,u=-u),this.internalPlacement.setRotateCS(o,u),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}]),r}(Oe);var Tt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new zt(e,t,r,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Tt.instance=null;var zt=function(){function e(t,r,i,n){if((0,a.Z)(this,e),this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._stepX=(void 0!==r.stepX?Math.abs(r.stepX):16)*i,this._stepY=(void 0!==r.stepY?Math.abs(r.stepY):16)*i,0!==this._stepX&&0!==this._stepY&&t&&function(e){return void 0!==e.rings}(t)&&t.rings){if(this._gridType=void 0!==r.gridType?r.gridType:ee.bj.Fixed,this._gridType===ee.bj.Random)this._randomness=void 0!==r.randomness?r.randomness/100:1,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0;else{if(this._randomness=0,this._gridAngle=void 0!==r.gridAngle?r.gridAngle:0,this._shiftOddRows=void 0!==r.shiftOddRows&&r.shiftOddRows,this._offsetX=void 0!==r.offsetX?r.offsetX*i:0,this._offsetY=void 0!==r.offsetY?r.offsetY*i:0,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginX=0,this._graphicOriginY=0,this._internalPlacement=new Me,this._calculateMinMax(t),this._geometry=t}}return(0,s.Z)(e,[{key:"next",value:function(){return this._geometry?this._nextInside():null}},{key:"_calculateMinMax",value:function(e){var t,r,n,a,s,o,u,l;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,s=o=Number.MAX_VALUE,u=l=-Number.MAX_VALUE;var h,c=(0,i.Z)(e.rings);try{for(c.s();!(h=c.n()).done;)for(var f=h.value,v=f?f.length:0,p=0;p<v;++p)t=f[p][0]-this._graphicOriginX-this._offsetX,r=f[p][1]-this._graphicOriginY-this._offsetY,n=this._cosAngle*t-this._sinAngle*r,a=this._sinAngle*t+this._cosAngle*r,s=Math.min(s,n),u=Math.max(u,n),o=Math.min(o,a),l=Math.max(l,a)}catch(d){c.e(d)}finally{c.f()}s+=this._graphicOriginX,u+=this._graphicOriginX,o+=this._graphicOriginY,l+=this._graphicOriginY,this._xMin=Math.round(s/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(o/this._stepY),this._yMax=Math.round(l/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1}},{key:"_nextInside",value:function(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}var e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);var t=this._currentY*this._stepY+this._offsetY,r=void 0,i=void 0;return this._currentX++,this._gridType===ee.bj.Random?(r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-Math.random())*2/3,i=this._graphicOriginY+t+this._stepY*this._randomness*(.5-Math.random())*2/3):(r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,i=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t),this._internalPlacement.setTranslate(r,i),this._internalPlacement}}}]),e}(),Et=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new Ft(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Et.instance=null;var Ft=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;return(0,a.Z)(this,r),(s=t.call(this,e,!0,!0))._curveHelper=new Xe,s._angleToLine=void 0===i.angleToLine||i.angleToLine,s._offset=void 0!==i.offset?i.offset*n:0,s._relativeTo=i.relativeTo,s._position=void 0!==i.startPointOffset?i.startPointOffset*n:0,s._epsilon=.001*n,s}return(0,s.Z)(r,[{key:"processPath",value:function(e){var t=this._position;if(this._relativeTo===ee.CS.SegmentMidpoint){for(this.iteratePath||(this._segmentCount=e.length,this._curSegment=1,this.iteratePath=!0);this._curSegment<this._segmentCount;){var r=this._curSegment;this._curSegment++;var i=e[r-1],n=e[r],a=this._curveHelper.calculateLength(i,n);if(!(a<this._epsilon)){var s=.5+this._position/a,o=this._curveHelper.getAngleCS(i,n,s),u=(0,j.Z)(o,2),l=u[0],h=u[1],c=Fe(i,n,s);return this.internalPlacement.setTranslate(c[0]-this._offset*h,c[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(l,h),this.internalPlacement}}return this.iteratePath=!1,null}this._relativeTo===ee.CS.LineEnd&&Ee(e);var f=this.onLine(e,t);return this._relativeTo===ee.CS.LineEnd&&Ee(e),f}},{key:"onLine",value:function(e,t){var r,i=!1;switch(this._relativeTo){case ee.CS.LineMiddle:default:r=this._curveHelper.calculatePathLength(e)/2+t;break;case ee.CS.LineBeginning:r=t;break;case ee.CS.LineEnd:r=t,i=!0}for(var n,a=e.length,s=0,o=e[0],u=1;u<a;++u){n=o,o=e[u];var l=this._curveHelper.calculateLength(n,o);if(s+l>r){var h=(r-s)/l,c=this._curveHelper.getAngleCS(n,o,h),f=(0,j.Z)(c,2),v=f[0],p=f[1],d=Fe(n,o,h),y=i?-this._offset:this._offset;return this.internalPlacement.setTranslate(d[0]-y*p,d[1]+y*v),this._angleToLine&&(i?this.internalPlacement.setRotateCS(-v,-p):this.internalPlacement.setRotateCS(v,p)),this.internalPlacement}s+=l}return null}}]),r}(Oe),At=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new Rt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();At.instance=null;var Rt=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;return(0,a.Z)(this,r),(s=t.call(this,e,!0,!0))._curveHelper=new Xe,s._angleToLine=void 0===i.angleToLine||i.angleToLine,s._offset=void 0!==i.offset?i.offset*n:0,s._endPoints=void 0===i.placeOnEndPoints||i.placeOnEndPoints,s._controlPoints=void 0===i.placeOnControlPoints||i.placeOnControlPoints,s._regularVertices=void 0===i.placeOnRegularVertices||i.placeOnRegularVertices,s._tags=[],s._tagIterator=0,s}return(0,s.Z)(r,[{key:"processPath",value:function(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;var t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);var r=t[0],i=t[1];if(0!==this._offset){var n=Math.cos(t[2]),a=Math.sin(t[2]);r-=this._offset*a,i+=this._offset*n}return this.internalPlacement.setTranslate(r,i),this._tagIterator++,this.internalPlacement}},{key:"_preparePath",value:function(e){this._tags.length=0,this._tagIterator=0;for(var t,r,i=function(e){return!(!e||0===e.length)&&e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]}(e),n=e.length-1,a=0,s=0,o=0,u=0,l=0;a<n;){t=e[++a-1],r=e[a];var h=Ae(t),c=Ae(r);(this._angleToLine||0!==this._offset)&&(u=this._curveHelper.getAngle(t,r,0)),1===a?i?(s=u,o=h):(this._endPoints||this._controlPoints&&1===h)&&this._tags.push([t[0],t[1],u]):1===h?this._controlPoints&&this._tags.push([t[0],t[1],Ot(l,u)]):this._regularVertices&&this._tags.push([t[0],t[1],Ot(l,u)]),(this._angleToLine||0!==this._offset)&&(l=this._curveHelper.getAngle(t,r,1)),a===n&&(i?1===c||1===o?this._controlPoints&&this._tags.push([r[0],r[1],Ot(l,s)]):this._regularVertices&&this._tags.push([r[0],r[1],Ot(l,s)]):(this._endPoints||this._controlPoints&&1===c)&&this._tags.push([r[0],r[1],l]))}this._tagIterator=0}}]),r}(Oe);function Ot(e,t){for(var r=Math.PI;Math.abs(t-e)>r+2e-15;)t-e>r?t-=2*r:t+=2*r;return(e+t)/2}var Wt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"execute",value:function(e,t,r,i){return new Nt(e,t,r)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Wt.instance=null;var Nt=function(){function e(t,r,i){(0,a.Z)(this,e),this._geometry=t,this._offsetX=void 0!==r.offsetX?r.offsetX*i:0,this._offsetY=void 0!==r.offsetY?r.offsetY*i:0,this._method=void 0!==r.method?r.method:ee.Lh.OnPolygon,this._internalPlacement=new Me}return(0,s.Z)(e,[{key:"next",value:function(){var e=this._geometry;return this._geometry=null,e&&function(e){return void 0!==e.rings}(e)?this._polygonCenter(e):null}},{key:"_polygonCenter",value:function(e){switch(this._method){case ee.Lh.OnPolygon:case ee.Lh.CenterOfMass:case ee.Lh.BoundingBoxCenter:}var t=(0,W.Ue)();return(0,mt.$P)(t,e),this._internalPlacement.setTranslate((t[2]+t[0])/2+this._offsetX,(t[3]+t[1])/2+this._offsetY),!0?this._internalPlacement:null}}]),e}();function Vt(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return Ve.local();case"CIMGeometricEffectArrow":return Ye.local();case"CIMGeometricEffectBuffer":return qe.local();case"CIMGeometricEffectControlMeasureLine":return je.local();case"CIMGeometricEffectCut":return Qe.local();case"CIMGeometricEffectDashes":return st.local();case"CIMGeometricEffectDonut":return ut.local();case"CIMGeometricEffectJog":return ht.local();case"CIMGeometricEffectMove":return ft.local();case"CIMGeometricEffectOffset":return pt.local();case"CIMGeometricEffectReverse":return yt.local();case"CIMGeometricEffectRotate":return gt.local();case"CIMGeometricEffectScale":return kt.local();case"CIMGeometricEffectWave":return Mt.local()}return null}function Gt(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return wt.local();case"CIMMarkerPlacementAtExtremities":return Ct.local();case"CIMMarkerPlacementAtRatioPositions":return Lt.local();case"CIMMarkerPlacementInsidePolygon":return Tt.local();case"CIMMarkerPlacementOnLine":return Et.local();case"CIMMarkerPlacementOnVertices":return At.local();case"CIMMarkerPlacementPolygonCenter":return Wt.local()}return null}var Dt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,null,[{key:"getPlacement",value:function(e,t,r,i){var n=Gt(t);if(!n)return null;var a=Se(e);return n.execute(a,t,r,i)}}]),e}(),Bt=r(26277);function Xt(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=r[0],h=r[1],c=r[2],f=r[3],v=r[4],p=r[5];return e[0]=i*l+a*h,e[1]=n*l+s*h,e[2]=i*c+a*f,e[3]=n*c+s*f,e[4]=i*v+a*p+o,e[5]=n*v+s*p+u,e}function Ut(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=Math.sin(r),h=Math.cos(r);return e[0]=i*h+a*l,e[1]=n*h+s*l,e[2]=i*-l+a*h,e[3]=n*-l+s*h,e[4]=o,e[5]=u,e}function Ht(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=r[0],h=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=s,e[4]=i*l+a*h+o,e[5]=n*l+s*h+u,e}function Yt(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function Jt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function qt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}var Kt=Xt,jt=qt;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},set:function(e,t,r,i,n,a,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e},invert:function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],u=r*a-i*n;return u?(u=1/u,e[0]=a*u,e[1]=-i*u,e[2]=-n*u,e[3]=r*u,e[4]=(n*o-a*s)*u,e[5]=(i*s-r*o)*u,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:Xt,rotate:Ut,scale:function(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=r[0],h=r[1];return e[0]=i*l,e[1]=n*l,e[2]=a*h,e[3]=s*h,e[4]=o,e[5]=u,e},translate:Ht,fromRotation:Yt,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:Jt,str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},subtract:qt,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],u=t[0],l=t[1],h=t[2],c=t[3],f=t[4],v=t[5];return Math.abs(r-u)<=Bt.E*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-l)<=Bt.E*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-h)<=Bt.E*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-c)<=Bt.E*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(s-f)<=Bt.E*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-v)<=Bt.E*Math.max(1,Math.abs(o),Math.abs(v))},mul:Kt,sub:jt});function $t(){var e=new Float32Array(6);return e[0]=1,e[3]=1,e}function Qt(e,t,r,i){var n=t[i],a=t[i+1];e[i]=r[0]*n+r[2]*a+r[4],e[i+1]=r[1]*n+r[3]*a+r[5]}function er(e,t,r){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,s=n||t.length/a,o=i;o<s;o++)Qt(e,t,r,o*a)}Object.freeze({__proto__:null,create:$t,clone:function(e){var t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},fromValues:function(e,t,r,i,n,a){var s=new Float32Array(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=n,s[5]=a,s},createView:function(e,t){return new Float32Array(e,t,6)},transform:Qt,transformMany:er});function tr(){return new Float32Array(2)}function rr(e,t){var r=new Float32Array(2);return r[0]=e,r[1]=t,r}function ir(){return tr()}function nr(){return rr(1,1)}function ar(){return rr(1,0)}function sr(){return rr(0,1)}var or=ir(),ur=nr(),lr=ar(),hr=sr(),cr=(Object.freeze({__proto__:null,create:tr,clone:function(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:rr,createView:function(e,t){return new Float32Array(e,t,2)},zeros:ir,ones:nr,unitX:ar,unitY:sr,ZEROS:or,ONES:ur,UNIT_X:lr,UNIT_Y:hr}),r(12233)),fr=function(){function e(t,r,i,n){(0,a.Z)(this,e),this.center=rr(t,r),this.centerT=tr(),this.halfWidth=i/2,this.halfHeight=n/2,this.width=i,this.height=n}return(0,s.Z)(e,[{key:"x",get:function(){return this.center[0]},set:function(e){this.center[0]=e}},{key:"y",get:function(){return this.center[1]},set:function(e){this.center[1]=e}},{key:"blX",get:function(){return this.center[0]+this.halfWidth}},{key:"blY",get:function(){return this.center[1]+this.halfHeight}},{key:"trX",get:function(){return this.center[0]-this.halfWidth}},{key:"trY",get:function(){return this.center[1]-this.halfHeight}},{key:"xmin",get:function(){return this.x-this.halfWidth}},{key:"xmax",get:function(){return this.x+this.halfWidth}},{key:"ymin",get:function(){return this.y-this.halfHeight}},{key:"ymax",get:function(){return this.y+this.halfHeight}},{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"serialize",value:function(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}},{key:"findCollisionDelta",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=Math.abs(e.centerT[0]-this.centerT[0]),i=Math.abs(e.centerT[1]-this.centerT[1]),n=(e.halfWidth+this.halfWidth+t)/r,a=(e.halfHeight+this.halfHeight+t)/i,s=Math.min(n,a);return Math.log2(s)}},{key:"extend",value:function(e){var t=Math.min(this.xmin,e.xmin),r=Math.min(this.ymin,e.ymin),i=Math.max(this.xmax,e.xmax)-t,n=Math.max(this.ymax,e.ymax)-r,a=t+i/2,s=r+n/2;this.width=i,this.height=n,this.halfWidth=i/2,this.halfHeight=n/2,this.x=a,this.y=s}}],[{key:"deserialize",value:function(t){return new e(t.readF32(),t.readF32(),t.readInt32(),t.readInt32())}}]),e}(),vr=Math.PI/180,pr=function(){function e(t,r,i,n){(0,a.Z)(this,e),this._rotationT=$t(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;var s=i.rect,o=new Float32Array(8);t*=n,r*=n;var u=i.code?s.width*n:i.metrics.width,l=i.code?s.height*n:i.metrics.height;o[0]=t,o[1]=r,o[2]=t+u,o[3]=r,o[4]=t,o[5]=r+l,o[6]=t+u,o[7]=r+l,this._data=o,this._setTextureCoords(s),this._scale=n,this._mosaic=i,this.x=t,this.y=r,this.maxOffset=Math.max(t+u,r+l)}return(0,s.Z)(e,[{key:"width",get:function(){return this._mosaic.metrics.width*this._scale}},{key:"mosaic",get:function(){return this._mosaic}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,Yt(this._rotationT,-e),this._setOffsets(this._data)}},{key:"xTopLeft",get:function(){return this._data[0]}},{key:"yTopLeft",get:function(){return this._data[1]}},{key:"xBottomRight",get:function(){return this._data[6]}},{key:"yBottomRight",get:function(){return this._data[7]}},{key:"texcoords",get:function(){return this._texcoords}},{key:"textureBinding",get:function(){return this._mosaic.textureBinding}},{key:"offsets",get:function(){return this._offsets||this._setOffsets(this._data),this._offsets}},{key:"char",get:function(){return String.fromCharCode(this._mosaic.code)}},{key:"code",get:function(){return this._mosaic.code}},{key:"bounds",get:function(){if(!this._bounds){var e=this._mosaic.metrics,t=e.height,r=e.width*this._scale,i=Math.abs(t)*this._scale,n=new Float32Array(8);n[0]=this.x,n[1]=this.y,n[2]=this.x+r,n[3]=this.y,n[4]=this.x,n[5]=this.y+i,n[6]=this.x+r,n[7]=this.y+i,er(n,n,Xt($t(),this._rotationT,this._T));for(var a=1/0,s=1/0,o=0,u=0,l=0;l<4;l++){var h=n[2*l],c=n[2*l+1];a=Math.min(a,h),s=Math.min(s,c),o=Math.max(o,h),u=Math.max(u,c)}var f=o-a,v=u-s,p=a+f/2,d=s+v/2;this._bounds=new fr(p,d,f,v)}return this._bounds}},{key:"setTransform",value:function(e){this._T=e,this._offsets=null}},{key:"_setOffsets",value:function(e){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});var t=this._offsets,r=new Float32Array(8);er(r,e,Xt($t(),this._rotationT,this._T)),t.upperLeft=(0,ie.UJ)(8*r[0],8*r[1]),t.upperRight=(0,ie.UJ)(8*r[2],8*r[3]),t.lowerLeft=(0,ie.UJ)(8*r[4],8*r[5]),t.lowerRight=(0,ie.UJ)(8*r[6],8*r[7])}},{key:"_setTextureCoords",value:function(e){var t=e.x,r=e.y,i=e.width,n=e.height;this._texcoords={upperLeft:(0,ie.UJ)(t,r),upperRight:(0,ie.UJ)(t+i,r),lowerLeft:(0,ie.UJ)(t,r+n),lowerRight:(0,ie.UJ)(t+i,r+n)}}}]),e}(),dr=function(e,t){return{code:0,page:0,sdf:!0,rect:new cr.Z(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}}},yr=function(){function e(t,r,n){(0,a.Z)(this,e),this._rotation=0,this._decorate(t,r,n),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=r.length>1,this._hasRotation=0!==n.angle,this._T=this._createGlyphTransform(this.bounds,n);var s,o=(0,i.Z)(t);try{for(o.s();!(s=o.n()).done;){s.value.setTransform(this._T)}}catch(u){o.e(u)}finally{o.f()}}return(0,s.Z)(e,[{key:"setRotation",value:function(e){if(0!==e||0!==this._rotation){this._rotation=e;var t=this._T;Xt(t,Yt($t(),e),t);var r,n=(0,i.Z)(this.glyphs);try{for(n.s();!(r=n.n()).done;){r.value.setTransform(this._T)}}catch(a){n.e(a)}finally{n.f()}}}},{key:"_decorate",value:function(e,t,r){if(r.decoration&&"none"!==r.decoration&&e.length){var n,a=r.scale,s="underline"===r.decoration?30:20,o=e[0].textureBinding,u=(0,i.Z)(t);try{for(u.s();!(n=u.n()).done;){var l=n.value,h=l.startX*a,c=l.startY*a,f=(l.width+l.glyphWidthEnd)*a;e.push(new pr(h,c+s*a,dr(f,o),1))}}catch(v){u.e(v)}finally{u.f()}}}},{key:"boundsT",get:function(){var e=this.bounds,t=(0,w.s)(tr(),e.x,e.y);if((0,w.t)(t,t,this._T),this._hasRotation){var r=Math.max(e.width,e.height);return new fr(t[0],t[1],r,r)}return new fr(t[0],t[1],e.width,e.height)}},{key:"_createBounds",value:function(e){var t,r=1/0,n=1/0,a=0,s=0,o=(0,i.Z)(e);try{for(o.s();!(t=o.n()).done;){var u=t.value;r=Math.min(r,u.xTopLeft),n=Math.min(n,u.yTopLeft),a=Math.max(a,u.xTopLeft+u.width),s=Math.max(s,u.yBottomRight)}}catch(c){o.e(c)}finally{o.f()}var l=a-r,h=s-n;return new fr(r+l/2,n+h/2,l,h)}},{key:"_createGlyphTransform",value:function(e,t){var r=vr*t.angle,i=$t(),n=tr();return Ht(i,i,(0,w.s)(n,t.xOffset,-t.yOffset)),t.isCIM?Ut(i,i,r):(Ht(i,i,(0,w.s)(n,e.x,e.y)),Ut(i,i,r),Ht(i,i,(0,w.s)(n,-e.x,-e.y))),i}}]),e}(),_r=(0,s.Z)((function e(t,r,i,n,s,o){(0,a.Z)(this,e),this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(r,i)),this.end=Math.max(0,Math.max(r,i)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=n,this.yMin=s,this.yMax=o})),mr=function(e){return 10===e},gr=function(e){return 32===e};function xr(e,t,r){for(var i=r.scale,n=new Array,a=function(e,t,r){for(var i=new Array,n=1/r.scale,a=r.maxLineWidth*n,s=t?e.length-1:0,o=t?-1:e.length,u=t?-1:1,l=s,h=0,c=0,f=l,v=f,p=0,d=1/0,y=0;l!==o;){var _=e[l],m=_.code,g=_.metrics,x=Math.abs(g.top);if(mr(m)||gr(m)||(d=Math.min(d,x),y=Math.max(y,x+g.height)),mr(m))l!==s&&(i.push(new _r(e,f,l-u,h,d,y)),d=1/0,y=0),h=0,f=l+u,v=l+u,c=0;else if(gr(m))v=l+u,c=0,p=g.advance,h+=g.advance;else if(h>a){if(v!==f){var k=v-2*u;h-=p,i.push(new _r(e,f,k,h-c,d,y)),d=1/0,y=0,f=v,h=c}else i.push(new _r(e,f,l-u,h,d,y)),d=1/0,y=0,f=l,v=l,h=0;h+=g.advance,c+=g.advance}else h+=g.advance,c+=g.advance;l+=u}var b=new _r(e,f,l-u,h,d,y);return b.start>=0&&b.end<e.length&&i.push(b),i}(e,t,r),s=function(e,t){for(var r=0,i=0;i<e.length;i++){var n=e[i].width;r=Math.max(n,r)}var a="underline"===t.decoration?4:0,s=e[0].yMin;return{x:0,y:s,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+a-s,width:r}}(a,r),o=r.vAlign,u=r.hAlign,l=o===te.TR.Baseline?1:0,h=l?0:o-1,c=(1-l)*-s.y+h*(s.height/2)+-26*(l?1:0),f=0;f<a.length;f++){var v=a[f],p=v.start,d=v.end,y=-1*(u+1)*(v.width/2)-3,_=f*r.lineHeight+c-3;a[f].startX=y,a[f].startY=_;for(var m=p;m<=d;m++){var g=e[m];if(!mr(g.code)){var x=new pr(y+g.metrics.left,_-g.metrics.top,g,i);y+=g.metrics.advance,n.push(x)}}}return new yr(n,a,r)}var kr=function(e){return function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;(0,a.Z)(this,r);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n)))._isCIM=!1,e._vertexBoundsScale=1,e.geometryType=V.LW.TEXT,e._aux=(0,ie.Jz)(0,0,e._referenceSize,e._bitset),e}return(0,s.Z)(r,[{key:"bindTextInfo",value:function(e,t){var r=this;e&&e.length?this._shapingInfo=(0,y.yw)(e,(function(e){return xr(e,t,{scale:r._scale,angle:r._angle,xOffset:r._xOffset,yOffset:r._yOffset,hAlign:r._xAlignD,vAlign:r._yAlignD,maxLineWidth:Math.max(32,Math.min(r._lineWidth,512)),lineHeight:N.xm*Math.max(.25,Math.min(r._lineHeight,4)),decoration:r._decoration,isCIM:r._isCIM})})):this._shapingInfo=null}},{key:"_write",value:function(e,t,r,i){var n=t.getDisplayId();this._writeGeometry(e,t,n,r,i)}},{key:"_writeGeometry",value:function(e,t,r,i,n){var a=this,s=this._shapingInfo;if(!(0,y.Wi)(s)){if((0,y.pC)(this._textPlacement)){var o=null!=n?n:t.readLegacyGeometryForDisplay();return this._writePlacedText(e,r,o,s,i)}var u=n?(0,xe.oB)((0,xe.GH)(n),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!(0,y.Wi)(u)){if(u.isPoint){var l=(0,j.Z)(u.coords,2),h=l[0],c=l[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(h<0||h>=512||c<0||c>=512))return;return this._writeGlyphs(e,r,{x:h,y:c},s)}u.forEachVertex((function(t,i){return a._writeGlyphs(e,r,{x:t,y:i},s)}))}}}},{key:"_writePlacedText",value:function(e,t,r,i,n){var a=(0,y.Wg)(this._textPlacement),s=Dt.getPlacement(r,a,(0,Q.F2)(1),n.geometryEngine);if(s)for(var o=s.next();null!=o;){var u=-o.getAngle();i.setRotation(u);var l=o.tx,h=-o.ty;l<0||l>=512||h<0||h>=512||(this._writeGlyphs(e,t,{x:l,y:h},i),i.setRotation(-u)),o=s.next()}}},{key:"_writeGlyphs",value:function(e,t,r,n){var a,s=ne.m2.load(this._materialKey),o=(0,ie.UJ)(Math.round(8*r.x),Math.round(8*r.y)),u=this._vertexBoundsScale,l=n.bounds,h=2*Math.max(l.width,l.height),c=(0,i.Z)(n.glyphs);try{for(c.s();!(a=c.n()).done;){var f=a.value;s.textureBinding=f.textureBinding,e.recordStart(t,s.data,this.geometryType,!0),e.vertexBounds(r.x+l.x+this._xOffset,r.y+l.y-this._yOffset,h*u,h*u),this._writeVertices(e,t,o,f),e.recordEnd()}}catch(v){c.e(v)}finally{c.f()}}},{key:"_writeGlyph",value:function(e,t,r,i,n){var a=ne.m2.load(this._materialKey),s=(0,ie.UJ)(Math.round(8*r),Math.round(8*i));a.textureBinding=n.textureBinding,e.recordStart(t,a.data,this.geometryType,!0);var o=n.bounds,u=this._vertexBoundsScale;e.vertexBounds(r+o.x*u,i+o.y*u,o.width*u,o.height*u),this._writeVertices(e,t,s,n),e.recordEnd()}},{key:"_writeVertices",value:function(e,t,r,i){var n=e.vertexCount();this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.upperLeft),e.vertexWrite(i.texcoords.upperLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.upperRight),e.vertexWrite(i.texcoords.upperRight),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.lowerLeft),e.vertexWrite(i.texcoords.lowerLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.lowerRight),e.vertexWrite(i.texcoords.lowerRight),e.vertexEnd(),e.indexWrite(n+0),e.indexWrite(n+1),e.indexWrite(n+2),e.indexWrite(n+1),e.indexWrite(n+3),e.indexWrite(n+2)}},{key:"_writeVertexCommon",value:function(e,t,r,i){var n=this._color,a=this._haloColor,s=(0,ie.Jz)(0,0,this._referenceSize,this._bitset),o=(0,ie.Jz)(0,0,this._size,this._haloSize);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(n),e.vertexWrite(a),e.vertexWrite(o),e.vertexWrite(s),e.vertexWrite(this._minMaxZoom)}}]),r}(e)},br=r(42982),Mr=function(){function e(t){(0,a.Z)(this,e),this._geometry=t}return(0,s.Z)(e,[{key:"next",value:function(){var e=this._geometry;return this._geometry=null,e}}]),e}();var Sr=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,null,[{key:"executeEffects",value:function(e,t,r){var n,a=Se(t),s=new Mr(a),o=(0,i.Z)(e);try{for(o.s();!(n=o.n()).done;){var u=n.value,l=Vt(u);l&&(s=l.execute(s,u,1.3333333333333333,r))}}catch(h){o.e(h)}finally{o.f()}return s}},{key:"next",value:function(e){var t=e.next();return function(e){e&&(we(e),(0,be.oU)(e)?Le(e.rings):(0,be.l9)(e)?Le(e.paths):(0,be.aW)(e)&&Ze(e.points))}(t),t}},{key:"applyEffects",value:function(e,t,r){if(!e)return t;var n,a=new Mr(t),s=(0,i.Z)(e);try{for(s.s();!(n=s.n()).done;){var o=n.value,u=Vt(o);u&&(a=u.execute(a,o,1,r))}}catch(v){s.e(v)}finally{s.f()}for(var l,h=null;l=a.next();){var c,f;h?(0,be.l9)(h)?(0,be.l9)(l)&&(c=h.paths).push.apply(c,(0,br.Z)(l.paths)):(0,be.oU)(h)&&(0,be.oU)(l)&&(f=h.rings).push.apply(f,(0,br.Z)(l.rings)):h=l}return h}}]),e}(),wr=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"bindFeature",value:function(e,t,r){}},{key:"write",value:function(e,t,r,i){var n;if((0,y.Wi)(this._effects)||0===(null==(n=this._effects)?void 0:n.length))return this._write(e,t,i);for(var a=Sr.executeEffects(this._effects,t.readLegacyGeometryForDisplay(),i.geometryEngine),s=Sr.next(a);s;)this._write(e,t,i,s),s=Sr.next(a)}},{key:"_write",value:function(e,t,r,i){}}]),e}(),Pr=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n,s,o,u,l,h,c,f,v,p,d,y,_,m,g,x){var k,b=arguments.length>18&&void 0!==arguments[18]&&arguments[18],M=arguments.length>19?arguments[19]:void 0,S=arguments.length>20?arguments[20]:void 0;(0,a.Z)(this,r),(k=t.call(this))._xOffset=(0,Q.F2)(d),k._yOffset=(0,Q.F2)(y),k._decoration=f||"none",k._color=o,k._haloColor=u,k._haloSize=Math.min(Math.floor(5*(0,Q.F2)((0,Q.t_)(n))),127),k._size=Math.min(Math.round((0,Q.F2)(i)),127);var w=Math.min(Math.round((0,Q.F2)(s||i)),127);k._referenceSize=Math.round(Math.sqrt(256*w)),k._scale=k._size/N.Ex,k._angle=p,k._justify=(0,te.Hd)(l||"center"),k._xAlignD=(0,te.kH)(l||"center"),k._yAlignD=(0,te.b7)(h||"baseline"),k._baseline="baseline"===(h||"baseline"),k._bitset=(c===ee.v2.MAP?1:0)|(v?1:0)<<1;var P=ne.m2.load(e);return P.sdf=!0,k._materialKey=P.data,k._lineWidth=(0,Q.F2)(_)||512,k._lineHeight=m||1,k._textPlacement=g,k._effects=x,k._isCIM=b,k._minMaxZoom=(0,ie.UJ)(Math.round(M*N.MI),Math.round(S*N.MI)),k}return(0,s.Z)(r,null,[{key:"fromText",value:function(e,t){var i=new r(e.materialKey,e.font.size,e.haloSize||0,e.font.size,e.color&&(0,re.aH)(e.color)||0,e.haloColor&&(0,re.aH)(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,ee.v2.SCREEN,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1,0,ae),n=f(e.text),a=(0,j.Z)(n,2)[1];return i.bindTextInfo(t,a),i._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,i}},{key:"fromCIMText",value:function(e,t,i){var n=e.scaleFactor||1,a=e.size*e.sizeRatio*n,s=fe(e.scaleInfo,i),o=(0,j.Z)(s,2),u=o[0],l=o[1],h=new r(e.materialKey,a,e.outlineSize*e.sizeRatio,e.referenceSize,(0,re.t2)(e.color),(0,re.t2)(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*n,e.offsetY*e.sizeRatio*n,512,1,e.markerPlacement,e.effects,!0,u,l),c=f(e.text),v=(0,j.Z)(c,2)[1];return h.bindTextInfo(t,v),h._vertexBoundsScale=e.maxVVSize?e.maxVVSize/a:1,h}}]),r}(kr(wr)),Cr=d.Z.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");var Zr=function(e){var t=new Map;return function(r){return t.has(r)||t.set(r,e(r)),t.get(r)}}((function(e){var t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t})),Lr=function(e){return Math.floor(127*e+127)},Ir=function(e){return Math.floor(10*e)},Tr=function(e){return Math.round(e*(254/360))},zr=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n,s){var o,u,l,h;(0,a.Z)(this,r),(o=t.call(this,e,n.font.size,n.haloSize||0,n.font.size,n.color&&(0,re.aH)(n.color)||0,n.haloColor&&(0,re.aH)(n.haloColor)||0,n.horizontalAlignment,n.verticalAlignment,(0,te.NS)(i.labelPlacement)?ee.v2.MAP:ee.v2.SCREEN,n.font.decoration,!1,n.angle||0,n.xoffset,n.yoffset,n.lineWidth,n.lineHeight,null,null,null,null,null))._outLineLabelAngle=0,o._refPlacementPadding=0,o._refPlacementDirX=0,o._refPlacementDirY=0,o._refOffsetX=0,o._refOffsetY=0,o._zoomLevel=0,o.geometryType=V.LW.LABEL,o._allowOverrun=null!=(u=i.allowOverrun)&&u,o._repeatLabel=null==(l=i.repeatLabel)||l,o._labelPosition=null!=(h=i.labelPosition)?h:"curved";var c=function(e,t){var r=!!e.minScale&&t.scaleToZoom(e.minScale)||0;return(0,$.uZ)(r,0,25.5)}(i,s),f=function(e,t){var r=!!e.maxScale&&t.scaleToZoom(e.maxScale)||255;return(0,$.uZ)(r,0,25.5)}(i,s),v=i.labelPlacement,p=(0,te.qv)(v),d=(0,j.Z)(p,2),y=d[0],_=d[1];o._xAlignD=y,o._yAlignD=_,o._minZoom=c,o._maxZoom=f,o._refPlacementPadding=(0,Q.F2)(n.haloSize)+N.Iw,o._repeatLabelDistance=i.repeatLabelDistance?(0,Q.F2)(i.repeatLabelDistance):128;var m=ne.Gq.load(e);return m.sdf=!0,o._materialKey=m.data,o}return(0,s.Z)(r,[{key:"_shapedBox",get:function(){return(0,y.Wg)(this._shapingInfo).bounds}},{key:"setZoomLevel",value:function(e){this._zoomLevel=e}},{key:"bindReferenceTemplate",value:function(e){var t=(0,te.g)(this._xAlignD),r=(0,te.tf)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,(0,y.Wi)(e))this._refSymbolAndPlacementOffset=(0,ie.Jz)(0,0,Lr(t),Lr(r));else{if("circle"===e.boundsType&&(t||r)){var i=Math.sqrt(t*t+r*r);t/=i,r/=i}var n=Math.max(e.height,e.width),a=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=(0,ie.Jz)(a,n,Lr(t),Lr(r)),this._referenceSize=n,this._refPlacementDirX=t,this._refPlacementDirY=r,this._refOffsetX=e.xOffset,this._refOffsetY=e.yOffset}}},{key:"_write",value:function(e,t){if(!(0,y.Wi)(this._shapingInfo)){var r=this._shapingInfo,i=t.getDisplayId(),n="esriGeometryPolygon"===t.geometryType?t.readLegacyCentroid():t.readLegacyGeometry();if(n)switch(this.current={out:e,inId:i,inShaping:r,zoomLevel:this._zoomLevel},t.geometryType){case"esriGeometryPolyline":this._placeLineLabels(n);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(n);break;default:!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mapview-labeling";Cr.error(new v.Z(t,e))}("mapview-labeling","Geometry of type ".concat(t.geometryType," is not supported"))}}}},{key:"_isVisible",value:function(e,t){var r=Ir(this.current.zoomLevel);return Ir(e)<=r&&r<=Ir(t)}},{key:"_placePointLabels",value:function(e){var t=this.current,r=t.out,i=t.inId,n=t.inShaping;this._writeGlyphs(r,i,e,n)}},{key:"_placeLineLabels",value:function(e){var t,r=function(e,t){for(var r=t,i=0;i<e.length;i++){var n=e[i],a=[];a.push(n[0]);for(var s=1;s<n.length;s++){var o=(0,j.Z)(a[s-1],2),u=o[0],l=o[1];u+=n[s][0],l+=n[s][1],a.push([u,l])}ge(a,r);var h=[];h.push(a[0]);for(var c=1;c<a.length;c++){var f=(0,j.Z)(a[c-1],2),v=f[0],p=f[1],d=(0,j.Z)(a[c],2),y=d[0],_=d[1],m=Math.round(y-v),g=Math.round(_-p);h.push([m,g])}e[i]=h,n=h}return e}(e.paths,this.current.inShaping.bounds.width),n=this._placeSubdivGlyphs.bind(this),a=(this._shapedBox.width+this._repeatLabelDistance)/2,s=(0,i.Z)(r);try{for(s.s();!(t=s.n()).done;){me(t.value,a,n,this._repeatLabel)}}catch(o){s.e(o)}finally{s.f()}}},{key:"_placeSubdivGlyphs",value:function(e,t,r,i){var n=Zr(t),a=this._shapedBox.width/2,s=Math.sqrt(this._repeatLabelDistance)/2,o=Math.min(r,i-r),u=Math.log2(o/(s+a/2)),l=0===t?u:Math.min(n,u),h=Math.max(this._minZoom,this.current.zoomLevel+1-l),c=this.current.zoomLevel-h,f=this._shapedBox.width/2*Math.pow(2,c);this.current.inShaping.isMultiline?0===t&&this._placeStraight(e,h):this._allowOverrun&&c<0?this._placeStraightAlong(e,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(e,h):"curved"===this._labelPosition&&this._placeCurved(e,h,f)}},{key:"_placeStraight",value:function(e,t){var r=this.current,i=r.out,n=r.inId,a=r.inShaping;this._writeGlyphs(i,n,e,a,t)}},{key:"_placeCurved",value:function(e,t,r){var i=this.current,n=i.out,a=i.inId;n.metricStart(a,t,e.x,e.y,0,0,0,0);var s=e.clone(),o=e.angle*(180/Math.PI)%360,u=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Tr(o),this._placeFirst(s,t,1),this._placeBack(e,s,t,r,1),this._placeForward(e,s,t,r,1),this._outLineLabelAngle=Tr(u),this._placeFirst(s,t,0),this._placeBack(e,s,t,r,0),this._placeForward(e,s,t,r,0),n.metricEnd()}},{key:"_placeStraightAlong",value:function(e,t){var r=this.current,i=r.out,n=r.inId;i.metricStart(n,t,e.x,e.y,0,0,0,0);var a=e.clone(),s=e.angle*(180/Math.PI)%360,o=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Tr(s),this._placeFirst(a,t,1,!0),this._outLineLabelAngle=Tr(o),this._placeFirst(a,t,0,!0),i.metricEnd()}},{key:"_placeBack",value:function(e,t,r,i,n){for(var a=e.clone(),s=e.backwardLength+0;a.prev()&&!(s>=i);)this._placeOnSegment(a,t,s,r,-1,n),s+=a.length+0}},{key:"_placeForward",value:function(e,t,r,i,n){for(var a=e.clone(),s=e.remainingLength+0;a.next()&&!(s>=i);)this._placeOnSegment(a,t,s,r,1,n),s+=a.length+0}},{key:"_placeFirst",value:function(e,t,r){var n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=e,o=this.current.inShaping,u=o.glyphs,l=this.current.zoomLevel,h=this.current,c=h.out,f=h.inId,v=(0,i.Z)(u);try{for(v.s();!(n=v.n()).done;){var p=n.value,d=p.x>o.bounds.x?r:1-r,y=d*e.remainingLength+(1-d)*e.backwardLength,_=Math.abs(p.x+p.width/2-o.bounds.x),m=Math.max(0,l+Math.log2(_/(y+0))),g=Math.max(t,a?0:m);if(p.maxZoom=25,p.angle=e.angle+(1-r)*Math.PI,p.minZoom=g,this._writeGlyph(c,f,s.x,s.y,p),r&&this._isVisible(p.minZoom,p.maxZoom)){var x=p.bounds;c.metricBoxWrite(x.center[0],x.center[1],x.width,x.height)}}}catch(k){v.e(k)}finally{v.f()}}},{key:"_placeOnSegment",value:function(e,t,r,n,a,s){var o,u=this.current.inShaping.glyphs,l=this.current,h=l.out,c=l.inId,f=this.current.inShaping,v=this.current.zoomLevel,p=e.dx/e.length,d=e.dy/e.length,y={x:e.x+r*-a*p,y:e.y+r*-a*d},_=(0,i.Z)(u);try{for(_.s();!(o=_.n()).done;){var m=o.value,g=m.x>f.bounds.x?s:1-s;if(g&&1===a||!g&&-1===a){var x=Math.abs(m.x+m.width/2-f.bounds.x),k=Math.max(0,v+Math.log2(x/r)-.1),b=Math.max(n,v+Math.log2(x/(r+e.length+0)));if(0!==k&&(m.angle=e.angle+(1-s)*Math.PI,m.minZoom=b,m.maxZoom=k,this._writeGlyph(h,c,y.x,y.y,m),s&&this._isVisible(m.minZoom,m.maxZoom))){var M=m.bounds,S=e.x-t.x,w=e.y-t.y;h.metricBoxWrite(M.center[0]+S,M.center[1]+w,M.width,M.height)}}}}catch(P){_.e(P)}finally{_.f()}}},{key:"_writeGlyphs",value:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._minZoom;if(!(r.x<0||r.x>=512||r.y<0||r.y>=512)){var s,o=r.x+this._refOffsetX,u=r.y-this._refOffsetY,l=(0,i.Z)(n.glyphs);try{for(l.s();!(s=l.n()).done;){var h=s.value;h.minZoom=a,h.maxZoom=this._maxZoom,this._writeGlyph(e,t,o,u,h)}}catch(p){l.e(p)}finally{l.f()}var c=this._refPlacementDirX,f=this._refPlacementDirY,v=n.boundsT;e.metricStart(t,a,o,u,c,f,this._referenceSize,this._materialKey),e.metricBoxWrite(v.center[0],v.center[1],v.width,v.height),e.metricEnd()}}},{key:"_writeVertexCommon",value:function(e,t,r,i){var n=this._color,a=this._haloColor,s=(0,ie.Jz)(0,0,this._size,this._haloSize),o=Math.max(i.minZoom,this._minZoom),u=Math.min(i.maxZoom,this._maxZoom),l=(0,ie.Jz)(Ir(o),Ir(u),this._outLineLabelAngle,0);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(n),e.vertexWrite(a),e.vertexWrite(s),e.vertexWrite(this._refSymbolAndPlacementOffset),e.vertexWrite(l)}}],[{key:"fromLabelClass",value:function(e,t){if("esriServerLinePlacementCenterAlong"===e.labelPlacement){var i=e.symbol;i.xoffset=0,i.yoffset=0,i.angle=0,i.font.decoration="none"}return new r(e.materialKey,e,e.symbol,t)}}]),r}(Pr),Er=3.14159265359/180,Fr=function(e){return function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;(0,a.Z)(this,r);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).angle=0,e.xOffset=0,e.yOffset=0,e.width=0,e.height=0,e.boundsType="square",e._anchorX=0,e._anchorY=0,e._computedWidth=0,e._computedHeight=0,e._vertexBoundsScaleX=1,e._vertexBoundsScaleY=1,e._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},e.geometryType=V.LW.MARKER,e}return(0,s.Z)(r,[{key:"_write",value:function(e,t,r,i){var n=t.getDisplayId();e.recordStart(n,this._materialKey,this.geometryType,!0),this._writeGeometry(e,t,n,r,i),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i,n){var a=this;if((0,y.pC)(this._markerPlacement))return this._writePlacedMarkers(e,t,i,n);if(!n&&"esriGeometryPoint"===t.geometryType){var s=t.getX(),o=t.getY();if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(s<0||s>=513||o<0||o>=513))return;return this._writeVertices(e,r,this._getPos(s,o),s,o)}var u=n?(0,xe.oB)((0,xe.GH)(n),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!(0,y.Wi)(u)){if(u.isPoint){var l=(0,j.Z)(u.coords,2),h=l[0],c=l[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(h<0||h>=512||c<0||c>=512))return;return this._writeVertices(e,r,this._getPos(h,c),h,c)}u.forEachVertex((function(t,i){return a._writeVertices(e,r,a._getPos(t,i),t,i)}))}}},{key:"_writePlacedMarkers",value:function(e,t,r,i){var n=null!=i?i:t.readLegacyGeometryForDisplay(),a=Dt.getPlacement(n,(0,y.Wg)(this._markerPlacement),(0,Q.F2)(1),r.geometryEngine);if(a)for(var s=t.getDisplayId(),o=tr(),u=$t(),l=a.next();null!=l;){var h=l.tx,c=-l.ty;h>=-128&&h<=640&&c>=-128&&c<=640&&(this._applyTransformation(u,o,-l.getAngle()/Er),this._writeVertices(e,s,this._getPos(h,c),h,c)),l=a.next()}}},{key:"_writeVertices",value:function(e,t,r,i,n){var a=e.vertexCount();if(this.angle){var s=Math.max(this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY);e.vertexBounds(i+this.xOffset,n-this.yOffset,s,s)}else e.vertexBounds(i+this.xOffset,n-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY);e.vertexWrite(r),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(this._texUpperLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(this._texUpperRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(this._texBottomLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(this._texBottomRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.indexWrite(a+0),e.indexWrite(a+1),e.indexWrite(a+2),e.indexWrite(a+1),e.indexWrite(a+3),e.indexWrite(a+2)}},{key:"_applyTransformation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Jt(e,rr(this.xOffset,-this.yOffset)),this.angle+r!==0&&Ut(e,e,Er*(this.angle+r));var i=this._computedWidth,n=this._computedHeight,a=(this._anchorX-.5)*i,s=(this._anchorY-.5)*n;(0,w.s)(t,a,s),(0,w.t)(t,t,e),this._offsetUpperLeft=(0,ie.UJ)(16*t[0],16*t[1]),this._offsets.xUpperLeft=t[0],this._offsets.yUpperLeft=t[1],(0,w.s)(t,a+i,s),(0,w.t)(t,t,e),this._offsetUpperRight=(0,ie.UJ)(16*t[0],16*t[1]),this._offsets.xUpperRight=t[0],this._offsets.yUpperRight=t[1],(0,w.s)(t,a,s+n),(0,w.t)(t,t,e),this._offsetBottomLeft=(0,ie.UJ)(16*t[0],16*t[1]),this._offsets.xBottomLeft=t[0],this._offsets.yBottomLeft=t[1],(0,w.s)(t,a+i,s+n),(0,w.t)(t,t,e),this._offsetBottomRight=(0,ie.UJ)(16*t[0],16*t[1]),this._offsets.xBottomRight=t[0],this._offsets.yBottomRight=t[1]}},{key:"_getPos",value:function(e,t){return(0,ie.UJ)(Math.round(8*e),Math.round(8*t))}}]),r}(e)},Ar=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n,s,o,u,l,h,c,f,v,p,d,y,_,m,g,x,k,b,M,S,w){var P;(0,a.Z)(this,r),(P=t.call(this)).angle=s,P.height=l,P.width=u,P.xOffset=i*k,P.yOffset=n*k,P._markerPlacement=b,P._effects=M,P._anchorX=.5-(.5+m)*_.width/_.width,P._anchorY=.5-(.5+g)*_.height/_.height,P._minMaxZoom=(0,ie.UJ)(Math.round(S*N.MI),Math.round(w*N.MI));var C=(y===ee.v2.MAP?N.Tz:N.CQ)|(v?N.Uh:0)|(d?N.oK:0)|(p?N.e0:0),Z=_&&_.sdf,L=ne.mE.load(e);L.sdf=Z,L.pattern=!0,L.textureBinding=_.textureBinding,P._materialKey=L.data,P._fillColor=o,P._outlineColor=c,P._sizeOutlineWidth=(0,ie.Jz)(Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*l),255)),Math.round(Math.min(Math.sqrt(128*f),255)),Math.round(Math.min(Math.sqrt(128*h),255)));var I=_.rect.x+N.fL,T=_.rect.y+N.fL,z=I+_.width,E=T+_.height;P._offsets.xUpperLeft=I,P._offsets.yUpperLeft=T,P._offsets.xUpperRight=z,P._offsets.yUpperRight=T,P._offsets.xBottomLeft=I,P._offsets.yBottomLeft=E,P._offsets.xBottomRight=z,P._offsets.yBottomRight=E,P._texUpperLeft=(0,ie.UJ)(I,T),P._texUpperRight=(0,ie.UJ)(z,T),P._texBottomLeft=(0,ie.UJ)(I,E),P._texBottomRight=(0,ie.UJ)(z,E),u*=x,l*=x,u*=k,l*=k;var F=Math.round(64*x);P._bitestAndDistRatio=(0,ie.UJ)(C,F),P._computedWidth=u,P._computedHeight=l;var A=tr(),R=$t();return P._applyTransformation(R,A),P}return(0,s.Z)(r,null,[{key:"fromCIMMarker",value:function(e,t,i){var n=t&&t.width||1,a=t&&t.height||1,s=e.size,o=n/a*e.scaleX,u=e.scaleSymbolsProportionally&&e.frameHeight?s/e.frameHeight:1,l=(0,re.t2)(e.color),h=(0,re.t2)(e.outlineColor),c=(0,Q.F2)(s),f=c*o,v=(0,Q.F2)(e.offsetX||0),p=(0,Q.F2)(e.offsetY||0),d=(0,Q.F2)(e.outlineWidth||0)*u,_=e.alignment||ee.v2.SCREEN,m=(0,Q.F2)(e.referenceSize),g=fe(e.scaleInfo,i),x=(0,j.Z)(g,2),k=x[0],b=x[1];t.sdf||0!==l||(l=-1);var M=e.rotation||0;e.rotateClockwise||(M=-M);var S=0,w=0,P=e.anchorPoint;P&&(e.isAbsoluteAnchorPoint?s&&(S=-P.x/(s*o),w=P.y/s):(S=P.x,w=P.y));var C=new r(e.materialKey,v,p,M,l,f,c,m,h,d,e.colorLocked,e.scaleSymbolsProportionally,!1,_,t,S,w,e.sizeRatio,(0,y.Pt)(e.scaleFactor,1),e.markerPlacement,e.effects,k,b);return C._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/f:1,C._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/c:1,C}},{key:"fromPictureMarker",value:function(e,t){var i=Math.round((0,Q.F2)(e.width)),n=Math.round((0,Q.F2)(e.height)),a=N.ru,s=Math.round((0,Q.F2)(e.xoffset||0)),o=Math.round((0,Q.F2)(e.yoffset||0)),u=new r(e.materialKey,s,o,e.angle,a,i,n,n,0,0,!1,!1,!1,ee.v2.SCREEN,t,0,0,1,1,null,null,0,ae);return u._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,u._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,u}},{key:"fromSimpleMarker",value:function(e,t){var i=(0,re.aH)(e.color),n=Math.round((0,Q.F2)(e.size)),a=n,s=Math.round((0,Q.F2)(e.xoffset||0)),o=Math.round((0,Q.F2)(e.yoffset||0)),u=e.style,l=e.outline,h=0|(l&&l.color&&(0,re.aH)(l.color)),c=0|(l&&l.width&&Math.round((0,Q.F2)(l.width))),f=new r(e.materialKey,s,o,e.angle,i,n,a,a,h,c,!1,!1,"esriSMSCross"===u||"esriSMSX"===u,ee.v2.SCREEN,t,0,0,126/64,1,null,null,0,ae);return f.boundsType="esriSMSCircle"===u?"circle":"square",f._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,f._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,f}},{key:"fromLineSymbolMarker",value:function(e,t){var i,n=(0,re.aH)(e.color),a=Math.round((0,Q.F2)(6*e.lineWidth)),s=a,o="cross"===e.style||"x"===e.style;switch(e.placement){case"begin-end":i=ee.Tx.Both;break;case"begin":i=ee.Tx.JustBegin;break;case"end":i=ee.Tx.JustEnd;break;default:i=ee.Tx.None}var u={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:i,offsetAlongLine:0},l=new r(e.materialKey,0,0,0,n,a,s,s/6,n,o?Math.round((0,Q.F2)(e.lineWidth)):0,!1,!1,o,ee.v2.MAP,t,0,0,126/64,1,u,null,0,ae);return l.boundsType="circle"===e.style?"circle":"square",l}}]),r}(Fr(wr)),Rr=r(1413),Or=r(76115),Wr=r(82963),Nr=r(13200),Vr=(r(79347),r(80457)),Gr=r(60652),Dr=r(91623);function Br(e,t,r,i,n,a,s){vi=0;var o,u,l,h,c,f=(i-r)*a,v=n&&n.length,p=v?(n[0]-r)*a:f,d=Xr(t,r,i,0,p,a,!0);if(d&&d.next!==d.prev){if(v&&(d=function(e,t,r,i,n,a){for(var s=new Array,o=0,u=i.length;o<u;o++){var l=Xr(e,t,r,i[o]*a,o<u-1?i[o+1]*a:r*a,a,!1);l===l.next&&(l.steiner=!0),s.push(jr(l))}s.sort(si);for(var h=0,c=s;h<c.length;h++){$r(c[h],n),n=Ur(n,n.next)}return n}(t,r,i,n,d,a)),f>80*a){o=l=t[0+r*a],u=h=t[1+r*a];for(var y=a;y<p;y+=a){var _=t[y+r*a],m=t[y+1+r*a];o=Math.min(o,_),u=Math.min(u,m),l=Math.max(l,_),h=Math.max(h,m)}c=0!==(c=Math.max(l-o,h-u))?1/c:0}Hr(d,e,a,o,u,c,s,0)}}function Xr(e,t,r,i,n,a,s){var o;if(s===function(e,t,r,i,n,a){for(var s=0,o=i,u=n-a;o<n;o+=a)s+=(e[u+t*a]-e[o+t*a])*(e[o+1+t*a]+e[u+1+t*a]),u=o;return s}(e,t,0,i,n,a)>0)for(var u=i;u<n;u+=a)o=qr(u+t*a,e[u+t*a],e[u+1+t*a],o);else for(var l=n-a;l>=i;l-=a)o=qr(l+t*a,e[l+t*a],e[l+1+t*a],o);return o&&ai(o,o.next)&&(Kr(o),o=o.next),o}function Ur(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(!e)return e;var r,i=e;do{if(r=!1,i.steiner||!ai(i,i.next)&&0!==ei(i.prev,i,i.next))i=i.next;else{if(Kr(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function Hr(e,t,r,i,n,a,s,o){if(e){!o&&a&&(e=Qr(e,i,n,a));for(var u=e;e.prev!==e.next;){var l=e.prev,h=e.next;if(a?Jr(e,i,n,a):Yr(e))t.push(l.index/r+s),t.push(e.index/r+s),t.push(h.index/r+s),Kr(e),e=h.next,u=h.next;else if((e=h)===u){o?1===o?Hr(e=oi(e,t,r,s),t,r,i,n,a,s,2):2===o&&ui(e,t,r,i,n,a,s):Hr(Ur(e),t,r,i,n,a,s,1);break}}}}function Yr(e){var t=e.prev,r=e,i=e.next;if(ei(t,r,i)>=0)return!1;for(var n=e.next.next,a=n,s=0;n!==e.prev&&(0===s||n!==a);){if(s++,ri(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&ei(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Jr(e,t,r,i){var n=e.prev,a=e,s=e.next;if(ei(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,u=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,l=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,h=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,c=ni(o,u,t,r,i),f=ni(l,h,t,r,i),v=e.prevZ,p=e.nextZ;v&&v.z>=c&&p&&p.z<=f;){if(v!==e.prev&&v!==e.next&&ri(n.x,n.y,a.x,a.y,s.x,s.y,v.x,v.y)&&ei(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,p!==e.prev&&p!==e.next&&ri(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&ei(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;v&&v.z>=c;){if(v!==e.prev&&v!==e.next&&ri(n.x,n.y,a.x,a.y,s.x,s.y,v.x,v.y)&&ei(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&ri(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&ei(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function qr(e,t,r,i){var n=ci.create(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Kr(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jr(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function $r(e,t){if(t=function(e,t){var r,i=t,n=e.x,a=e.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>s){if(s=o,o===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===s)return r.prev;var u,l=r,h=r.x,c=r.y,f=1/0;for(i=r.next;i!==l;)n>=i.x&&i.x>=h&&n!==i.x&&ri(a<c?n:s,a,h,c,a<c?s:n,a,i.x,i.y)&&(((u=Math.abs(a-i.y)/(n-i.x))<f||u===f&&i.x>r.x)&&ii(i,e)&&(r=i,f=u)),i=i.next;return r}(e,t)){var r=hi(t,e);Ur(r,r.next)}}function Qr(e,t,r,i){for(var n;n!==e;n=n.next){if(null===(n=n||e).z&&(n.z=ni(n.x,n.y,t,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,Qr(e,t,r,i);n.prevZ=n.prev,n.nextZ=n.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){for(var t,r=1;;){var i=void 0,n=e;e=null,t=null;for(var a=0;n;){a++,i=n;for(var s=0;s<r&&i;s++)i=i.nextZ;for(var o=r;s>0||o>0&&i;){var u=void 0;0===s?(u=i,i=i.nextZ,o--):0!==o&&i?n.z<=i.z?(u=n,n=n.nextZ,s--):(u=i,i=i.nextZ,o--):(u=n,n=n.nextZ,s--),t?t.nextZ=u:e=u,u.prevZ=t,t=u}n=i}if(t.nextZ=null,r*=2,a<2)return e}}(e)}function ei(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function ti(e,t,r,i){return!!(ai(e,t)&&ai(r,i)||ai(e,i)&&ai(r,t))||ei(e,t,r)>0!=ei(e,t,i)>0&&ei(r,i,e)>0!=ei(r,i,t)>0}function ri(e,t,r,i,n,a,s,o){return(n-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(i-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(n-s)*(i-o)>=0}function ii(e,t){return ei(e.prev,e,e.next)<0?ei(e,t,e.next)>=0&&ei(e,e.prev,t)>=0:ei(e,t,e.prev)<0||ei(e,e.next,t)<0}function ni(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ai(e,t){return e.x===t.x&&e.y===t.y}function si(e,t){return e.x-t.x}function oi(e,t,r,i){var n=e;do{var a=n.prev,s=n.next.next;!ai(a,s)&&ti(a,n,n.next,s)&&ii(a,s)&&ii(s,a)&&(t.push(a.index/r+i),t.push(n.index/r+i),t.push(s.index/r+i),Kr(n),Kr(n.next),n=e=s),n=n.next}while(n!==e);return n}function ui(e,t,r,i,n,a,s){var o=e;do{for(var u=o.next.next;u!==o.prev;){if(o.index!==u.index&&li(o,u)){var l=hi(o,u);return o=Ur(o,o.next),l=Ur(l,l.next),Hr(o,t,r,i,n,a,s,0),void Hr(l,t,r,i,n,a,s,0)}u=u.next}o=o.next}while(o!==e)}function li(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&ti(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&ii(e,t)&&ii(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)}function hi(e,t){var r=ci.create(e.index,e.x,e.y),i=ci.create(t.index,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}for(var ci=function(){function e(){(0,a.Z)(this,e),this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return(0,s.Z)(e,null,[{key:"create",value:function(t,r,i){var n=vi<fi.length?fi[vi++]:new e;return n.index=t,n.x=r,n.y=i,n.prev=null,n.next=null,n.z=null,n.prevZ=null,n.nextZ=null,n.steiner=!1,n}}]),e}(),fi=new Array,vi=0,pi=0;pi<8096;pi++)fi.push(new ci);var di=new Dr.b(0,0,0,1,0),yi=new Dr.b(0,0,0,1,0);function _i(e,t,r){for(var i=0,n=1;n<r;n++){var a=e[2*(t+n-1)],s=e[2*(t+n-1)+1];i+=(e[2*(t+n)]-a)*(e[2*(t+n)+1]+s)}return i}function mi(e,t,r,i,n){for(var a=0,s=r;s<i;s+=3){var o=2*(e[s]-n),u=2*(e[s+1]-n),l=2*(e[s+2]-n);a+=Math.abs((t[o]-t[l])*(t[u+1]-t[o+1])-(t[o]-t[u])*(t[l+1]-t[o+1]))}return a}di.setExtent(N.I_),yi.setExtent(N.I_);var gi=r(82010),xi=16,ki=function(e){return function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;(0,a.Z)(this,r);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).tessellationProperties={},e._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},e.geometryType=V.LW.LINE,e}return(0,s.Z)(r,[{key:"writeGeometry",value:function(e,t,r,i){this._writeGeometry(e,t,r,i)}},{key:"_initializeTessellator",value:function(e){var t=ne.a.load(this._materialKey),r=ne.dk.load(this._materialKey),i=this._tessellationOptions,n=t.vvSizeFieldStops||t.vvSizeMinMaxValue||t.vvSizeScaleStops||t.vvSizeUnitValue,a=this.tessellationProperties._halfWidth<N.tQ&&!e&&!n;this.tessellationProperties.minMaxZoom=this._minMaxZoom,i.wrapDistance=65535,i.textured=this._isDashed||this._hasPattern,i.offset=this.tessellationProperties.offset,i.halfWidth=this.tessellationProperties._halfWidth;var s=a?0:1,o=r.outlinedFill?Mi:bi;this._lineTessellator=new gi.z(o(this.tessellationProperties,s,s),Si(this.tessellationProperties),a)}},{key:"_write",value:function(e,t,r,i){var n="esriGeometryPoint"===t.geometryType;e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,n),this._writeGeometry(e,t,i,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i){var n=null!=r?r:t.readLegacyGeometryForDisplay(),a=this._getLines(n,i);(0,y.Wi)(a)||this._writeVertices(e,t,a)}},{key:"_getLines",value:function(e,t){if((0,y.Wi)(e))return null;var r=e.paths||e.rings;return(0,y.Wi)(r)?null:function(e,t){yi.setPixelMargin(t);for(var r=yi,n=-t,a=N.I_+t,s=[],o=!1,u=0;u<e.length;){var l=[],h=e[u];if(!h)return null;r.reset(Gr.V.LineString);var c=(0,j.Z)(h[0],2),f=c[0],v=c[1];if(o)r.moveTo(f,v);else{if(f<n||f>a||v<n||v>a){o=!0;continue}l.push({x:f,y:v})}for(var p=!1,d=h.length,y=1;y<d;++y)if(f+=h[y][0],v+=h[y][1],o)r.lineTo(f,v);else{if(f<n||f>a||v<n||v>a){p=!0;break}l.push({x:f,y:v})}if(p)o=!0;else{if(o){var _=r.resultWithStarts();if(_){var m,g=(0,i.Z)(_);try{for(g.s();!(m=g.n()).done;){var x=m.value;s.push(x)}}catch(k){g.e(k)}finally{g.f()}}}else s.push({line:l,start:0});u++,o=!1}}return s=s.filter((function(e){return e.line.length>1})),0===s.length?null:s}(r,t?256:16)}},{key:"_writeVertices",value:function(e,t,r){var n=t.getDisplayId(),a=e.vertexCount(),s=this.tessellationProperties,o=this._tessellationOptions;s.out=e,s.id=n,s.indexCount=0,s.vertexCount=0,s.offset=a,o.capType=this._capType,o.joinType=this._joinType;var u=ne.dk.load(this._materialKey);this.tessellationProperties.key=u.outlinedFill?u:ne.a.load(this._materialKey);var l,h=(0,i.Z)(r);try{for(h.s();!(l=h.n()).done;){var c=l.value,f=c.line,v=c.start;o.initialDistance=v%65535,this._lineTessellator.tessellate(f,o)}}catch(p){h.e(p)}finally{h.f()}}}]),r}(e)},bi=function(e,t,r){return function(i,n,a,s,o,u,l,h,c,f,v){var p=(0,ie.UJ)(v,Math.ceil(xi*e._halfWidth)),d=(0,ie.Jz)(Math.round(xi*l),Math.round(xi*h),Math.round(xi*c),Math.round(xi*f)),y=(0,ie.Jz)(xi*o,xi*u,0,e._bitset),_=e.out;return _.vertexBounds(i,n,t,r),_.vertexWrite((0,ie.UJ)(8*i,8*n)),_.vertexWrite(e.id),_.vertexWrite(e._fillColor),_.vertexWrite(d),_.vertexWrite(p),_.vertexWrite(e._tl),_.vertexWrite(e._br),_.vertexWrite(y),_.vertexWrite((0,ie.UJ)(Math.ceil(xi*e._halfReferenceWidth),0)),_.vertexWrite(e.minMaxZoom),_.vertexEnd(),e.offset+e.vertexCount++}},Mi=function(e,t,r){return function(i,n,a,s,o,u,l,h,c,f,v){var p=(0,ie.Jz)(0,0,xi*e._halfWidth,xi*e._halfReferenceWidth),d=(0,ie.Jz)(xi*l+128,xi*h+128,xi*c+128,xi*f+128),y=e.out,_=e._bitset<<24|e.id;return y.vertexBounds(i,n,t,r),y.vertexWrite((0,ie.UJ)(8*i,8*n)),y.vertexWrite(_),y.vertexWrite(e._fillColor),e.key.simple||(y.vertexWrite(0),y.vertexWrite(0)),y.vertexWrite(p),y.vertexWrite(d),e.key.simple||y.vertexWrite(e.minMaxZoom),y.vertexEnd(),e.offset+e.vertexCount++}},Si=function(e){return function(t,r,i){var n=e.out;n.indexWrite(t),n.indexWrite(r),n.indexWrite(i),e.indexCount+=3}},wi=d.Z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate"),Pi=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n,s,o,u,l,h,c,f,v,p,d,y,_,m,g,x,k){var b;(0,a.Z)(this,r),b=t.call(this);var M=ne.a.load(e);i&&(M.sdf=i.sdf,M.pattern=!0,M.textureBinding=i.textureBinding),b._capType=s,b._joinType=o,b._miterLimitCosine=ce(u),b.tessellationProperties._fillColor=l,b.tessellationProperties._tl=h,b.tessellationProperties._br=c,b._hasPattern=f,b._isDashed=v,b._zOrder=m,b._effects=g,b._minMaxZoom=(0,ie.UJ)(Math.round(x*N.MI),Math.round(k*N.MI)),b._materialKey=M.data;var S=(d?N.Uh:0)|(y?N.SD:0)|(p?N._6:0);return b.tessellationProperties._bitset=S,b.tessellationProperties._halfWidth=.5*n,b.tessellationProperties._halfReferenceWidth=.5*_,b.tessellationProperties.offset=0,b._initializeTessellator(!1),b}return(0,s.Z)(r,null,[{key:"fromCIMLine",value:function(e,t,i){var n=e.color,a=e.scaleFactor||1,s=!!e.dashTemplate,o=e.cap;s&&o===ee.RL.ROUND&&(o=ee.RL.SQUARE);var u=e.join,l=(0,Q.F2)(e.width)*a,h=(0,Q.F2)(e.referenceWidth),c=(0,Q.F2)(e.miterLimit),f=n&&(0,re.t2)(n)||0,v=fe(e.scaleInfo,i),p=(0,j.Z)(v,2),d=p[0],y=p[1];if(!t)return new r(e.materialKey,t,l,o,u,c,f,0,0,!1,s,e.scaleDash,e.colorLocked,!1,h,e.zOrder,e.effects,d,y);var _=t.rect,m=t.width,g=t.height,x=_.x+N.fL,k=_.y+N.fL,b=x+m,M=k+g,S=(0,ie.UJ)(x,k),w=(0,ie.UJ)(b,M);return new r(e.materialKey,t,l,o,u,c,f,S,w,!0,s,e.scaleDash,e.colorLocked,!1,h,e.zOrder,e.effects,d,y)}},{key:"fromFillOutline",value:function(e){var t;return e.isOutlinedFill&&e.outline&&"esriSLSSolid"===(null==(t=e.outline)?void 0:t.style)?r.fromSimpleLine((0,Rr.Z)({hash:"",materialKey:e.materialKey},e.outline),null,!0):null}},{key:"fromSimpleLine",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.color,a="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,s=(0,G.ws)(e.cap||"round"),o=(0,G.xV)(e.join||"round"),u=n&&"esriSLSNull"!==e.style&&(0,re.aH)(n)||0;"esriSLSNull"===e.style&&(u=0);var l=(0,Q.F2)(e.width),h=e.miterLimit;if(!t)return new r(e.materialKey,t,l,s,o,h,u,0,0,!1,a,!0,!1,i,l,0,null,0,ae);var c=t.rect,f=t.width,v=t.height,p=c.x+N.fL,d=c.y+N.fL,y=p+f,_=d+v,m=(0,ie.UJ)(p,d),g=(0,ie.UJ)(y,_);return new r(e.materialKey,t,l,s,o,h,u,m,g,!0,a,!0,!1,i,l,0,null,0,ae)}},{key:"fromPictureLineSymbol",value:function(e,t,r,i){return wi.error("PictureLineSymbol support does not exist!"),null}}]),r}(ki(wr)),Ci=function(e){return function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;(0,a.Z)(this,r);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).forceLibtess=!1,e._bitset=0,e._lineTemplate=null,e.geometryType=V.LW.FILL,e}return(0,s.Z)(r,[{key:"_maybeAddLineTemplate",value:function(e){this._lineTemplate=Pi.fromFillOutline(e)}},{key:"_write",value:function(e,t,r,i){var n="esriGeometryPoint"===t.geometryType,a=ne.dk.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,n),this._writeGeometry(e,t,a,i,n),a.outlinedFill&&(0,y.pC)(this._lineTemplate)&&this._lineTemplate.writeGeometry(e,t,i,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i,n){var a=this._getGeometry(t,i,n);if(!(0,y.Wi)(a)){var s=[];if(a.maxLength>100||this.forceLibtess||!function(e,t){var r=t.coords,i=t.lengths,n=e;if(t.hasIndeterminateRingOrder)return!1;for(var a=0,s=0;s<i.length;){for(var o=s,u=i[s],l=_i(r,a,u),h=[];++o<i.length;){var c=i[o],f=_i(r,a+u,c);if(!(f>0))break;l+=f,h.push(a+u),u+=c}var v=n.length;Br(n,r,a,a+u,h,2,0);var p=mi(n,r,v,n.length,0),d=Math.abs(l);if(Math.abs((p-d)/Math.max(1e-7,d))>1e-5)return n.length=0,!1;s=o,a+=u}return!0}(s,a)){var o=function(e){var t=e.coords,r=e.lengths;return(0,K.b)(t,r).buffer}(a);this._writeVertices(e,t,o,[o.length/2],r)}else s.length&&this._writeVertices(e,t,a.coords,a.lengths,r,s)}}},{key:"_writeVertex",value:function(e,t,r,i,n,a){var s=(0,ie.UJ)(1*i,1*n);e.vertexBounds(i,n,0,0),e.vertexWrite(s),e.vertexWrite(t),r.dotDensity?e.vertexWriteF32(1/Math.abs(a.readGeometryArea())):(e.vertexWrite(this.fillColor),r.simple||(e.vertexWrite(this.tl),e.vertexWrite(this.br)),e.vertexWrite(this.aux2),e.vertexWrite(this.aux3),r.simple||e.vertexWrite(this._minMaxZoom))}},{key:"_writeVertices",value:function(e,t,r,n,a,s){var o=t.getDisplayId(),u=this._bitset<<24|o,l=n.reduce((function(e,t){return e+t})),h=a.dotDensity?4:10,c=e.vertexCount();e.vertexEnsureSize(h*l);var f=0;if(s){var v,p=(0,i.Z)(s);try{for(p.s();!(v=p.n()).done;){var d=v.value,y=r[2*d],_=r[2*d+1];this._writeVertex(e,u,a,y,_,t),f++}}catch(b){p.e(b)}finally{p.f()}}else for(var m=0;m<r.length;m+=2){var g=Math.round(r[m]),x=Math.round(r[m+1]);this._writeVertex(e,u,a,g,x,t),f++}e.indexEnsureSize(f);for(var k=0;k<f;k++)e.indexWrite(k+c)}},{key:"_getGeometry",value:function(e,t,r){var n=t?(0,xe.oB)((0,xe.GH)(t),2):e.readGeometryForDisplay();return n?function(e,t){if((0,y.Wi)(e))return null;if(!function(e,t,r){for(var i=0,n=0;n<e.lengths.length;n++){for(var a=e.lengths[n],s=0;s<a;s++){var o=e.coords[2*(s+i)],u=e.coords[2*(s+i)+1];if(o<t||o>r||u<t||u>r)return!0}i+=a}return!1}(e,-128,N.I_+128))return e;di.setPixelMargin(t),di.reset(Gr.V.Polygon);for(var r=0,n=0;n<e.lengths.length;n++){var a=e.lengths[n],s=e.coords[2*(0+r)],o=e.coords[2*(0+r)+1];di.moveTo(s,o);for(var u=1;u<a;u++)s=e.coords[2*(u+r)],o=e.coords[2*(u+r)+1],di.lineTo(s,o);di.close(),r+=a}var l=di.result(!1);if(!l)return null;var h,c=[],f=[],v=(0,i.Z)(l);try{for(v.s();!(h=v.n()).done;){var p,d=h.value,_=0,m=(0,i.Z)(d);try{for(m.s();!(p=m.n()).done;){var g=p.value;f.push(g.x),f.push(g.y),_++}}catch(x){m.e(x)}finally{m.f()}c.push(_)}}catch(x){v.e(x)}finally{v.f()}return new Vr.Z(c,f)}(n,r?256:8):null}}]),r}(e)},Zi=r(51995),Li=r(643),Ii=r(819);var Ti=[1/256,1/65536,1/16777216,1/4294967296];!function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,i=0;i<4;i++)r+=e[t+i]*Ti[i]}(new Uint8ClampedArray([255,255,255,255]));var zi=r(13005),Ei=r(4954),Fi=r(76200),Ai=function(){function e(){(0,a.Z)(this,e),this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null}return(0,s.Z)(e,[{key:"destroy",value:function(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}},{key:"getResource",value:function(e){var t;return null!=(t=this._resourceMap.get(e))?t:null}},{key:"fetchResource",value:function(){var e=(0,n.Z)(l.mark((function e(t,r){var i,n,a,s,o=this;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={width:0,height:0},n=this._resourceMap,!(a=n.get(t))){e.next=3;break}return e.abrupt("return",(i.width=a.width,i.height=a.height,i));case 3:return s=this._inFlightResourceMap.get(t),e.abrupt("return",s||(s=Ri(t,r),this._inFlightResourceMap.set(t,s),s=s.then((function(e){if(o._inFlightResourceMap.delete(t),e.ok){n.set(t,e.value);var r=e.value;return i.width=r.width,i.height=r.height,i}return i})),s));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}}]),e}();function Ri(e,t){if(e.includes(";base64,")){var r=new Image;return r.src=e,r.decode().then((function(){return{ok:!0,value:r}})).catch((function(t){return(0,_.D_)(t)?{ok:!1,error:t}:{ok:!1,error:new v.Z("invalid-resource","Could not fetch requested resource at ".concat(e))}}))}return(0,Fi.default)(e,(0,Rr.Z)({responseType:"image"},t)).then((function(e){return{ok:!0,value:e.data}})).catch((function(t){return(0,_.D_)(t)?{ok:!1,error:t}:{ok:!1,error:new v.Z("invalid-resource","Could not fetch requested resource at ".concat(e))}}))}var Oi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,a.Z)(this,e),this.x=t,this.y=r,this.width=i,this.height=n}return(0,s.Z)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}();var Wi=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"rasterizeText",value:function(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));var r=this._textRasterizationCanvas,n=r.getContext("2d");this._setFontProperties(n,t),this.parameters=t,this.textLines=e.split(/\r?\n/),this.lineHeight=this._computeLineHeight();var a=this._computeTextWidth(n,t),s=t.font,o=s.decoration,u=s.weight;this.lineThroughWidthOffset=o&&"line-through"===o?.1*this.lineHeight:0;var l=this.lineHeight*this.textLines.length;r.width=a+2*this.lineThroughWidthOffset,r.height=l,this.renderedLineHeight=Math.round(this.lineHeight*t.pixelRatio),this.renderedHaloSize=t.halo.size*t.pixelRatio,this.renderedWidth=a*t.pixelRatio,this.renderedHeight=l*t.pixelRatio,this.lineThroughWidthOffset*=t.pixelRatio,this.fillStyle=function(e){return"rgba(".concat(e.slice(0,3).toString(),",").concat(e[3],")")}(t.color),this.haloStyle=function(e){return"rgb(".concat(e.slice(0,3).toString(),")")}(t.halo.color);var h=this.renderedLineHeight,c=this.renderedHaloSize;this._setFontProperties(n,t);var f=function(e,t){return"center"===e?.5*t:"right"===e?t:0}(n.textAlign,this.renderedWidth)+c,v=c,p=c>0,d=this.lineThroughWidthOffset,y=0;p&&this._renderHalo(n,f,v,d,y,t),y+=v,d+=f;var _,m=(0,i.Z)(this.textLines);try{for(m.s();!(_=m.n()).done;){var g=_.value;n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(g,d,y),n.globalCompositeOperation="source-over",n.fillStyle=this.fillStyle,n.fillText(g,d,y),o&&"none"!==o&&this._renderDecoration(n,d,y,o,u),y+=h}}catch(P){m.e(P)}finally{m.f()}var x=this.renderedWidth+2*this.lineThroughWidthOffset,k=this.renderedHeight,b=n.getImageData(0,0,x,k),M=new Uint8Array(b.data);if(t.premultiplyColors)for(var S,w=0;w<M.length;w+=4)S=M[w+3]/255,M[w]=M[w]*S,M[w+1]=M[w+1]*S,M[w+2]=M[w+2]*S;return{size:[x,k],image:new Uint32Array(M.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}},{key:"_renderHalo",value:function(e,t,r,i,n,a){var s=this.renderedWidth,o=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=s,this._haloRasterizationCanvas.height=o;var u=this._haloRasterizationCanvas,l=u.getContext("2d");l.clearRect(0,0,s,o),this._setFontProperties(l,a);var h=a.font,c=h.decoration,f=h.weight;l.fillStyle=this.haloStyle,l.strokeStyle=this.haloStyle;var v=this.renderedHaloSize<3;l.lineJoin=v?"miter":"round",v?this._renderHaloEmulated(l,t,r,c,f):this._renderHaloNative(l,t,r,c,f),e.globalAlpha=this.parameters.halo.color[3],e.drawImage(u,0,0,s,o,i,n,s,o),e.globalAlpha=1}},{key:"_renderHaloEmulated",value:function(e,t,r,n,a){var s,o=this.renderedLineHeight,u=this.renderedHaloSize,l=(0,i.Z)(this.textLines);try{for(l.s();!(s=l.n()).done;){var h,c=s.value,f=(0,i.Z)(Ni);try{for(f.s();!(h=f.n()).done;){var v=(0,j.Z)(h.value,2),p=v[0],d=v[1];e.fillText(c,t+u*p,r+u*d)}}catch(y){f.e(y)}finally{f.f()}n&&"none"!==n&&this._renderDecoration(e,t,r,n,a),r+=o}}catch(y){l.e(y)}finally{l.f()}}},{key:"_renderHaloNative",value:function(e,t,r,n,a){var s,o=this.renderedLineHeight,u=this.renderedHaloSize,l=(0,i.Z)(this.textLines);try{for(l.s();!(s=l.n()).done;){for(var h=s.value,c=2*u,f=0;f<5;f++){var v=.6+.1*f;e.lineWidth=v*c,e.strokeText(h,t,r),n&&"none"!==n&&this._renderDecoration(e,t,r,n,a)}r+=o}}catch(p){l.e(p)}finally{l.f()}}},{key:"_setFontProperties",value:function(e,t){var r,i=t.font,n="".concat(i.style," ").concat(i.weight," ").concat((0,Q.F2)(t.size*t.pixelRatio),"px ").concat(i.family,", sans-serif");switch(e.font=n,e.textBaseline="top",t.horizontalAlignment){case"left":default:r="left";break;case"right":r="right";break;case"center":r="center"}e.textAlign=r}},{key:"computeTextSize",value:function(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));var r=this._textRasterizationCanvas,i=r.getContext("2d");this._setFontProperties(i,t),this.parameters=t,this.textLines=e.split(/\r?\n/),this.lineHeight=this._computeLineHeight();var n=this._computeTextWidth(i,t),a=this.lineHeight*this.textLines.length;return r.width=n,r.height=a,[n*t.pixelRatio,a*t.pixelRatio]}},{key:"_computeTextWidth",value:function(e,t){var r,n=0,a=(0,i.Z)(this.textLines);try{for(a.s();!(r=a.n()).done;){var s=r.value;n=Math.max(n,e.measureText(s).width)}}catch(u){a.e(u)}finally{a.f()}var o=t.font;return("italic"===o.style||"oblique"===o.style||"string"==typeof o.weight&&("bold"===o.weight||"bolder"===o.weight)||"number"==typeof o.weight&&o.weight>600)&&(n+=.3*e.measureText("w").width),n+=2*this.parameters.halo.size,Math.round(n)}},{key:"_computeLineHeight",value:function(){var e=1.275*this.parameters.size,t=this.parameters.font.decoration;return t&&"underline"===t&&(e*=1.3),Math.round(e+2*this.parameters.halo.size)}},{key:"_renderDecoration",value:function(e,t,r,i,n){var a=.9*this.lineHeight,s="bold"===n?.06:"bolder"===n?.09:.04;switch(e.textAlign){case"center":t-=this.renderedWidth/2;break;case"right":t-=this.renderedWidth}var o=e.textBaseline;if("underline"===i)switch(o){case"top":r+=a;break;case"middle":r+=a/2}else if("line-through"===i)switch(o){case"top":r+=a/1.5;break;case"middle":r+=a/3}e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=Math.ceil(a*s),e.moveTo(t-this.lineThroughWidthOffset,r),e.lineTo(t+this.renderedWidth+2*this.lineThroughWidthOffset,r),e.stroke(),e.restore()}}]),e}();for(var Ni=[],Vi=0;Vi<360;Vi+=22.5)Ni.push([Math.cos(Math.PI*Vi/180),Math.sin(Math.PI*Vi/180)]);var Gi=Math.PI/180,Di=d.Z.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),Bi=function(){function e(t){(0,a.Z)(this,e),this._t=t}return(0,s.Z)(e,[{key:"clone",value:function(){return new e(this._t.slice())}},{key:"transform",value:function(e){var t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}},{key:"scale",value:function(e,t){var r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=t,r[4]*=t,r[5]*=t,this}},{key:"scaleRatio",value:function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}},{key:"translate",value:function(e,t){var r=this._t;return r[2]+=e,r[5]+=t,this}},{key:"rotate",value:function(t){return e.multiply(this,e.createRotate(t),this)}},{key:"invert",value:function(){var t=this._t,r=t[0]*t[4]-t[1]*t[3];if(0===r)return new e([0,0,0,0,0,0]);r=1/r;var i=(t[1]*t[5]-t[2]*t[4])*r,n=(t[2]*t[3]-t[0]*t[5])*r;return new e([t[4]*r,-t[1]*r,i,-t[3]*r,t[0]*r,n])}}],[{key:"createIdentity",value:function(){return new e([1,0,0,0,1,0])}},{key:"createScale",value:function(t,r){return new e([t,0,0,0,r,0])}},{key:"createTranslate",value:function(t,r){return new e([0,0,t,0,0,r])}},{key:"createRotate",value:function(t){var r=Math.cos(t),i=Math.sin(t);return new e([r,-i,0,i,r,0])}},{key:"multiply",value:function(e,t,r){var i=e._t,n=t._t,a=i[0]*n[0]+i[3]*n[1],s=i[1]*n[0]+i[4]*n[1],o=i[2]*n[0]+i[5]*n[1]+n[2],u=i[0]*n[3]+i[3]*n[4],l=i[1]*n[3]+i[4]*n[4],h=i[2]*n[3]+i[5]*n[4]+n[5],c=r._t;return c[0]=a,c[1]=s,c[2]=o,c[3]=u,c[4]=l,c[5]=h,r}}]),e}(),Xi=function(){function e(t,r){(0,a.Z)(this,e),this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new zi.Z(Me,null,null,100),this._earlyReturn=!1,this._mapRotation=0,this._resourceManager=t||new Ai,this._transfos.push(r||Bi.createIdentity()),this._sizeTransfos.push(r?r.scaleRatio():1)}return(0,s.Z)(e,[{key:"setTransform",value:function(e,t){this._transfos=[e||Bi.createIdentity()],this._sizeTransfos=[t||(e?e.scaleRatio():1)]}},{key:"setGeomUnitsPerPoint",value:function(e){this._geomUnitsPerPoint=e}},{key:"transformPt",value:function(e){return this._transfos[this._transfos.length-1].transform(e)}},{key:"transformSize",value:function(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}},{key:"reverseTransformPt",value:function(e){return this._transfos[this._transfos.length-1].invert().transform(e)}},{key:"reverseTransformSize",value:function(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}},{key:"geomUnitsPerPoint",value:function(){return this.isEmbedded()?1:this._geomUnitsPerPoint}},{key:"isEmbedded",value:function(){return this._transfos.length>1}},{key:"back",value:function(){return this._transfos[this._transfos.length-1]}},{key:"push",value:function(e,t){var r=t?e.scaleRatio():1;Bi.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}},{key:"pop",value:function(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}},{key:"drawSymbol",value:function(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t);break;case"CIMTextSymbol":this.drawTextSymbol(e,t)}}},{key:"drawMultiLayerSymbol",value:function(e,t){if(e){var r=e.symbolLayers;if(r){var i=e.effects;if(i&&i.length>0){var n=this.executeEffects(i,t);if(n)for(var a=n.next();a;)this.drawSymbolLayers(r,a),a=n.next()}else this.drawSymbolLayers(r,t)}}}},{key:"executeEffects",value:function(e,t){var r,n=this._resourceManager.geometryEngine,a=new Mr(t),s=(0,i.Z)(e);try{for(s.s();!(r=s.n()).done;){var o=r.value,u=Vt(o);u&&(a=u.execute(a,o,this.geomUnitsPerPoint(),n))}}catch(l){s.e(l)}finally{s.f()}return a}},{key:"drawSymbolLayers",value:function(e,t){for(var r=e.length;r--;){var i=e[r];if(i&&!1!==i.enable){var n=i.effects;if(n&&n.length>0){var a=this.executeEffects(n,t);if(a)for(var s=null;(s=a.next())&&(this.drawSymbolLayer(i,s),!this._earlyReturn););}else this.drawSymbolLayer(i,t);if(this._earlyReturn)return}}}},{key:"drawSymbolLayer",value:function(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color);break;case"CIMHatchFill":this.drawHatchFill(t,e);break;case"CIMPictureFill":this.drawPictureFill(t,e);break;case"CIMGradientFill":this.drawGradientFill(t,e);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(t,e);break;case"CIMGradientStroke":this.drawGradientStroke(t,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}},{key:"drawHatchFill",value:function(e,t){var r=this._buildHatchPolyline(t,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(t.lineSymbol,r),this.popClipPath())}},{key:"drawPictureFill",value:function(e,t){}},{key:"drawGradientFill",value:function(e,t){}},{key:"drawPictureStroke",value:function(e,t){}},{key:"drawGradientStroke",value:function(e,t){}},{key:"drawMarkerLayer",value:function(e,t){var r=e.markerPlacement;if(r){var n=Gt(r);if(n){var a="CIMMarkerPlacementInsidePolygon"===r.type;a&&this.pushClipPath(t);var s=n.execute(t,r,this.geomUnitsPerPoint(),this._resourceManager.geometryEngine);if(s)for(var o=null;(o=s.next())&&(this.drawMarker(e,o),!this._earlyReturn););a&&this.popClipPath()}}else{var u,l,h=this._placementPool.acquire();if((0,be.wp)(t))h.tx=t.x,h.ty=t.y,this.drawMarker(e,h);else if((0,be.oU)(t))u=(0,Ei.tO)(t),l=(0,j.Z)(u,2),h.tx=l[0],h.ty=l[1],this.drawMarker(e,h);else{var c,f=(0,i.Z)(t.points);try{for(f.s();!(c=f.n()).done;){var v=c.value;if(h.tx=v[0],h.ty=v[1],this.drawMarker(e,h),this._earlyReturn)break}}catch(p){f.e(p)}finally{f.f()}}this._placementPool.release(h)}}},{key:"drawMarker",value:function(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}},{key:"drawPictureMarker",value:function(e,t){var r,i,n,a,s;if(e){var o=this._resourceManager.getResource(e.url),u=null!=(r=e.size)?r:10;if(!((0,y.Wi)(o)||u<=0)){var l=o.width,h=o.height;if(l&&h){var c=l/h,f=null!=(i=e.scaleX)?i:1,v=Bi.createIdentity(),p=e.anchorPoint;if(p){var d=p.x,_=p.y;"Absolute"!==e.anchorPointUnits&&(d*=u*c*f,_*=u),v.translate(-d,-_)}var m=null!=(n=e.rotation)?n:0;e.rotateClockwise&&(m=-m),this._mapRotation&&(m+=this._mapRotation),m&&v.rotate(m*Gi);var g=null!=(a=e.offsetX)?a:0,x=null!=(s=e.offsetY)?s:0;if(g||x){if(this._mapRotation){var k=Gi*this._mapRotation,b=Math.cos(k),M=Math.sin(k),S=g*M+x*b;g=g*b-x*M,x=S}v.translate(g,x)}var w=this.geomUnitsPerPoint();1!==w&&v.scale(w,w);var P=t.getAngle();P&&v.rotate(P),v.translate(t.tx,t.ty),this.push(v,!1),this.drawImage(e.url,u,e.scaleX),this.pop()}}}}},{key:"drawVectorMarker",value:function(e,t){var r,n,a,s;if(e){var o=e.markerGraphics;if(o){var u=null!=(r=e.size)?r:10,l=e.frame,h=l?l.ymax-l.ymin:0,c=u&&h?u/h:1,f=Bi.createIdentity();l&&f.translate(.5*-(l.xmax+l.xmin),.5*-(l.ymax+l.ymin));var v=e.anchorPoint;if(v){var p=v.x,d=v.y;"Absolute"!==e.anchorPointUnits?l&&(p*=l.xmax-l.xmin,d*=l.ymax-l.ymin):(p/=c,d/=c),f.translate(-p,-d)}1!==c&&f.scale(c,c);var y=null!=(n=e.rotation)?n:0;e.rotateClockwise&&(y=-y),this._mapRotation&&(y+=this._mapRotation),y&&f.rotate(y*Gi);var _=null!=(a=e.offsetX)?a:0,m=null!=(s=e.offsetY)?s:0;if(_||m){if(this._mapRotation){var g=Gi*this._mapRotation,x=Math.cos(g),k=Math.sin(g),b=_*k+m*x;_=_*x-m*k,m=b}f.translate(_,m)}var M=this.geomUnitsPerPoint();1!==M&&f.scale(M,M);var S=t.getAngle();S&&f.rotate(S),f.translate(t.tx,t.ty),this.push(f,e.scaleSymbolsProportionally);var w,P=(0,i.Z)(o);try{for(P.s();!(w=P.n()).done;){var C=w.value;if(C&&C.symbol&&C.geometry||Di.error("Invalid marker graphic",C),this.drawSymbol(C.symbol,C.geometry),this._earlyReturn)break}}catch(Z){P.e(Z)}finally{P.f()}this.pop()}}}},{key:"drawTextSymbol",value:function(e,t){var r,i,n,a;if(e&&(0,be.wp)(t)&&!((null!=(r=e.height)?r:10)<=0)){var s=Bi.createIdentity(),o=null!=(i=e.angle)?i:0;(o=-o)&&s.rotate(o*Gi);var u=null!=(n=e.offsetX)?n:0,l=null!=(a=e.offsetY)?a:0;(u||l)&&s.translate(u,l);var h=this.geomUnitsPerPoint();1!==h&&s.scale(h,h),s.translate(t.x,t.y),this.push(s,!1),this.drawText(e),this.pop()}}},{key:"_buildHatchPolyline",value:function(e,t,r){var i=(void 0!==e.separation?e.separation:4)*r,n=void 0!==e.rotation?e.rotation:0;if(0===i)return null;i<0&&(i=-i);for(var a=0,s=.5*i;a>s;)a-=i;for(;a<-s;)a+=i;var o=(0,W.Ue)();(0,mt.$P)(o,t),o[0]-=s,o[1]-=s,o[2]+=s,o[3]+=s;for(var u=[[o[0],o[1]],[o[0],o[3]],[o[2],o[3]],[o[2],o[1]]];n>180;)n-=180;for(;n<0;)n+=180;var l,h,c,f,v=Math.cos(n*Gi),p=Math.sin(n*Gi),d=-i*p,y=i*v;a=(void 0!==e.offsetX?e.offsetX*r:0)*p-(void 0!==e.offsetY?e.offsetY*r:0)*v,l=c=Number.MAX_VALUE,h=f=-Number.MAX_VALUE;for(var _=0,m=u;_<m.length;_++){var g=m[_],x=g[0],k=g[1],b=v*x+p*k,M=-p*x+v*k;l=Math.min(l,b),c=Math.min(c,M),h=Math.max(h,b),f=Math.max(f,M)}for(var S=v*l-p*(c=Math.floor(c/i)*i)-d*a/i,w=p*l+v*c-y*a/i,P=v*h-p*c-d*a/i,C=p*h+v*c-y*a/i,Z=1+Math.round((f-c)/i),L=[],I=0;I<Z;I++)S+=d,w+=y,P+=d,C+=y,L.push([[S,w],[P,C]]);return{paths:L}}}]),e}(),Ui=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i){var n;return(0,a.Z)(this,r),(n=t.call(this,e,i)).reset(),n}return(0,s.Z)(r,[{key:"reset",value:function(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}},{key:"envelope",value:function(){return new Oi(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}},{key:"bounds",value:function(){return(0,W.al)(this._xmin,this._ymin,this._xmax,this._ymax)}},{key:"drawSolidFill",value:function(e){if(e&&!(this._clipCount>0))if((0,be.oU)(e))this._processPath(e.rings,0);else if((0,be.l9)(e))this._processPath(e.paths,0);else if((0,be.YX)(e)){var t=Yi(e);t&&this._processPath(t.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}},{key:"drawSolidStroke",value:function(e,t,r){if(e&&!(this._clipCount>0)){var i=.5*this.transformSize(r);if((0,be.oU)(e))this._processPath(e.rings,i);else if((0,be.l9)(e))this._processPath(e.paths,i);else if((0,be.YX)(e)){var n=Yi(e);n&&this._processPath(n.rings,i)}else console.error("drawSolidStroke unexpected geometry type!")}}},{key:"pushClipPath",value:function(e){this.drawSolidFill(e),++this._clipCount}},{key:"popClipPath",value:function(){--this._clipCount}},{key:"drawImage",value:function(e,t,r){var i=r*t,n=t,a=this._resourceManager.getResource(e);!t&&(0,y.pC)(a)&&(i=r*a.width,n=a.height),this._merge(this.transformPt([-i/2,-n/2]),0),this._merge(this.transformPt([-i/2,n/2]),0),this._merge(this.transformPt([i/2,-n/2]),0),this._merge(this.transformPt([i/2,n/2]),0)}},{key:"drawText",value:function(e){this._textRasterizer||(this._textRasterizer=new Wi)}},{key:"_processPath",value:function(e,t){if(e){var r,n=(0,i.Z)(e);try{for(n.s();!(r=n.n()).done;){var a=r.value,s=a?a.length:0;if(s>1){this._merge(this.transformPt(a[0]),t);for(var o=1;o<s;++o)this._merge(this.transformPt(a[o]),t)}}}catch(u){n.e(u)}finally{n.f()}}}},{key:"_merge",value:function(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}}]),r}(Xi),Hi=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;return(0,a.Z)(this,r),(s=t.call(this,i,n))._ctx=e,s}return(0,s.Z)(r,[{key:"drawSolidFill",value:function(e,t){if(e){if((0,be.oU)(e))this._buildPath(e.rings,!0);else if((0,be.l9)(e))this._buildPath(e.paths,!0);else if((0,be.YX)(e))this._buildPath(Yi(e).rings,!0);else{if(!(0,be.aW)(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}var r=this._ctx;r.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",r.fill("evenodd")}}},{key:"drawSolidStroke",value:function(e,t,r,i,n,a){if(e&&t&&0!==r){if((0,be.oU)(e))this._buildPath(e.rings,!0);else if((0,be.l9)(e))this._buildPath(e.paths,!1);else{if(!(0,be.YX)(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(Yi(e).rings,!0)}var s=this._ctx;s.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",s.lineWidth=this.transformSize(r)+.5,this._setCapStyle(i),this._setJoinStyle(n),s.miterLimit=a,s.stroke()}}},{key:"pushClipPath",value:function(e){if(this._ctx.save(),(0,be.oU)(e))this._buildPath(e.rings,!0);else if((0,be.l9)(e))this._buildPath(e.paths,!0);else{if(!(0,be.YX)(e))return;this._buildPath(Yi(e).rings,!0)}this._ctx.clip("evenodd")}},{key:"popClipPath",value:function(){this._ctx.restore()}},{key:"drawImage",value:function(e,t,r){var i=this._resourceManager.getResource(e);if(!(0,y.Wi)(i)){var n=this._ctx,a=n.canvas.width,s=n.canvas.height,o=t*r*(i.width/i.height),u=r*t;t||(o=r*i.width,u=r*i.height),this._ctx.drawImage(i,0,0,i.width,i.height,0,0,Math.min(this.transformSize(o),a),Math.min(this.transformSize(u),s))}}},{key:"drawText",value:function(e){this._textRasterizer||(this._textRasterizer=new Wi)}},{key:"_buildPath",value:function(e,t){var r=this._ctx;if(r.beginPath(),e){var n,a=(0,i.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,o=s?s.length:0;if(o>1){var u=this.transformPt(s[0]);r.moveTo(u[0],u[1]);for(var l=1;l<o;++l)u=this.transformPt(s[l]),r.lineTo(u[0],u[1]);t&&r.closePath()}}}catch(h){a.e(h)}finally{a.f()}}}},{key:"_setCapStyle",value:function(e){switch(e){case ee.kP.Butt:this._ctx.lineCap="butt";break;case ee.kP.Round:this._ctx.lineCap="round";break;case ee.kP.Square:this._ctx.lineCap="square"}}},{key:"_setJoinStyle",value:function(e){switch(e){case ee.r4.Bevel:this._ctx.lineJoin="bevel";break;case ee.r4.Round:this._ctx.lineJoin="round";break;case ee.r4.Miter:this._ctx.lineJoin="miter"}}}]),r}(Xi),Yi=function(e){return e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null};function Ji(e,t,r,i){return function(e){return"function"==typeof e}(e)?e(t,r,i):e}function qi(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function Ki(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}var ji=function(e){return isNaN(e)||!e?0:e};r(99201);var $i=Math.PI,Qi=$i/2,en=96/72,tn=(Math.PI,d.Z.getLogger("esri.symbols.cim.CIMSymbolHelper"));function rn(e,t){switch(t.type){case"CIMSymbolReference":return rn(e,t.symbol);case"CIMPointSymbol":e.drawSymbol(t,{x:0,y:0});break;case"CIMLineSymbol":e.drawSymbol(t,{paths:[[[0,0],[0,1]]]});break;case"CIMPolygonSymbol":e.drawSymbol(t,{rings:[[[0,0],[0,1],[0,0]]]});break;case"CIMTextSymbol":e.drawSymbol(t,{x:0,y:0});break;case"CIMVectorMarker":var r=new Me;e.drawMarker(t,r)}return e.envelope()}var nn=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,null,[{key:"getEnvelope",value:function(e,t){var r=new Ui(t);if(Array.isArray(e)){var n,a,s=(0,i.Z)(e);try{for(s.s();!(a=s.n()).done;){var o=a.value;n?n.union(rn(r,o)):n=rn(r,o)}}catch(u){s.e(u)}finally{s.f()}return n}return rn(r,e)}},{key:"getTextureAnchor",value:function(e,t){var r=this.getEnvelope(e,t);if(!r)return[0,0,0];var i=(r.x+.5*r.width)*en,n=-(r.y+.5*r.height)*en,a=r.width*en+2,s=r.height*en+2;return[i/a,n/s,s]}},{key:"rasterize",value:function(e,t,r,i){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=r||this.getEnvelope(t,i);if(!a)return[null,0,0,0,0];var s=(a.x+.5*a.width)*en,o=(a.y+.5*a.height)*en;e.width=a.width*en,e.height=a.height*en,r||(e.width+=2,e.height+=2);var u=e.getContext("2d"),l=Bi.createScale(en,-en);l.translate(.5*e.width-s,.5*e.height+o);var h=new Hi(u,i,l);switch(t.type){case"CIMPointSymbol":var c={type:"point",x:0,y:0};h.drawSymbol(t,c);break;case"CIMVectorMarker":var f=new Me;h.drawMarker(t,f)}var v=u.getImageData(0,0,e.width,e.height),p=new Uint8Array(v.data);if(n)for(var d,y=0;y<p.length;y+=4)d=p[y+3]/255,p[y]=p[y]*d,p[y+1]=p[y+1]*d,p[y+2]=p[y+2]*d;return[p,e.width,e.height,-s/e.width,-o/e.height]}},{key:"fromTextSymbol",value:function(e){var t,r,i,n,a,s=e.angle,o=e.color,u=e.font,l=e.haloColor,h=e.haloSize,c=e.horizontalAlignment,v=e.kerning,p=e.text,d=e.verticalAlignment,y=e.xoffset,_=e.yoffset;u&&(t=u.family,r=u.style,i=u.weight,n=u.size,a=u.decoration);var m=!1;return p&&(m=f(p)[1]),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",angle:s,blockProgression:ee.zV.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:ee.eZ.Normal,fontEncoding:ee.DD.Unicode,fontFamilyName:t||"Arial",fontStyleName:cn(r,i),fontType:ee.Ky.Unspecified,haloSize:h,height:n,hinting:ee.Dd.Default,horizontalAlignment:un(null!=c?c:"center"),kerning:v,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:ji(y),offsetY:ji(_),strikethrough:"line-through"===a,underline:"underline"===a,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:hn(o)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:hn(l)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:m?ee.UX.RTL:ee.UX.LTR,verticalAlignment:ln(null!=d?d:"baseline"),verticalGlyphOrientation:ee.RS.Right,wordSpacing:100,billboardMode3D:ee.UR.FaceNearPlane},textString:p}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}},{key:"fromPictureFillSymbol",value:function(e){var t=e.height,r=e.outline,i=e.width,n=e.xoffset,a=e.xscale,s=e.yoffset,o=e.yscale,u=[],l={type:"CIMPolygonSymbol",symbolLayers:u};if(r){var h=r.cap,c=r.join,f=r.miterLimit,v=r.width;u.push({type:"CIMSolidStroke",color:hn(r.color),capStyle:sn(h),joinStyle:on(c),miterLimit:f,width:v})}var p=e.url;"esriPFS"===e.type&&e.imageData&&(p=e.imageData);var d="angle"in e?e.angle:0,y=i*(a||1),_=t*(o||1);return u.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:ee.Qb.Picture,tintColor:null,url:p,height:_,width:y,offsetX:ji(n),offsetY:ji(s),rotation:ji(-d),colorSubstitutions:null}),l}},{key:"fromSimpleFillSymbol",value:function(e){var t=e.color,r=e.style,i=e.outline,n=[],a={type:"CIMPolygonSymbol",symbolLayers:n},s=null;if(i){var o=i.cap,u=i.join,l=i.style;"solid"!==l&&"none"!==l&&"esriSLSSolid"!==l&&"esriSLSNull"!==l&&(s=[{type:"CIMGeometricEffectDashes",dashTemplate:pn(l,o),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),n.push({type:"CIMSolidStroke",color:hn(i.color),capStyle:sn(o),joinStyle:on(u),miterLimit:i.miterLimit,width:i.width,effects:s})}if(r&&"solid"!==r&&"none"!==r&&"esriSFSSolid"!==r&&"esriSFSNull"!==r){var h={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:hn(t),capStyle:ee.kP.Butt,joinStyle:ee.r4.Miter,width:.75}]},c=0,f=(0,$.fp)(Math.ceil(window.devicePixelRatio)),v=yn(r)?8*f:10*f;switch(r){case"vertical":case"esriSFSVertical":c=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":c=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":c=45;break;case"cross":case"esriSFSCross":c=0}n.push({type:"CIMHatchFill",lineSymbol:h,offsetX:0,offsetY:0,rotation:c,separation:v}),"cross"===r||"esriSFSCross"===r?n.push({type:"CIMHatchFill",lineSymbol:(0,ke.d9)(h),offsetX:0,offsetY:0,rotation:90,separation:v}):"diagonal-cross"!==r&&"esriSFSDiagonalCross"!==r||n.push({type:"CIMHatchFill",lineSymbol:(0,ke.d9)(h),offsetX:0,offsetY:0,rotation:45,separation:v})}else!r||"solid"!==r&&"esriSFSSolid"!==r||n.push({type:"CIMSolidFill",enable:!0,color:hn(t)});return a}},{key:"fromSimpleLineSymbol",value:function(t){var r=t.cap,i=t.color,n=t.join,a=t.marker,s=t.miterLimit,o=t.style,u=t.width,l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:pn(o,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);var h=[];if(a){var c;switch(a.placement){case"begin-end":c=ee.Tx.Both;break;case"begin":c=ee.Tx.JustBegin;break;case"end":c=ee.Tx.JustEnd;break;default:c=ee.Tx.None}var f=e.fromSimpleMarker(a,u,i).symbolLayers[0];f.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:c,offsetAlongLine:0},h.push(f)}return"none"!==o&&"esriSLSNull"!==o&&h.push({type:"CIMSolidStroke",color:hn(i),capStyle:sn(r),joinStyle:on(n),miterLimit:s,width:u,effects:l}),{type:"CIMLineSymbol",symbolLayers:h}}},{key:"fromPictureMarker",value:function(e){var t=e.angle,r=e.height,i=e.width,n=e.xoffset,a=e.yoffset,s=e.url;return"esriPMS"===e.type&&e.imageData&&(s=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:ee.Qb.Picture,tintColor:null,url:s,size:r,width:i,offsetX:ji(n),offsetY:ji(a),rotation:ji(-t)}]}}},{key:"fromSimpleMarker",value:function(e,t,r){var i,n=e.style,a=null!=(i=e.color)?i:r;if("path"===n){var s=[];if("outline"in e&&e.outline){var o=e.outline;s.push({type:"CIMSolidStroke",enable:!0,width:(0,Q.F2)(Math.round((0,Q.Wz)(o.width))),color:hn(o.color)})}s.push({type:"CIMSolidFill",enable:!0,color:hn(a),path:e.path});var u=dn("square"),l=(0,j.Z)(u,2),h=l[0],c=l[1];return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:ji(-e.angle),size:ji(e.size||6),offsetX:ji(e.xoffset),offsetY:ji(e.yoffset),frame:h,markerGraphics:[{type:"CIMMarkerGraphic",geometry:c,symbol:{type:"CIMPolygonSymbol",symbolLayers:s}}]}]}}var f,v=dn(n),p=(0,j.Z)(v,2),d=p[0],y=p[1];if(y&&d){var _=[];if("outline"in e&&e.outline){var m=e.outline;_.push({type:"CIMSolidStroke",enable:!0,width:m.width>.667?(0,Q.F2)(Math.round((0,Q.Wz)(m.width))):m.width,color:hn(m.color)})}else!t||"line-marker"!==e.type||"cross"!==e.style&&"x"!==e.style||_.push({type:"CIMSolidStroke",enable:!0,width:t,color:hn(a)});_.push({type:"CIMSolidFill",enable:!0,color:hn(a)});var g={type:"CIMPolygonSymbol",symbolLayers:_};f={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:ji(-e.angle),size:ji(e.size||6*t),offsetX:ji(e.xoffset),offsetY:ji(e.yoffset),frame:d,markerGraphics:[{type:"CIMMarkerGraphic",geometry:y,symbol:g}]}]}}return f}},{key:"fromCIMHatchFill",value:function(e){for(var t,r=null!=(t=e.separation)?t:4,i=r/2,n=this._getLineSymbolPeriod(e.lineSymbol)||4;n<4;)n*=2;var a=n/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-i,ymax:i},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:e.lineSymbol}],size:r}}},{key:"_getLineSymbolPeriod",value:function(e){if(e){var t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers){var r,n=(0,i.Z)(e.symbolLayers);try{for(n.s();!(r=n.n()).done;){var a=r.value,s=this._getEffectsRepeat(a.effects);if(s)return s;if(a){var o=this._getPlacementRepeat(a.markerPlacement);if(o)return o}}}catch(u){n.e(u)}finally{n.f()}}}return 0}},{key:"_getEffectsRepeat",value:function(e){if(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n)switch(n.type){case"CIMGeometricEffectDashes":var a=n.dashTemplate;if(a&&a.length){var s,o=0,u=(0,i.Z)(a);try{for(u.s();!(s=u.n()).done;){o+=s.value}}catch(l){u.e(l)}finally{u.f()}return 1&a.length&&(o*=2),o}break;case"CIMGeometricEffectWave":return n.period;default:tn.error("unsupported geometric effect type ".concat(n.type))}}}catch(l){r.e(l)}finally{r.f()}}return 0}},{key:"_getPlacementRepeat",value:function(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":var t=e.placementTemplate;if(t&&t.length){var r,n=0,a=(0,i.Z)(t);try{for(a.s();!(r=a.n()).done;){n+=r.value}}catch(s){a.e(s)}finally{a.f()}return 1&t.length&&(n*=2),n}}return 0}},{key:"fromCIMInsidePolygon",value:function(e){var t,r,i,n,a=e.markerPlacement,s=(0,Rr.Z)({type:e.type},e);return s.markerPlacement=null,s.anchorPoint=null,!0===a.shiftOddRows?(r=a.stepX/2,i=a.stepY,n=2*a.stepY,t=[{x:-r,y:0},{x:r,y:0},{x:0,y:i},{x:0,y:-i}].map((function(e){return{type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[s]}}}))):(r=a.stepX/2,i=a.stepY/2,n=a.stepY,t=[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMPointSymbol",symbolLayers:[s]}}]),{type:"CIMVectorMarker",frame:{xmin:-r,xmax:r,ymin:-i,ymax:i},markerGraphics:t,size:n}}},{key:"getFillColor",value:function(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers){var r,n=(0,i.Z)(t.symbolLayers);try{for(n.s();!(r=n.n()).done;){var a=r.value,s=e.getFillColor(a);if(null!=s)return s}}catch(o){n.e(o)}finally{n.f()}}break;case"CIMTextSymbol":return e.getFillColor(t.symbol);case"CIMSolidFill":return t.color}}},{key:"getStrokeColor",value:function(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers){var r,n=(0,i.Z)(t.symbolLayers);try{for(n.s();!(r=n.n()).done;){var a=r.value,s=e.getStrokeColor(a);if(void 0!==s)return s}}catch(o){n.e(o)}finally{n.f()}}break;case"CIMTextSymbol":return e.getStrokeColor(t.symbol);case"CIMSolidStroke":return t.color}}},{key:"getStrokeWidth",value:function(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers){var r,n=(0,i.Z)(t.symbolLayers);try{for(n.s();!(r=n.n()).done;){var a=r.value,s=e.getStrokeWidth(a);if(void 0!==s)return s}}catch(o){n.e(o)}finally{n.f()}}break;case"CIMTextSymbol":return e.getStrokeWidth(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}},{key:"getSize",value:function(t){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":var r=0;if(t.symbolLayers){var n,a=(0,i.Z)(t.symbolLayers);try{for(a.s();!(n=a.n()).done;){var s=n.value,o=e.getSize(s);o>r&&(r=o)}}catch(u){a.e(u)}finally{a.f()}}return r;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":return t.width;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":return t.size}}},{key:"getMarkerScaleRatio",value:function(e){if(e&&"CIMVectorMarker"===e.type&&!1!==e.scaleSymbolsProportionally&&e.frame){var t=e.frame.ymax-e.frame.ymin;return e.size/t}return 1}}]),e}(),an=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,null,[{key:"findApplicableOverrides",value:function(t,r,n){if(t&&r){if(t.primitiveName){var a,s=!1,o=(0,i.Z)(n);try{for(o.s();!(a=o.n()).done;){if(a.value.primitiveName===t.primitiveName){s=!0;break}}}catch(M){o.e(M)}finally{o.f()}if(!s){var u,l=(0,i.Z)(r);try{for(l.s();!(u=l.n()).done;){var h=u.value;h.primitiveName===t.primitiveName&&n.push(h)}}catch(M){l.e(M)}finally{l.f()}}}switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.effects){var c,f=(0,i.Z)(t.effects);try{for(f.s();!(c=f.n()).done;){var v=c.value;e.findApplicableOverrides(v,r,n)}}catch(M){f.e(M)}finally{f.f()}}if(t.symbolLayers){var p,d=(0,i.Z)(t.symbolLayers);try{for(d.s();!(p=d.n()).done;){var y=p.value;e.findApplicableOverrides(y,r,n)}}catch(M){d.e(M)}finally{d.f()}}break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(t.effects){var _,m=(0,i.Z)(t.effects);try{for(m.s();!(_=m.n()).done;){var g=_.value;e.findApplicableOverrides(g,r,n)}}catch(M){m.e(M)}finally{m.f()}}if(t.markerPlacement&&e.findApplicableOverrides(t.markerPlacement,r,n),"CIMVectorMarker"===t.type){if(t.markerGraphics){var x,k=(0,i.Z)(t.markerGraphics);try{for(k.s();!(x=k.n()).done;){var b=x.value;e.findApplicableOverrides(b,r,n),e.findApplicableOverrides(b.symbol,r,n)}}catch(M){k.e(M)}finally{k.f()}}}else"CIMCharacterMarker"===t.type?e.findApplicableOverrides(t.symbol,r,n):"CIMHatchFill"===t.type&&e.findApplicableOverrides(t.lineSymbol,r,n)}}}},{key:"findEffectOverrides",value:function(e,t,r){if(t&&e)for(var n=e.length,a=0;a<n;a++){var s=e[a],o=null==s?void 0:s.primitiveName;if(o){var u,l=!1,h=(0,i.Z)(r);try{for(h.s();!(u=h.n()).done;){if(u.value.primitiveName===o){l=!0;break}}}catch(p){h.e(p)}finally{h.f()}if(!l){var c,f=(0,i.Z)(t);try{for(f.s();!(c=f.n()).done;){var v=c.value;v.primitiveName===o&&r.push(v)}}catch(p){f.e(p)}finally{f.f()}}}}}},{key:"applyOverrides",value:function(t,r,n,a){if(r){var s=function(e){return e?e.charAt(0).toLowerCase()+e.substr(1):e};if(t.primitiveName){var o,u=(0,i.Z)(r);try{for(u.s();!(o=u.n()).done;){var l=o.value;if(l.primitiveName===t.primitiveName){var h=s(l.propertyName);if(a&&a.push({cim:t,nocapPropertyName:h,value:t[h]}),l.expression&&(l.value=e.toValue(l.propertyName,l.expression)),n){var c,f=!1,v=(0,i.Z)(n);try{for(v.s();!(c=v.n()).done;){c.value.primitiveName===t.primitiveName&&(f=!0)}}catch(P){v.e(P)}finally{v.f()}f||n.push(l)}t[h]=l.value}}}catch(P){u.e(P)}finally{u.f()}}switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.effects){var p,d=(0,i.Z)(t.effects);try{for(d.s();!(p=d.n()).done;){var y=p.value;e.applyOverrides(y,r,n,a)}}catch(P){d.e(P)}finally{d.f()}}if(t.symbolLayers){var _,m=(0,i.Z)(t.symbolLayers);try{for(m.s();!(_=m.n()).done;){var g=_.value;e.applyOverrides(g,r,n,a)}}catch(P){m.e(P)}finally{m.f()}}break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(t.effects){var x,k=(0,i.Z)(t.effects);try{for(k.s();!(x=k.n()).done;){var b=x.value;e.applyOverrides(b,r,n,a)}}catch(P){k.e(P)}finally{k.f()}}if("CIMVectorMarker"===t.type&&t.markerGraphics){var M,S=(0,i.Z)(t.markerGraphics);try{for(S.s();!(M=S.n()).done;){var w=M.value;e.applyOverrides(w,r,n,a),e.applyOverrides(w.symbol,r,n,a)}}catch(P){S.e(P)}finally{S.f()}}}}}},{key:"restoreOverrides",value:function(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.cim[n.nocapPropertyName]=n.value}}catch(a){r.e(a)}finally{r.f()}}},{key:"buildOverrideKey",value:function(e){var t,r="",n=(0,i.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;void 0!==a.value&&(r+="".concat(a.primitiveName).concat(a.propertyName).concat(JSON.stringify(a.value)))}}catch(s){n.e(s)}finally{n.f()}return r}},{key:"toValue",value:function(e,t){if("DashTemplate"===e)return t.split(" ").map((function(e){return Number(e)}));if("Color"===e){var r=new Zi.Z(t).toRgba();return r[3]*=255,r}return t}}]),e}(),sn=function(e){if(!e)return ee.kP.Butt;switch(e){case"butt":return ee.kP.Butt;case"square":return ee.kP.Square;case"round":return ee.kP.Round}},on=function(e){if(!e)return ee.r4.Miter;switch(e){case"miter":return ee.r4.Miter;case"round":return ee.r4.Round;case"bevel":return ee.r4.Bevel}},un=function(e){if(!e)return"Center";switch(e){case"left":return"Left";case"right":return"Right";case"center":return"Center";case"justify":return"Justify"}},ln=function(e){if(!e)return"Center";switch(e){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},hn=function(e){return e?[e.r,e.g,e.b,255*e.a]:[0,0,0,0]},cn=function(e,t){var r=fn(t),i=vn(e);return r&&i?"".concat(r,"-").concat(i):"".concat(r).concat(i)},fn=function(e){if(!e)return"";switch(e.toLowerCase()){case"bold":case"bolder":return"bold"}return""},vn=function(e){if(!e)return"";switch(e.toLowerCase()){case"italic":case"oblique":return"italic"}return""},pn=function(e,t){var r="butt"===t;switch(e){case"dash":case"esriSLSDash":return r?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return r?[4,3,1,3]:[3,4,0,4];case"dot":case"esriSLSDot":return r?[1,3]:[0,4];case"long-dash":case"esriSLSLongDash":return r?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return r?[8,3,1,3]:[7,4,0,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return r?[8,3,1,3,1,3]:[7,4,0,4,0,4];case"short-dash":case"esriSLSShortDash":return r?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return r?[4,1,1,1]:[3,2,0,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return r?[4,1,1,1,1,1]:[3,2,0,2,0,2];case"short-dot":case"esriSLSShortDot":return r?[1,1]:[0,2];case"solid":case"esriSLSSolid":case"none":return tn.error("Unexpected: style does not require rasterization"),[0,0];default:return tn.error("Tried to rasterize SLS, but found an unexpected style: ".concat(e,"!")),[0,0]}};var dn=function(e){var t,r,i=50,n=e;if("circle"===n||"esriSMSCircle"===n){var a=Math.acos(.995),s=Math.ceil($i/a/4);0===s&&(s=1),a=Qi/s,s*=4;var o=[];o.push([i,0]);for(var u=1;u<s;u++)o.push([i*Math.cos(u*a),-i*Math.sin(u*a)]);o.push([i,0]),t={rings:[o]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("cross"===n||"esriSMSCross"===n){t={rings:[[[0,i],[0,0],[i,0],[i,-0],[0,-0],[0,-i],[-0,-i],[-0,-0],[-i,-0],[-i,0],[-0,0],[-0,i],[0,i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("diamond"===n||"esriSMSDiamond"===n)t={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("square"===n||"esriSMSSquare"===n)t={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("x"===n||"esriSMSX"===n){t={rings:[[[0,0],[50,i],[i,50],[0,0],[i,-50],[50,-i],[0,-0],[-50,-i],[-i,-50],[-0,0],[-i,50],[-50,i],[0,0]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("triangle"===n||"esriSMSTriangle"===n){var l=57.735026918962575,h=-l,c=2/3*100,f=c-100;t={rings:[[[h,f],[0,c],[l,f],[h,f]]]},r={xmin:h,ymin:f,xmax:l,ymax:c}}else"arrow"===n&&(t={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i});return[r,t]},yn=function(e){return"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e};function _n(e){var t,r=1/0,n=-1/0,a=1/0,s=-1/0,o=(0,i.Z)(e);try{for(o.s();!(t=o.n()).done;){var u,l=t.value,h=(0,i.Z)(l);try{for(h.s();!(u=h.n()).done;){var c=u.value;c[0]<r&&(r=c[0]),c[0]>n&&(n=c[0]),c[1]<a&&(a=c[1]),c[1]>s&&(s=c[1])}}catch(f){h.e(f)}finally{h.f()}}}catch(f){o.e(f)}finally{o.f()}return[r,a,n,s]}function mn(e){return e?e.rings?_n(e.rings):e.paths?_n(e.paths):(0,be.YX)(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function gn(e,t,r,i,n){var a=(0,j.Z)(e,4),s=a[0],o=a[1],u=a[2],l=a[3];if(u<s||l<o)return[0,0,0];var h=u-s,c=l-o,f=Math.floor(31.5),v=(128-2*(f+1))/Math.max(h,c),p=Math.round(h*v)+2*f,d=Math.round(c*v)+2*f,y=1;t&&(y=d/v/(t.ymax-t.ymin));var _=0,m=0;if(i)if(n){if(t&&r&&t.ymax-t.ymin>0){var g=(t.xmax-t.xmin)/(t.ymax-t.ymin);_=i.x/(r*g),m=i.y/r}}else _=i.x,m=i.y;return _=.5*(t.xmax+t.xmin)+_*(t.xmax-t.xmin),m=.5*(t.ymax+t.ymin)+m*(t.ymax-t.ymin),_-=s,m-=o,_*=v,m*=v,[y,(_+=f)/p-.5,-((m+=f)/d-.5)]}var xn=r(58971);function kn(e,t,r,i,n){var a=e.referencesGeometry()&&n?function(e,t,r){var i=r.transform,n=r.hasZ,a=r.hasM;bn.has(t)||bn.set(t,function(e){var t={};switch(e){case"esriGeometryPoint":return function(e,r,i,n){return(0,xn.U1)(r,t,e,i,n)};case"esriGeometryPolygon":return function(e,r,i,n){return(0,xn.Ie)(r,t,e,i,n)};case"esriGeometryPolyline":return function(e,r,i,n){return(0,xn.G6)(r,t,e,i,n)};case"esriGeometryMultipoint":return function(e,r,i,n){return(0,xn.J9)(r,t,e,i,n)};default:return d.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new v.Z("mapview-arcade","Unable to handle geometryType: ".concat(e))),function(e){return e}}}(t));var s=bn.get(t)(e.geometry,i,n,a);return(0,Rr.Z)((0,Rr.Z)({},e),{},{geometry:s})}(t,i,n):t,s=e.repurposeFeature(a);try{return e.evaluate((0,Rr.Z)((0,Rr.Z)({},r),{},{$feature:s}))}catch(o){return d.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",o),null}}var bn=new Map;function Mn(e){var t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}var Sn=d.Z.getLogger("esri.symbols.cim.cimAnalyzer");function wn(e){switch(e){case"Butt":return ee.RL.BUTT;case"Square":return ee.RL.SQUARE;default:return ee.RL.ROUND}}function Pn(e){switch(e){case"Bevel":return ee.AH.BEVEL;case"Miter":return ee.AH.MITER;default:return ee.AH.ROUND}}function Cn(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function Zn(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function Ln(e,t,r,i){var n;e[t]?n=e[t]:(n={},e[t]=n),n[r]=i}function In(e){var t=e.markerPlacement;return t&&t.angleToLine?ee.v2.MAP:ee.v2.SCREEN}function Tn(e,t,r,i,n){return zn.apply(this,arguments)}function zn(){return(zn=(0,n.Z)(l.mark((function e(t,r,n,a,s){var o,u,h,c,f,v,p,d,y;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null!=a?a:[],t){e.next=3;break}return e.abrupt("return",o);case 3:if(c={},"CIMSymbolReference"===t.type){e.next=6;break}return e.abrupt("return",(Sn.error("Expect cim type to be 'CIMSymbolReference'"),o));case 6:if(u=t.symbol,!(h=t.primitiveOverrides)){e.next=14;break}f=[],v=(0,i.Z)(h);try{for(d=function(){var e=p.value,t=e.valueExpressionInfo;if(t&&r){var i=t.expression,n=(0,Ii.Yi)(i,r.spatialReference,r.fields).then((function(t){t&&Ln(c,e.primitiveName,e.propertyName,t)}));f.push(n)}else null!=e.value&&Ln(c,e.primitiveName,e.propertyName,e.value)},v.s();!(p=v.n()).done;)d()}catch(l){v.e(l)}finally{v.f()}if(e.t0=f.length>0,!e.t0){e.next=14;break}return e.next=14,Promise.all(f);case 14:if(ea(u,n,y=[]),e.t2=y.length>0,!e.t2){e.next=20;break}return e.next=20,Promise.all(y);case 20:e.t1=u.type,e.next="CIMPointSymbol"===e.t1||"CIMLineSymbol"===e.t1||"CIMPolygonSymbol"===e.t1?23:24;break;case 23:En(u,h,c,r,o,n,s);case 24:return e.abrupt("return",o);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function En(e,t,r,i,n,a,s){if(e){var o=e.symbolLayers;if(o){var u,l=e.effects,h=nn.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(u=ee.v2.MAP);for(var c=o.length;c--;){var f,v=o[c];if(v&&!1!==v.enable){var p=void 0;l&&l.length&&(p=(0,br.Z)(l));var d=v.effects;d&&d.length&&(l?(f=p).push.apply(f,(0,br.Z)(d)):p=(0,br.Z)(d));var y,_=[];an.findEffectOverrides(p,t,_),y=_.length>0?Kn(p,_,r,i):p;var m=[];switch(an.findApplicableOverrides(v,t,m),v.type){case"CIMSolidFill":Fn(v,y,r,m,i,n);break;case"CIMPictureFill":An(v,y,r,m,i,a,n);break;case"CIMHatchFill":Rn(v,y,r,m,i,n);break;case"CIMGradientFill":On(v,y,r,m,i,n);break;case"CIMSolidStroke":Wn(v,y,r,m,i,n,"CIMPolygonSymbol"===e.type,h);break;case"CIMPictureStroke":Nn(v,y,r,m,i,n,"CIMPolygonSymbol"===e.type,h);break;case"CIMGradientStroke":Vn(v,y,r,m,i,n,"CIMPolygonSymbol"===e.type,h);break;case"CIMCharacterMarker":if(Gn(v,y,r,m,i,n))break;break;case"CIMPictureMarker":if(Gn(v,y,r,m,i,n))break;"CIMLineSymbol"===e.type&&(u=In(v)),Dn(v,y,r,m,i,a,n,u,h);break;case"CIMVectorMarker":if(Gn(v,y,r,m,i,n))break;"CIMLineSymbol"===e.type&&(u=In(v)),Bn(v,y,r,m,i,n,a,u,h,s);break;default:Sn.error("Cannot analyze CIM layer",v.type)}}}}}}function Fn(e,t,r,i,n,a){var s=e.primitiveName,o=Ki(e.color),u=Qn(i,s,t,null),l=(0,j.Z)(u,2),h=l[0],c=l[1],f=(0,Li.hP)(JSON.stringify(e)+c).toString();a.push({type:"fill",templateHash:f,materialHash:h?function(){return f}:f,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:qn(s,r,"Color",n,o,Jn),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t})}function An(e,t,r,i,n,a,s){var o=e.primitiveName,u=e.tintColor?Ki(e.tintColor):{r:255,g:255,b:255,a:1},l=Qn(i,o,t,null),h=(0,j.Z)(l,2),c=h[0],f=h[1],v=(0,Li.hP)(JSON.stringify(e)+f).toString(),p=(0,Li.hP)("".concat(e.url).concat(JSON.stringify(e.colorSubstitutions))).toString(),d=ji(e.scaleX);if("width"in e){var _=e.width,m=1,g=a.getResource(e.url);(0,y.pC)(g)&&(m=g.width/g.height),d/=m*(e.height/_)}s.push({type:"fill",templateHash:v,materialHash:c?function(){return p}:p,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:qn(o,r,"TintColor",n,u,Jn),height:qn(o,r,"Height",n,e.height),scaleX:qn(o,r,"ScaleX",n,d),angle:qn(o,r,"Rotation",n,ji(e.rotation)),offsetX:qn(o,r,"OffsetX",n,ji(e.offsetX)),offsetY:qn(o,r,"OffsetY",n,ji(e.offsetY)),url:e.url})}function Rn(e,t,r,i,n,a){var s=["Rotation","OffsetX","OffsetY"],o=i.filter((function(t){return t.primitiveName!==e.primitiveName&&-1===s.indexOf(t.propertyName)})),u=e.primitiveName,l=Qn(i,u,t,null),h=(0,j.Z)(l,2),c=h[0],f=h[1],v=(0,Li.hP)(JSON.stringify(e)+f).toString(),p=(0,Li.hP)("".concat(e.separation).concat(JSON.stringify(e.lineSymbol))).toString();a.push({type:"fill",templateHash:v,materialHash:c?$n(p,r,o,n):p,cim:e,materialOverrides:o,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:qn(u,r,"Separation",n,e.separation),scaleX:1,angle:qn(u,r,"Rotation",n,ji(e.rotation)),offsetX:qn(u,r,"OffsetX",n,ji(e.offsetX)),offsetY:qn(u,r,"OffsetY",n,ji(e.offsetY))})}function On(e,t,r,i,n,a){var s=Qn(i,e.primitiveName,t,null),o=(0,j.Z)(s,2),u=o[0],l=o[1],h=(0,Li.hP)(JSON.stringify(e)+l).toString();a.push({type:"fill",templateHash:h,materialHash:u?$n(h,r,i,n):h,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function Wn(e,t,r,i,n,a,s,o){var u,l,h=e.primitiveName,c=Ki(e.color),f=void 0!==e.width?e.width:4,v=wn(e.capStyle),p=Pn(e.joinStyle),d=e.miterLimit,y=Qn(i,h,t,null),_=(0,j.Z)(y,2),m=_[0],g=_[1],x=(0,Li.hP)(JSON.stringify(e)+g).toString();if(t&&t instanceof Array&&t.length>0){var k=t[t.length-1];if("CIMGeometricEffectDashes"===k.type&&"NoConstraint"===k.lineDashEnding&&null===k.offsetAlongLine){var b=(t=(0,br.Z)(t)).pop();u=b.dashTemplate,l=b.scaleDash}}a.push({type:"line",templateHash:x,materialHash:m?function(){return x}:x,cim:e,materialOverrides:null,isOutline:s,colorLocked:e.colorLocked,effects:t,color:qn(h,r,"Color",n,c,Jn),width:qn(h,r,"Width",n,f),cap:qn(h,r,"CapStyle",n,v),join:qn(h,r,"JoinStyle",n,p),miterLimit:qn(h,r,"MiterLimit",n,d),referenceWidth:o,zOrder:Yn(e.name),dashTemplate:u,scaleDash:l})}function Nn(e,t,r,i,n,a,s,o){var u=(0,Li.hP)("".concat(e.url).concat(JSON.stringify(e.colorSubstitutions))).toString(),l=e.primitiveName,h=Ki(e.tintColor),c=void 0!==e.width?e.width:4,f=wn(e.capStyle),v=Pn(e.joinStyle),p=e.miterLimit,d=Qn(i,l,t,null),y=(0,j.Z)(d,2),_=y[0],m=y[1],g=(0,Li.hP)(JSON.stringify(e)+m).toString();a.push({type:"line",templateHash:g,materialHash:_?function(){return u}:u,cim:e,materialOverrides:null,isOutline:s,colorLocked:e.colorLocked,effects:t,color:qn(l,r,"TintColor",n,h,Jn),width:qn(l,r,"Width",n,c),cap:qn(l,r,"CapStyle",n,f),join:qn(l,r,"JoinStyle",n,v),miterLimit:qn(l,r,"MiterLimit",n,p),referenceWidth:o,zOrder:Yn(e.name),dashTemplate:null,scaleDash:!1,url:e.url})}function Vn(e,t,r,i,n,a,s,o){var u=e.primitiveName,l=void 0!==e.width?e.width:4,h=wn(e.capStyle),c=Pn(e.joinStyle),f=e.miterLimit,v=Qn(i,u,t,null),p=(0,j.Z)(v,2),d=p[0],y=p[1],_=(0,Li.hP)(JSON.stringify(e)+y).toString();a.push({type:"line",templateHash:_,materialHash:d?$n(_,r,i,n):_,cim:e,materialOverrides:null,isOutline:s,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},width:qn(u,r,"Width",n,l),cap:qn(u,r,"CapStyle",n,h),join:qn(u,r,"JoinStyle",n,c),miterLimit:qn(u,r,"MiterLimit",n,f),referenceWidth:o,zOrder:Yn(e.name),dashTemplate:null,scaleDash:!1})}function Gn(e,t,r,i,n,a){var s=e.markerPlacement;if(!s||"CIMMarkerPlacementInsidePolygon"!==s.type)return!1;var o=s,u=["Rotation","OffsetX","OffsetY"],l=i.filter((function(t){return t.primitiveName!==e.primitiveName&&-1===u.indexOf(t.propertyName)})),h="url"in e?e.url:null,c=Qn(i,o.primitiveName,t,null),f=(0,j.Z)(c,2),v=f[0],p=f[1],d=(0,Li.hP)(JSON.stringify(e)+p).toString(),y=o.stepY,_=null,m=1;return s.shiftOddRows&&(y*=2,_=function(e){return e?2*e:0},m=.5),a.push({type:"fill",templateHash:d,materialHash:v?$n(d,r,l,n):d,cim:e,materialOverrides:l,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:qn(o.primitiveName,r,"StepY",n,y,_),scaleX:m,angle:qn(o.primitiveName,r,"GridAngle",n,o.gridAngle),offsetX:qn(o.primitiveName,r,"OffsetX",n,ji(o.offsetX)),offsetY:qn(o.primitiveName,r,"OffsetY",n,ji(o.offsetY)),url:h}),!0}function Dn(e,t,r,i,n,a,s,o,u){var l,h=e.primitiveName,c=ji(e.size),f=ji(e.scaleX),v=ji(e.rotation),p=ji(e.offsetX),d=ji(e.offsetY),_=e.tintColor?Ki(e.tintColor):{r:255,g:255,b:255,a:1},m=(0,Li.hP)("".concat(e.url).concat(JSON.stringify(e.colorSubstitutions))).toString(),g=Qn(i,h,t,jn(e.markerPlacement,i,r,n)),x=(0,j.Z)(g,2),k=x[0],b=x[1],M=(0,Li.hP)(JSON.stringify(e)+b).toString(),S=null!=(l=e.anchorPoint)?l:{x:0,y:0};if("width"in e){var w=e.width,P=1,C=a.getResource(e.url);(0,y.pC)(C)&&(P=C.width/C.height),f/=P*(c/w)}s.push({type:"marker",templateHash:M,materialHash:k?function(){return m}:m,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:!1,alignment:o,size:qn(h,r,"Size",n,c),scaleX:qn(h,r,"ScaleX",n,f),rotation:qn(h,r,"Rotation",n,v),offsetX:qn(h,r,"OffsetX",n,p),offsetY:qn(h,r,"OffsetY",n,d),color:qn(h,r,"TintColor",n,_,Jn),anchorPoint:{x:S.x,y:-S.y},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:u,sizeRatio:1,markerPlacement:e.markerPlacement,url:e.url})}function Bn(e,t,r,n,a,s,o,u,l,h){var c=e.markerGraphics;if(c){var f=0;if(e.scaleSymbolsProportionally){var v=e.frame;v&&(f=v.ymax-v.ymin)}var p,d=jn(e.markerPlacement,n,r,a),y=(0,i.Z)(c);try{for(y.s();!(p=y.n()).done;){var _=p.value;if(_){var m=_.symbol;if(!m)continue;switch(m.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":Un(e,t,d,_,n,r,a,s,o,u,l,f,h);break;case"CIMTextSymbol":Xn(e,t,d,_,r,n,a,s,u,l,f)}}}}catch(g){y.e(g)}finally{y.f()}}}function Xn(e,t,r,n,a,s,o,u,l,h,c){an.findApplicableOverrides(n,s,[]);var f=n.geometry;if("x"in f&&"y"in f){var v=n.symbol,p=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}(v),d=function(e){var t="",r="";if(e){var i=e.toLowerCase();-1!==i.indexOf("italic")?t="italic":-1!==i.indexOf("oblique")&&(t="oblique"),-1!==i.indexOf("bold")?r="bold":-1!==i.indexOf("light")&&(r="lighter")}return{style:t,weight:r}}(v.fontStyleName),y=Mn(v.fontFamilyName);v.font=(0,Rr.Z)({family:y,decoration:p},d);var _=e.frame,m=f.x-.5*(_.xmin+_.xmax),g=f.y-.5*(_.ymin+_.ymax),x=e.size/c,k=e.primitiveName,b=ji(v.height)*x,M=ji(v.angle),S=ji(e.offsetX)+(ji(v.offsetX)+m)*x,w=ji(e.offsetY)+(ji(v.offsetY)+g)*x,P=Ki(nn.getFillColor(v)),C=Ki(nn.getStrokeColor(v)),Z=nn.getStrokeWidth(v);Z||(C=Ki(nn.getFillColor(v.haloSymbol)),Z=v.haloSize*x);var L=Qn(s,k,t,r),I=(0,j.Z)(L,2),T=I[0],z=I[1],E=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),F=(0,Li.hP)(JSON.stringify(n)+E+z).toString(),A=qn(n.primitiveName,a,"TextString",o,n.textString,qi,v.textCase);if(null!=A){var R=v.fontStyleName,O=y+(R?"-"+R.toLowerCase():"-regular"),W=O;"string"==typeof A&&A.indexOf("[")>-1&&v.fieldMap&&(A=function(e,t,r){var n=function(e){for(var t=e.length;t--;)if(-1===" /-,\n".indexOf(e.charAt(t)))return!1;return!0},a=[],s=0,o=-1;do{if((o=t.indexOf("[",s))>=s){if(o>s){var u=t.substr(s,o-s);a.push([u,null,n(u)])}if(s=o+1,(o=t.indexOf("]",s))>=s){if(o>s){var l=e[t.substr(s,o-s)];l&&a.push([null,l,!1])}s=o+1}}}while(-1!==o);if(s<t.length-1){var h=t.substr(s);a.push([h,null,n(h)])}return function(e){var t,n="",s=null,o=(0,i.Z)(a);try{for(o.s();!(t=o.n()).done;){var u=t.value,l=(0,j.Z)(u,3),h=l[0],c=l[1],f=l[2];if(h)f?s=h:(s&&(n+=s,s=null),n+=h);else{var v=e.attributes[c];v&&(s&&(n+=s,s=null),n+=v)}}}catch(p){o.e(p)}finally{o.f()}return qi(n,r)}}(v.fieldMap,A,v.textCase)),u.push({type:"text",templateHash:F,materialHash:T||"function"==typeof A||A.match(/\[(.*?)\]/)?function(e,t,r){return W+"-"+Ji(A,e,t,r)}:W+"-"+(0,Li.hP)(A),cim:v,materialOverrides:null,colorLocked:e.colorLocked,effects:t,alignment:l,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:O,decoration:p,weight:qn(k,a,"Weight",o,d.weight),style:qn(k,a,"Size",o,d.style),size:qn(k,a,"Size",o,b),angle:qn(k,a,"Rotation",o,M),offsetX:qn(k,a,"OffsetX",o,S),offsetY:qn(k,a,"OffsetY",o,w),horizontalAlignment:Cn(v.horizontalAlignment),verticalAlignment:Zn(v.verticalAlignment),text:A,color:P,outlineColor:C,outlineSize:Z,referenceSize:h,sizeRatio:1,markerPlacement:r})}}}function Un(e,t,r,n,a,s,o,u,l,h,c,f,v){var p=n.symbol,d=p.symbolLayers;if(d)if(v)Hn(e,t,r,n,s,a,o,u,l,h,c,f);else{var _=d.length;if(ra(d))!function(e,t,r,n,a,s,o,u,l,h,c,f){var v=n.geometry,p=a[0],d=a[1],y=mn(v);if(!y)return;var _,m=gn(y,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),g=(0,j.Z)(m,3),x=g[0],k=g[1],b=g[2],M={type:"sdf",geom:v,asFill:!0},S=e.primitiveName,w=ji(e.size),P=ji(e.rotation),C=ji(e.offsetX),Z=ji(e.offsetY),L=d.path,I=d.primitiveName,T=p.primitiveName,z=Ki(nn.getFillColor(d)),E=Ki(nn.getStrokeColor(p)),F=nn.getStrokeWidth(p),A=!1,R="",O=(0,i.Z)(s);try{for(O.s();!(_=O.n()).done;){var W=_.value;W.primitiveName!==I&&W.primitiveName!==T&&W.primitiveName!==S||(void 0!==W.value?R+="-".concat(W.primitiveName,"-").concat(W.propertyName,"-").concat(JSON.stringify(W.value)):W.valueExpressionInfo&&(A=!0))}}catch(D){O.e(D)}finally{O.f()}var N=JSON.stringify((0,Rr.Z)((0,Rr.Z)({},e),{},{markerGraphics:null})),V=(0,Li.hP)(JSON.stringify(M)+L).toString(),G={type:"marker",templateHash:(0,Li.hP)(JSON.stringify(n)+JSON.stringify(d)+JSON.stringify(p)+N+R).toString(),materialHash:A?function(){return V}:V,cim:M,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:h,anchorPoint:{x:k,y:b},isAbsoluteAnchorPoint:!1,size:qn(e.primitiveName,o,"Size",u,w),rotation:qn(e.primitiveName,o,"Rotation",u,P),offsetX:qn(e.primitiveName,o,"OffsetX",u,C),offsetY:qn(e.primitiveName,o,"OffsetY",u,Z),scaleX:1,frameHeight:f,rotateClockwise:e.rotateClockwise,referenceSize:c,sizeRatio:x,color:qn(I,o,"Color",u,z,Jn),outlineColor:qn(T,o,"Color",u,E,Jn),outlineWidth:qn(T,o,"Width",u,F),markerPlacement:r,path:L};l.push(G)}(e,t,r,n,d,a,s,o,u,h,c,f);else{var m=Sr.applyEffects(p.effects,n.geometry,l.geometryEngine);if(m)for(;_--;){var g=d[_];if(g&&!1!==g.enable)switch(g.type){case"CIMSolidFill":case"CIMSolidStroke":var x,k=function(){var v=Sr.applyEffects(g.effects,m,l.geometryEngine),p=mn(v);if(!p)return"continue";var d=gn(p,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),_=(0,j.Z)(d,3),k=_[0],b=_[1],M=_[2],S="CIMSolidFill"===g.type,w={type:"sdf",geom:v,asFill:S},P=e.primitiveName,C=null!=(x=ji(e.size))?x:10,Z=ji(e.rotation),L=ji(e.offsetX),I=ji(e.offsetY),T=g.path,z=g.primitiveName,E=Ki(S?nn.getFillColor(g):nn.getStrokeColor(g)),F=S?{r:0,g:0,b:0,a:0}:Ki(nn.getStrokeColor(g)),A=nn.getStrokeWidth(g);if(!S&&!A)return"break";var R,O=!1,W="",N=(0,i.Z)(a);try{for(N.s();!(R=N.n()).done;){var V=R.value;V.primitiveName!==z&&V.primitiveName!==P||(void 0!==V.value?W+="-".concat(V.primitiveName,"-").concat(V.propertyName,"-").concat(JSON.stringify(V.value)):V.valueExpressionInfo&&(O=!0))}}catch(X){N.e(X)}finally{N.f()}(0,y.pC)(t)&&"function"==typeof t&&(O=!0);var G=JSON.stringify((0,Rr.Z)((0,Rr.Z)({},e),{},{markerGraphics:null})),D=(0,Li.hP)(JSON.stringify(w)+T).toString(),B={type:"marker",templateHash:(0,Li.hP)(JSON.stringify(n)+JSON.stringify(g)+G+W).toString(),materialHash:O?function(){return D}:D,cim:w,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:h,anchorPoint:{x:b,y:M},isAbsoluteAnchorPoint:!1,size:qn(e.primitiveName,s,"Size",o,C),rotation:qn(e.primitiveName,s,"Rotation",o,Z),offsetX:qn(e.primitiveName,s,"OffsetX",o,L),offsetY:qn(e.primitiveName,s,"OffsetY",o,I),scaleX:1,frameHeight:f,rotateClockwise:e.rotateClockwise,referenceSize:c,sizeRatio:k,color:qn(z,s,"Color",o,E,Jn),outlineColor:qn(z,s,"Color",o,F,Jn),outlineWidth:qn(z,s,"Width",o,A),markerPlacement:r,path:T};return u.push(B),"break"}();if("continue"===k)continue;if("break"===k)break;default:Hn(e,t,r,n,s,a,o,u,l,h,c,f)}}}}}function Hn(e,t,r,n,a,s,o,u,l,h,c,f){var v,p=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath}}(e,n),d=["Rotation","OffsetX","OffsetY"];v=s.filter((function(t){return t.primitiveName!==e.primitiveName||-1===d.indexOf(t.propertyName)}));var _,m="",g=(0,i.Z)(s);try{for(g.s();!(_=g.n()).done;){var x=_.value;void 0!==x.value&&(m+="-".concat(x.primitiveName,"-").concat(x.propertyName,"-").concat(JSON.stringify(x.value)))}}catch(z){g.e(z)}finally{g.f()}var k=nn.getTextureAnchor(p,l),b=(0,j.Z)(k,3),M=b[0],S=b[1],w=b[2],P=e.primitiveName,C=ji(e.rotation),Z=ji(e.offsetX),L=ji(e.offsetY),I=(0,Li.hP)(JSON.stringify(p)+m).toString(),T={type:"marker",templateHash:I,materialHash:v.length>0||(0,y.pC)(t)&&"function"==typeof t?$n(I,a,v,o):I,cim:p,materialOverrides:v,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:h,anchorPoint:{x:M,y:S},isAbsoluteAnchorPoint:!1,size:e.size,rotation:qn(P,a,"Rotation",o,C),offsetX:qn(P,a,"OffsetX",o,Z),offsetY:qn(P,a,"OffsetY",o,L),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:f,rotateClockwise:e.rotateClockwise,referenceSize:c,sizeRatio:w/(0,Q.F2)(e.size),markerPlacement:r};u.push(T)}function Yn(e){if(e&&0===e.indexOf("Level_")){var t=parseInt(e.substr(6),10);if(!isNaN(t))return t}return 0}function Jn(e){if(!e||0===e.length)return null;var t=new Zi.Z(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function qn(e,t,r,i,n,a,s){var o=t[e];if(o){var u=o[r];if("string"==typeof u||"number"==typeof u||u instanceof Array)return a?a.call(null,u,s):u;if(null!=u&&u instanceof Ii.mz)return function(e,t,r){var o=kn(u,e,{$view:r},i.geometryType,t);return null!==o&&a&&(o=a.call(null,o,s)),null!==o?o:n}}return n}function Kn(e,t,r,n){var a,s=(0,i.Z)(t);try{for(s.s();!(a=s.n()).done;){var o=a.value;o.valueExpressionInfo&&function(){var e=r[o.primitiveName]&&r[o.primitiveName][o.propertyName];e instanceof Ii.mz&&(o.fn=function(t,r,i){return kn(e,t,{$view:i},n.geometryType,r)})}()}}catch(l){s.e(l)}finally{s.f()}var u=function(e){return e?e.charAt(0).toLowerCase()+e.substr(1):e};return function(r,n,a){var s,o=(0,i.Z)(t);try{for(o.s();!(s=o.n()).done;){var h=s.value;h.fn&&(h.value=h.fn(r,n,a))}}catch(l){o.e(l)}finally{o.f()}var c,f=[],v=(0,i.Z)(e);try{for(v.s();!(c=v.n()).done;){var p,d=c.value,y=null==(p=d)?void 0:p.primitiveName;if(y){var _,m=!1,g=(0,i.Z)(t);try{for(g.s();!(_=g.n()).done;){var x=_.value;if(x.primitiveName===y){var k=u(x.propertyName);null!=x.value&&x.value!==d[k]&&(m||(d=(0,ke.d9)(d),m=!0),d[k]=x.value)}}}catch(l){g.e(l)}finally{g.f()}}f.push(d)}}catch(l){v.e(l)}finally{v.f()}return f}}function jn(e,t,r,n){var a=[];if(an.findApplicableOverrides(e,t,a),0===a.length)return e;for(var s=0,o=a;s<o.length;s++){var u=o[s];u.valueExpressionInfo&&function(){var e=r[u.primitiveName]&&r[u.primitiveName][u.propertyName];e instanceof Ii.mz&&(u.fn=function(t,r,i){return kn(e,t,{$view:i},n.geometryType,r)})}()}var l=function(e){return e?e.charAt(0).toLowerCase()+e.substr(1):e};return function(t,r,n){var s,o=(0,i.Z)(a);try{for(o.s();!(s=o.n()).done;){var u=s.value;u.fn&&(u.value=u.fn(t,r,n))}}catch(y){o.e(y)}finally{o.f()}var h,c=(0,ke.d9)(e),f=e.primitiveName,v=(0,i.Z)(a);try{for(v.s();!(h=v.n()).done;){var p=h.value;if(p.primitiveName===f){var d=l(p.propertyName);null!=p.value&&p.value!==c[d]&&(c[d]=p.value)}}}catch(y){v.e(y)}finally{v.f()}return c}}function $n(e,t,r,n){var a,s=(0,i.Z)(r);try{for(s.s();!(a=s.n()).done;){var o=a.value;o.valueExpressionInfo&&function(){var e=t[o.primitiveName]&&t[o.primitiveName][o.propertyName];e instanceof Ii.mz&&(o.fn=function(t,r,i){return kn(e,t,{$view:i},n.geometryType,r)})}()}}catch(u){s.e(u)}finally{s.f()}return function(t,n,a){var s,o=(0,i.Z)(r);try{for(o.s();!(s=o.n()).done;){var l=s.value;l.fn&&(l.value=l.fn(t,n,a))}}catch(u){o.e(u)}finally{o.f()}return(0,Li.hP)(e+an.buildOverrideKey(r)).toString()}}function Qn(e,t,r,n){var a,s=!1,o="",u=(0,i.Z)(e);try{for(u.s();!(a=u.n()).done;){var l=a.value;l.primitiveName===t&&(void 0!==l.value?o+="-".concat(l.primitiveName,"-").concat(l.propertyName,"-").concat(JSON.stringify(l.value)):l.valueExpressionInfo&&(s=!0))}}catch(h){u.e(h)}finally{u.f()}return(0,y.pC)(r)&&"function"==typeof r&&(s=!0),(0,y.pC)(n)&&"function"==typeof n&&(s=!0),[s,o]}function ea(e,t,r){if(e&&t)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":var n=e.symbolLayers;if(!n)return;var a,s=(0,i.Z)(n);try{for(s.s();!(a=s.n()).done;){var o=a.value;switch(ia(o,t,r),o.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in o&&o.url&&r.push(t.fetchResource(o.url,null));break;case"CIMVectorMarker":var u=o.markerGraphics;if(!u)continue;var l,h=(0,i.Z)(u);try{for(h.s();!(l=h.n()).done;){var c=l.value;if(c){var f=c.symbol;f&&ea(f,t,r)}}}catch(v){h.e(v)}finally{h.f()}}}}catch(v){s.e(v)}finally{s.f()}}}var ta,ra=function(e){return e&&2===e.length&&e[0].enable&&e[1].enable&&"CIMSolidStroke"===e[0].type&&"CIMSolidFill"===e[1].type&&!e[0].effects&&!e[1].effects};function ia(e,t,n){e.effects&&!(0,y.pC)(t.geometryEngine)&&(ta?n.push(ta):function(e){if(!e)return!1;var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;)switch(t.value.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}}catch(n){r.e(n)}finally{r.f()}return!1}(e.effects)&&(ta=Promise.all([r.e(9058),r.e(309)]).then(r.bind(r,50309)),n.push(ta),ta.then((function(e){return t.geometryEngine=e}))))}var na=d.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate"),aa=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this))._ongoingMaterialRequestMap=new Map,i._materialCache=new Map,i._dynamicPropertyMap=new Map,i._cimLayer=e,i}return(0,s.Z)(r,[{key:"analyze",value:function(e,t,r,i,n){var a=this;if(n&&0===n.length)return null;var s=n&&n.length>0,o=t.readLegacyFeature(),u=this._materialCache,l=this._cimLayer.materialHash;if(!l)return na.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);var h="function"==typeof l?l(o,r,i):l;if(u.has(h)){var c=u.get(h);return Promise.resolve(c)}var f=this._ongoingMaterialRequestMap.get(h);if(f)return f;var v=this._cimLayer,p=function(e,t){if(!t||0===t.length)return e;var r=JSON.parse(JSON.stringify(e));return an.applyOverrides(r,t),r}(v.cim,this._cimLayer.materialOverrides);p.mosaicHash=h;var d=v.type,y=v.url,_={cim:p,type:d,mosaicHash:h,url:y,size:null,dashTemplate:null,text:null,fontName:null};switch(d){case"marker":_.size=Ji(v.size,o,r,i);break;case"line":_.dashTemplate=v.dashTemplate;break;case"text":_.text=Ji(v.text,o,r,i),_.fontName=Ji(v.fontName,o,r,i)}var m=e.getMosaicItem(_,n).then((function(e){return s||(a._ongoingMaterialRequestMap.delete(h),u.set(h,e)),e})).catch((function(e){return a._ongoingMaterialRequestMap.delete(h),na.error(".analyze()",e.message),null}));return s||this._ongoingMaterialRequestMap.set(h,m),m}}]),r}(wr);function sa(e,t){if(e&&"name"in e){var r=e;return t&&t.error(new v.Z(r.name,r.message,r.details)),!1}return!0}var oa=128,ua=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s,o;if((0,a.Z)(this,r),(s=t.call(this,e))._minMaxZoom=(0,ie.UJ)(Math.round(i*N.MI),Math.round(n*N.MI)),he(e.color)){s._dynamicPropertyMap.set("fillColor",(function(t,r,i){var n=e.color(t,r,i);return n&&(0,re.t2)(n)||0}))}else{var u=e.color;s.fillColor=u&&(0,re.t2)(u)||0}var l="CIMMarkerPlacementInsidePolygon"===(null==(o=e.cim.placement)?void 0:o.type)&&e.cim.placement.shiftOddRows?2:1,h=e.height;if(he(h)){s._dynamicPropertyMap.set("_height",(function(e,t,r){return h(e,t,r)*l}))}else s._height=(h||0)*l;var c=e.offsetX;if(he(c)){s._dynamicPropertyMap.set("_offsetX",(function(e,t,r){var i=(0,Q.F2)(c(e,t,r))+oa;return i>255?i=255:i<0&&(i=0),i}))}else{var f=(0,Q.F2)(c||0)+oa;f>255?f=255:f<0&&(f=0),s._offsetX=f}var v=e.offsetY;if(he(v)){s._dynamicPropertyMap.set("_offsetY",(function(e,t,r){var i=(0,Q.F2)(-v(e,t,r))+oa;return i>255?i=255:i<0&&(i=0),i}))}else{var p=(0,Q.F2)(-v||0)+oa;p>255?p=255:p<0&&(p=0),s._offsetY=p}var d=e.scaleX;he(d)?s._dynamicPropertyMap.set("_scaleX",d):s._scaleX=d||1;var _=e.angle;if(he(_)){s._dynamicPropertyMap.set("_angle",(function(e,t,r){return(0,Nr.Or)(_(e,t,r))}))}else s._angle=(0,Nr.Or)(_)||0;if((0,y.pC)(e.effects)){var m=e.effects;he(m)?s._dynamicPropertyMap.set("_effects",m):s._effects=m}return s._cimFillLayer=e,s._fillMaterialKey=ne.dk.load(e.materialKey),(0,Wr.Z)(s)}return(0,s.Z)(r,[{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)}));var a=this._fillMaterialKey,s=this._materialCache,o=(0,this._cimFillLayer.materialHash)(n,t,r),u=s.get(o),l=null;if(u&&sa(u.spriteMosaicItem)&&(l=u.spriteMosaicItem),l){var h=l,c=h.rect,f=h.width,v=h.height,p=c.x+N.fL,d=c.y+N.fL,y=p+f,_=d+v,m=Math.round((0,Q.F2)(this._height));m>255?m=255:m<=0&&(m=_-d);var g=Math.round((0,Q.F2)(this._height/v*f||0));g>255?g=255:g<=0&&(g=y-p);var x=this._scaleX;this.tl=(0,ie.UJ)(p,d),this.br=(0,ie.UJ)(y,_),this.aux2=(0,ie.Jz)(g,m,this._offsetX,this._offsetY),this.aux3=(0,ie.Jz)(x,1,this._angle,0),a.sdf=l.sdf,a.pattern=!0,a.textureBinding=l.textureBinding}else this.tl=0,this.br=0,this.aux2=0,this.aux3=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data}}],[{key:"fromCIMFill",value:function(e,t){var i=fe(e.scaleInfo,t),n=(0,j.Z)(i,2);return new r(e,n[0],n[1])}}]),r}(Ci(aa)),la=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;(0,a.Z)(this,r),(s=t.call(this,e))._minMaxZoom=(0,ie.UJ)(Math.round(i*N.MI),Math.round(n*N.MI)),s._cimLineLayer=e;var o=0;he(e.width)||(o=.5*(0,Q.F2)(e.width));s._dynamicPropertyMap.set("_halfWidth",(function(t,r,i){return he(e.width)?.5*(0,Q.F2)(e.width(t,r,i)):o})),he(e.cap)?s._dynamicPropertyMap.set("_capType",e.cap):s._capType=e.cap,he(e.join)?s._dynamicPropertyMap.set("_joinType",e.join):s._joinType=e.join;var u=e.color;if(he(u)){s._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return(0,re.t2)(u(e,t,r))}))}else s._fillColor=u&&(0,re.t2)(u)||0;var l=e.miterLimit;if(he(l)){s._dynamicPropertyMap.set("_miterLimitCosine",(function(e,t,r){return ce(l(e,t,r))}))}else s._miterLimitCosine=ce(l);if((0,y.pC)(e.effects)){var h=e.effects;he(h)?s._dynamicPropertyMap.set("_effects",h):s._effects=h}return s._scaleFactor=e.scaleFactor||1,s._isDashed=null!=e.dashTemplate,s.tessellationProperties._bitset=(e.colorLocked?1:0)|(e.scaleDash?1:0)<<1,s._materialKey=e.materialKey,s._initializeTessellator(!0),s}return(0,s.Z)(r,[{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)})),this._halfWidth*=this._scaleFactor;var a=this._materialCache,s=(0,this._cimLineLayer.materialHash)(n,t,r),o=a.get(s),u=null;if(o&&sa(o.spriteMosaicItem)&&(u=o.spriteMosaicItem),u){this._hasPattern=!0;var l=u,h=l.rect,c=l.width,f=l.height,v=h.x+N.fL,p=h.y+N.fL,d=v+c,y=p+f;this.tessellationProperties._tl=(0,ie.UJ)(v,p),this.tessellationProperties._br=(0,ie.UJ)(d,y)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;var _=ne.a.load(this._materialKey);u&&(_.sdf=u.sdf,_.pattern=!0,_.textureBinding=u.textureBinding),this._materialKey=_.data}}],[{key:"fromCIMLine",value:function(e,t){var i=fe(e.scaleInfo,t),n=(0,j.Z)(i,2);return new r(e,n[0],n[1])}}]),r}(ki(aa)),ha=tr(),ca=$t(),fa=d.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate"),va=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;(0,a.Z)(this,r),(s=t.call(this,e))._cimMarkerLayer=e,s._minMaxZoom=(0,ie.UJ)(Math.round(i*N.MI),Math.round(n*N.MI));var o=e.color;if(he(o)){s._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return(0,re.t2)(o(e,t,r))}))}else s._fillColor=(0,re.t2)(o);var u=e.outlineColor;if(he(u)){s._dynamicPropertyMap.set("_outlineColor",(function(e,t,r){return(0,re.t2)(u(e,t,r))}))}else s._outlineColor=(0,re.t2)(u);var l=e.size;if(he(l)){s._dynamicPropertyMap.set("_size",(function(e,t,r){return(0,Q.F2)(l(e,t,r))}))}else s._size=(0,Q.F2)(l)||0;var h=e.scaleX;he(h)?s._dynamicPropertyMap.set("_scaleX",h):s._scaleX=h||1;var c=e.offsetX;if(he(c)){s._dynamicPropertyMap.set("xOffset",(function(e,t,r){return(0,Q.F2)(c(e,t,r))}))}else s.xOffset=(0,Q.F2)(c)||0;var f=e.offsetY;if(he(f)){s._dynamicPropertyMap.set("yOffset",(function(e,t,r){return(0,Q.F2)(f(e,t,r))}))}else s.yOffset=(0,Q.F2)(f)||0;var v=e.outlineWidth;if(he(v)){s._dynamicPropertyMap.set("_outlineWidth",(function(e,t,r){return(0,Q.F2)(v(e,t,r))}))}else s._outlineWidth=(0,Q.F2)(v)||0;var p=e.rotation;if(he(p)?s._dynamicPropertyMap.set("_angle",p):s._angle=p||0,(0,y.pC)(e.effects)){var d=e.effects;he(d)?s._dynamicPropertyMap.set("_effects",d):s._effects=d}if((0,y.pC)(e.markerPlacement)){var _=e.markerPlacement;he(_)?s._dynamicPropertyMap.set("_markerPlacement",_):s._markerPlacement=_}return s._scaleFactor=(0,y.Pt)(e.scaleFactor,1),s._bitSet=(e.alignment===ee.v2.MAP?1:0)|(e.colorLocked?1:0)<<1|(e.scaleSymbolsProportionally?1:0)<<3,s._materialKey=e.materialKey,s}return(0,s.Z)(r,[{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)}));var a=this._cimMarkerLayer.materialHash,s="function"==typeof a?a(n,t,r):a,o=this._materialCache.get(s);if(o&&sa(o.spriteMosaicItem)&&o.spriteMosaicItem){var u=o.spriteMosaicItem,l=this._cimMarkerLayer.sizeRatio,h=u.width/u.height*this._scaleX,c=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,f=this._size,p=f*h,d=this.xOffset,y=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;var _=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,Q.F2)(this._cimMarkerLayer.frameHeight):1,m=this._outlineWidth*_,g=(0,Q.F2)(this._cimMarkerLayer.referenceSize),x=0,k=0,b=this._cimMarkerLayer.anchorPoint;b&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(x=-b.x/(this._size*h),k=b.y/this._size):(x=b.x,k=b.y)),this._sizeOutlineWidth=(0,ie.Jz)(Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*f),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*g),255))),this.angle=c;var M=Math.round(64*l);this._bitestAndDistRatio=(0,ie.UJ)(this._bitSet,M);var S=u.rect.x+N.fL,w=u.rect.y+N.fL,P=S+u.width,C=w+u.height;this._texUpperLeft=(0,ie.UJ)(S,w),this._texUpperRight=(0,ie.UJ)(P,w),this._texBottomLeft=(0,ie.UJ)(S,C),this._texBottomRight=(0,ie.UJ)(P,C);var Z=ne.mE.load(this._materialKey);Z.sdf=u.sdf,Z.pattern=!0,Z.textureBinding=u.textureBinding,this._materialKey=Z.data,this._anchorX=.5-(.5+x)*u.width/u.width,this._anchorY=.5-(.5+k)*u.height/u.height,p*=l,f*=l,p*=this._scaleFactor,f*=this._scaleFactor,p*=u.rect.width/u.width,f*=u.rect.height/u.height,this._computedWidth=p,this._computedHeight=f,this._applyTransformation(ca,ha),this.xOffset=d,this.yOffset=y}else fa.error(new v.Z("mapview-cim","Encountered an error when binding feature"))}}],[{key:"fromCIMMarker",value:function(e,t){var i=fe(e.scaleInfo,t),n=(0,j.Z)(i,2);return new r(e,n[0],n[1])}}]),r}(Fr(aa)),pa=r(11752),da=r(61120);function ya(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function _a(e,t,r,i){return"string"==typeof e.text?e.text:"function"==typeof e.text?e.text(t,r,i):""}var ma=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;(0,a.Z)(this,r),(s=t.call(this,e))._horizontalAlignment="center",s._verticalAlignment="middle",s._textToGlyphs=new Map,s._minMaxZoom=(0,ie.UJ)(Math.round(i*N.MI),Math.round(n*N.MI));var o=e.scaleFactor||1;s._cimTextLayer=e;var u=e.color;if(he(u)){s._dynamicPropertyMap.set("_color",(function(e,t,r){return(0,re.t2)(u(e,t,r))}))}else s._color=(0,re.t2)(u);var l,h=e.outlineColor;if(he(h)){s._dynamicPropertyMap.set("_haloColor",(function(e,t,r){return(0,re.t2)(h(e,t,r))}))}else s._haloColor=(0,re.t2)(h);he(e.size)||(l=Math.min(Math.round((0,Q.F2)(e.size*e.sizeRatio)),127));var c;if(s._dynamicPropertyMap.set("_size",(function(t,r,i){return he(e.size)?Math.min(Math.round((0,Q.F2)(e.size(t,r,i)*e.sizeRatio)),127):l})),he(e.outlineSize)){s._dynamicPropertyMap.set("_haloSize",(function(t,r,i){return Math.min(Math.floor(5*(0,Q.F2)(e.outlineSize(t,r,i)*e.sizeRatio)),127)}))}else s._haloSize=Math.min(Math.floor(5*(0,Q.F2)(e.outlineSize*e.sizeRatio)),127);he(e.offsetX)||(c=Math.round((0,Q.F2)(e.offsetX*e.sizeRatio)));var f;s._dynamicPropertyMap.set("_xOffset",(function(t,r,i){return he(e.offsetX)?Math.round((0,Q.F2)(e.offsetX(t,r,i)*e.sizeRatio)):c})),he(e.offsetY)||(f=Math.round((0,Q.F2)(e.offsetY*e.sizeRatio)));if(s._dynamicPropertyMap.set("_yOffset",(function(t,r,i){return he(e.offsetY)?Math.round((0,Q.F2)(e.offsetY(t,r,i)*e.sizeRatio)):f})),he(e.angle)?s._dynamicPropertyMap.set("_angle",e.angle):s._angle=e.angle,he(e.horizontalAlignment)?s._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):s._horizontalAlignment=e.horizontalAlignment,he(e.verticalAlignment)?s._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):s._verticalAlignment=e.verticalAlignment,(0,y.pC)(e.effects)){var v=e.effects;he(v)?s._dynamicPropertyMap.set("_effects",v):s._effects=v}if((0,y.pC)(e.markerPlacement)){var p=e.markerPlacement;he(p)?s._dynamicPropertyMap.set("_markerPlacement",p):s._textPlacement=p}he(e.text)?s._dynamicPropertyMap.set("_text",e.text):s._text=e.text,s._scaleFactor=o;var d=Math.min(Math.round((0,Q.F2)(e.referenceSize*e.sizeRatio)),127);s._referenceSize=Math.round(Math.sqrt(256*d)),s._materialKey=e.materialKey;var _=ne.qr.load(s._materialKey);return _.sdf=!0,s._bitset=(e.alignment===ee.v2.MAP?1:0)|(e.colorLocked?1:0)<<1,s._materialKey=_.data,s._decoration="none",s._lineHeight=1,s._lineWidth=512,s._isCIM=!0,s}return(0,s.Z)(r,[{key:"analyze",value:function(){var e=(0,n.Z)(l.mark((function e(t,i,n,a){var s,o,u;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=i.readLegacyFeature(),o=_a(this._cimTextLayer,s,n,a),e.next=4,(0,pa.Z)((0,da.Z)(r.prototype),"analyze",this).call(this,t,i,n,a,ya(o));case 4:return u=e.sent,e.abrupt("return",(u&&u.glyphMosaicItems&&this._textToGlyphs.set(o,u.glyphMosaicItems),u));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)})),this._text&&0!==this._text.length){this._size*=this._scaleFactor,this._scale=this._size/N.Ex,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,te.kH)(this._horizontalAlignment||"center"),this._yAlignD=(0,te.b7)(this._verticalAlignment||"baseline");var a=this._textToGlyphs.get(this._text);this.bindTextInfo(a,!1)}else this._shapingInfo=null}}],[{key:"fromCIMText",value:function(e,t){var i=fe(e.scaleInfo,t),n=(0,j.Z)(i,2);return new r(e,n[0],n[1])}}]),r}(kr(aa)),ga=128,xa=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n,s,o,u,l,h,c,f,v,p,d,y,_,m){var g;(0,a.Z)(this,r),(g=t.call(this))._effects=y;var x=ne.dk.load(e);return i&&(x.sdf=i.sdf,x.pattern=!0,x.textureBinding=i.textureBinding),g.fillColor=n,g.tl=s,g.br=o,g.aux2=(0,ie.Jz)(u,l,h,c),g.aux3=(0,ie.Jz)(f,v,p,0),g._bitset=d,g._minMaxZoom=(0,ie.UJ)(Math.round(_*N.MI),Math.round(m*N.MI)),g._materialKey=x.data,g}return(0,s.Z)(r,null,[{key:"fromCIMFill",value:function(e,t,i){var n=e.color,a=n&&(0,re.t2)(n)||0,s=e.materialKey,o=fe(e.scaleInfo,i),u=(0,j.Z)(o,2),l=u[0],h=u[1];if(!t)return new r(s,null,a,0,0,0,0,0,0,0,0,0,e.colorLocked?N.Uh:0,e.effects,l,h);var c=t.rect,f=t.width,v=t.height,p=e.scaleX||1,d=c.x+N.fL,y=c.y+N.fL,_=d+f,m=y+v,g=e.height,x=p*g,k=Math.round(g);k>255?k=255:k<=0&&(k=m-y);var b=Math.round(x);b>255?b=255:b<=0&&(b=_-d);var M=(0,Q.F2)(e.offsetX||0)+ga;M>255&&(M=255);var S=(0,Q.F2)(-e.offsetY||0)+ga;return S>255&&(S=255),new r(s,t,a,(0,ie.UJ)(d,y),(0,ie.UJ)(_,m),b,k,M,S,ga,ga,(0,Nr.s5)(e.angle),e.colorLocked?N.Uh:0,e.effects,l,h)}},{key:"fromSimpleFill",value:function(e,t){var i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.color,s=a&&"esriSFSNull"!==e.style&&(0,re.aH)(a)||0,o=n?N.Uh:0,u=e.materialKey;if(t){var l=t.rect,h=t.width,c=t.height,f=l.x+N.fL,v=l.y+N.fL,p=f+h,d=v+c,y=(0,ie.UJ)(f,v),_=(0,ie.UJ)(p,d);i=new r(u,t,s,y,_,h,c,0,0,ga,ga,0,o,null,0,ae)}else i=new r(u,null,s,0,0,0,0,0,0,0,0,0,o,null,0,ae);return i._maybeAddLineTemplate(e),i}},{key:"fromPictureFill",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=N.ru,a=t.rect,s=t.width,o=t.height,u=a.x+N.fL,l=a.y+N.fL,h=u+s,c=l+o,f=(0,ie.UJ)(u,l),v=(0,ie.UJ)(h,c),p=Math.round((0,Q.F2)(e.width));p>255&&(p=255);var d=Math.round((0,Q.F2)(e.height));d>255&&(d=255);var y=(0,Q.F2)(e.xoffset)+ga;y>255&&(y=255);var _=(0,Q.F2)(-e.yoffset)+ga;_>255&&(_=255);var m=e.materialKey,g=i?N.Uh:0,x=new r(m,t,n,f,v,p,d,y,_,ga*e.xscale,ga*e.yscale,0,g,null,0,ae);return x._maybeAddLineTemplate(e),x}}]),r}(Ci(wr)),ka=function(){function e(){(0,a.Z)(this,e),this._resolver=null}return(0,s.Z)(e,[{key:"isHeld",value:function(){return!!this._resolver}},{key:"acquire",value:function(){var e=(0,n.Z)(l.mark((function e(){return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._resolver){e.next=2;break}return e.abrupt("return",(this._resolver=(0,_.hh)(),Promise.resolve()));case 2:return e.next=4,this._resolver.promise;case 4:return e.next=6,this.acquire();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"release",value:function(){var e=this._resolver;this._resolver=null,e.resolve()}}]),e}();function ba(){return(ba=(0,n.Z)(l.mark((function e(t,r,i){return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.acquire();case 3:return e.next=5,r(i);case 5:t.release(),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),t.release(),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}var Ma={marker:V.LW.MARKER,fill:V.LW.FILL,line:V.LW.LINE,text:V.LW.TEXT},Sa=function(){function e(t,r,n,s){(0,a.Z)(this,e);var o={minScale:null==r?void 0:r.minScale,maxScale:null==r?void 0:r.maxScale},u=function(e){return e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:""}(o);this.layers=t,this.data=r,this.hash=this._createHash()+u,this.rendererKey=n;var l,h={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:n},c=(0,i.Z)(t);try{for(c.s();!(l=c.n()).done;){var f=l.value,v=Ma[f.type];f.materialKey=(0,ne.jj)(v,h),f.maxVVSize=s,f.scaleInfo=o,f.templateHash+=u}}catch(p){c.e(p)}finally{c.f()}}return(0,s.Z)(e,[{key:"type",get:function(){return"expanded-cim"}},{key:"_createHash",value:function(){var e,t="",r=(0,i.Z)(this.layers);try{for(r.s();!(e=r.n()).done;){t+=e.value.templateHash}}catch(n){r.e(n)}finally{r.f()}return t}}]),e}();var wa=r(71277),Pa=r(35995),Ca=r(70032),Za=r(53283),La=r(86423);function Ia(e,t,r){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,n.Z)(l.mark((function e(t,r,i){return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.name){e.next=2;break}return e.abrupt("return",Promise.reject(new v.Z("style-symbol-reference-name-missing","Missing name in style symbol reference")));case 2:if(!t.styleName||"Esri2DPointSymbolsStyle"!==t.styleName){e.next=4;break}return e.abrupt("return",za(t,i));case 4:return e.prev=4,e.t0=Fa,e.next=8,(0,La.n2)(t,r,i);case 8:return e.t1=e.sent,e.t2=t.name,e.t3=r,e.t4=i,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4));case 15:return e.prev=15,e.t5=e.catch(4),e.abrupt("return",((0,_.k_)(e.t5),null));case 18:case"end":return e.stop()}}),e,null,[[4,15]])})))).apply(this,arguments)}function za(e,t){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,n.Z)(l.mark((function e(t,r){var i,n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=La.wm.replace(/\{SymbolName\}/gi,t.name),e.prev=1,e.next=4,(0,La.EJ)(i,r);case 4:return n=e.sent,e.abrupt("return",(0,La.KV)(n.data));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",((0,_.k_)(e.t0),null));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function Fa(e,t,r,i){return Aa.apply(this,arguments)}function Aa(){return Aa=(0,n.Z)(l.mark((function e(t,r,i,n){var a,s,o,u,h;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,s={portal:i&&i.portal||Ca.Z.getDefault(),url:(0,Pa.mN)(t.baseUrl),origin:"portal-item"},o=a.items.find((function(e){return e.name===r}))){e.next=3;break}throw new v.Z("symbolstyleutils:symbol-name-not-found","The symbol name '".concat(r,"' could not be found"),{symbolName:r});case 3:return u=(0,Za.f)((0,La.v9)(o,"cimRef"),s),(0,wa.XO)()&&(u=(0,wa.pJ)(u)),e.prev=5,e.next=8,(0,La.EJ)(u,n);case 8:return h=e.sent,e.abrupt("return",(0,La.KV)(h.data));case 12:return e.prev=12,e.t0=e.catch(5),e.abrupt("return",((0,_.k_)(e.t0),null));case 15:case"end":return e.stop()}}),e,null,[[5,12]])}))),Aa.apply(this,arguments)}var Ra=function(){var e=(0,n.Z)(l.mark((function e(t,r,i){return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Sa,e.next=3,Tn(t.data,r,i);case 3:return e.t1=e.sent,e.t2=t.data,e.t3=t.rendererKey,e.t4=t.maxVVSize,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3,e.t4));case 8:case"end":return e.stop()}}),e)})));return function(t,r,i){return e.apply(this,arguments)}}(),Oa=function(){var e=(0,n.Z)(l.mark((function e(t,r,i,n){var a;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if("cim"!==t.type){e.next=4;break}return e.abrupt("return",Ra(t,r,i));case 4:if("web-style"!==t.type){e.next=12;break}return e.next=7,Ia(t,null,n);case 7:return e.t0=e.sent,e.t1=t.rendererKey,e.t2=t.maxVVSize,a={type:"cim",data:e.t0,rendererKey:e.t1,maxVVSize:e.t2},e.abrupt("return",Ra(a,r,i));case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)})));return function(t,r,i,n){return e.apply(this,arguments)}}();function Wa(e){if(!e)return null;var t=e.type,r=e.cim,i=e.url,n={cim:r,type:t,mosaicHash:e.materialHash,url:i,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(t){case"marker":n.size=e.size,n.path=e.path;break;case"line":n.dashTemplate=e.dashTemplate;break;case"text":n.text=e.text,n.fontName=e.fontName}return n}var Na=d.Z.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Va=new Array,Ga={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:0},Da=(0,Rr.Z)((0,Rr.Z)({},Or.eG),{},{hash:JSON.stringify(Or.eG),materialKey:(0,ne.jj)(V.LW.MARKER,Ga)}),Ba=(0,Rr.Z)((0,Rr.Z)({},Or.wW),{},{hash:JSON.stringify(Or.wW),materialKey:(0,ne.jj)(V.LW.LINE,Ga)}),Xa=(0,Rr.Z)((0,Rr.Z)({},Or.lj),{},{hash:JSON.stringify(Or.lj),materialKey:(0,ne.jj)(V.LW.FILL,Ga)});function Ua(e,t){var r=e.length;return e.push(null),t.then((function(t){return e[r]=t})),e}function Ha(e){return!!(1&e)}var Ya=function(){function e(t,r){(0,a.Z)(this,e),this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new ka,this._fetchResource=t,this._tileInfo=r}return(0,s.Z)(e,[{key:"_markerError",get:function(){return this._errorTemplates.marker[0]}},{key:"_fillError",get:function(){return this._errorTemplates.fill[0]}},{key:"_lineError",get:function(){return this._errorTemplates.line[0]}},{key:"_textError",get:function(){return this._errorTemplates.line[0]}},{key:"createTemplateGroup",value:function(e,t){this._initErrorTemplates();var r=e.hash;if(this._symbolToTemplate.has(r))return this._symbolToTemplate.get(r);var i=new Array;t&&this._createMeshTemplates(i,t,!0),this._createMeshTemplates(i,e,!1);var n=this._createGroupId("expanded-cim"===e.type&&Ja(e));return this._idToTemplateGroup.set(n,i),this._symbolToTemplate.set(r,n),n}},{key:"getTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):Va}},{key:"getDynamicTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?(Ha(e)||Na.error("mapview-template-store","Id ".concat(e," does not refer to a dynamic template")),this._idToTemplateGroup.get(e)):Va}},{key:"getMosaicItem",value:function(e,t){var r=this,i=this._createTemplateId(),n=new Promise((function(e){return r._idToResolver.set(i,e)}));return this._fetchQueue.push({symbol:e,id:i,glyphIds:t}),n}},{key:"finalize",value:function(e){return this._fetchQueue.length||this._lock.isHeld()?function(e,t,r){return ba.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),e):Promise.resolve()}},{key:"_initErrorTemplates",value:function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],Xa,!1),marker:this._createMeshTemplates([],Da,!1),line:this._createMeshTemplates([],Ba,!1)})}},{key:"_fetchAllQueuedResources",value:function(e){var t=this;if(!this._fetchQueue.length)return Promise.resolve();var r=this._fetchQueue,n=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(n).then((function(){return t._fetchResource(r,e).then((function(e){var r,n=(0,i.Z)(e);try{for(n.s();!(r=n.n()).done;){var a=r.value,s=a.id,o=a.mosaicItem;t._idToResolver.get(s)(o),t._idToResolver.delete(s)}}catch(u){n.e(u)}finally{n.f()}}))})).catch((function(e){(0,_.D_)(e)?t._fetchQueue=t._fetchQueue.concat(r):function(e){return"worker:port-closed"===e.name}(e)||Na.error(new v.Z("mapview-template-store","Unable to fetch requested texture resources",e))}))}},{key:"_createGroupId",value:function(e){return this._idCounter++<<1|(e?1:0)}},{key:"_createTemplateId",value:function(){return this._templateIdCounter++}},{key:"_createSMS",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",sa(i,Na)?Ar.fromSimpleMarker(t,i):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPMS",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",sa(i,Na)?Ar.fromPictureMarker(t,i):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createSFS",value:function(){var e=(0,n.Z)(l.mark((function e(t,r){var i,n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return i=e.sent,n=i.spriteMosaicItem,e.abrupt("return",sa(n,Na)?xa.fromSimpleFill(t,n,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createPFS",value:function(){var e=(0,n.Z)(l.mark((function e(t,r){var i,n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return i=e.sent,n=i.spriteMosaicItem,e.abrupt("return",sa(n,Na)?xa.fromPictureFill(t,n,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createSLS",value:function(){var e=(0,n.Z)(l.mark((function e(t,r){var i,n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return i=e.sent,n=i.spriteMosaicItem,e.abrupt("return",sa(n,Na)?Pi.fromSimpleLine(t,n):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createLMS",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",sa(i,Na)?Ar.fromLineSymbolMarker(t,i):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createTS",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,i=r.glyphMosaicItems,e.abrupt("return",Pr.fromText(t,i));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMText",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Wa(t),ya(t.text));case 2:return r=e.sent,i=r.glyphMosaicItems,e.abrupt("return",sa(i,Na)?Pr.fromCIMText(t,i,this._tileInfo):this._textError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMFill",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Wa(t));case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",sa(i,Na)?xa.fromCIMFill(t,i,this._tileInfo):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMLine",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Wa(t));case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",sa(i,Na)?Pi.fromCIMLine(t,i,this._tileInfo):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMMarker",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Wa(t));case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",sa(i,Na)?Ar.fromCIMMarker(t,i,this._tileInfo):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIM",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,!this._cimTemplateCache.has(r)){e.next=3;break}return e.abrupt("return",this._cimTemplateCache.get(r));case 3:e.t0=t.type,e.next="marker"===e.t0?6:"line"===e.t0?10:"fill"===e.t0?14:"text"===e.t0?18:21;break;case 6:return e.next=8,this._createCIMMarker(t);case 8:return i=e.sent,e.abrupt("break",21);case 10:return e.next=12,this._createCIMLine(t);case 12:return i=e.sent,e.abrupt("break",21);case 14:return e.next=16,this._createCIMFill(t);case 16:return i=e.sent,e.abrupt("break",21);case 18:return e.next=20,this._createCIMText(t);case 20:i=e.sent;case 21:return e.abrupt("return",(this._cimTemplateCache.set(r,i),i));case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createDynamicCIM",value:function(){var e=(0,n.Z)(l.mark((function e(t){var r,i;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,!this._cimTemplateCache.has(r)){e.next=3;break}return e.abrupt("return",this._cimTemplateCache.get(r));case 3:e.t0=t.type,e.next="marker"===e.t0?6:"line"===e.t0?8:"fill"===e.t0?10:"text"===e.t0?12:13;break;case 6:return i=va.fromCIMMarker(t,this._tileInfo),e.abrupt("break",13);case 8:return i=la.fromCIMLine(t,this._tileInfo),e.abrupt("break",13);case 10:return i=ua.fromCIMFill(t,this._tileInfo),e.abrupt("break",13);case 12:i=ma.fromCIMText(t,this._tileInfo);case 13:return e.abrupt("return",(this._cimTemplateCache.set(r,i),i));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPrimitiveMeshTemplates",value:function(e,t,r){switch(t.type){case"esriSMS":return Ua(e,this._createSMS(t));case"esriPMS":return Ua(e,this._createPMS(t));case"esriSFS":return Ua(e,this._createSFS(t,r));case"line-marker":return Ua(e,this._createLMS(t));case"esriPFS":return Ua(e,this._createPFS(t,r));case"esriSLS":return Ua(e,this._createSLS(t,!1));case"esriTS":return Ua(e,this._createTS(t));default:return Na.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}},{key:"_createMeshTemplates",value:function(e,t,r){if(-1!==t.type.indexOf("3d"))return Na.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===t.type){var n,a=(0,i.Z)(t.layers);try{for(a.s();!(n=a.n()).done;){var s=n.value;"function"==typeof s.materialHash?Ua(e,this._createDynamicCIM(s)):Ua(e,this._createCIM(s))}}catch(h){a.e(h)}finally{a.f()}return e}if("composite-symbol"===t.type){var o,u=(0,i.Z)(t.layers);try{for(u.s();!(o=u.n()).done;){var l=o.value;this._createPrimitiveMeshTemplates(e,l,r)}}catch(h){u.e(h)}finally{u.f()}return e}return"cim"===t.type||"label"===t.type||"web-style"===t.type?e:this._createPrimitiveMeshTemplates(e,t,r)}}]),e}(),Ja=function(e){if(!e.layers)return!1;var t,r=(0,i.Z)(e.layers);try{for(r.s();!(t=r.n()).done;){if("function"==typeof t.value.materialHash)return!0}}catch(n){r.e(n)}finally{r.f()}return!1},qa=function(){function e(t,r,i){(0,a.Z)(this,e),this._loadPromise=(0,K.j)(),this._geometryType=t,this._idField=r,this._templateStore=i}return(0,s.Z)(e,[{key:"update",value:function(e,t){(0,y.pC)(e.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(e.mesh.labels,t)),this._schema=e}},{key:"_createLabelTemplates",value:function(e,t){var r=new Map;if("simple"===e.type){var n,a=(0,i.Z)(e.classes);try{for(a.s();!(n=a.n()).done;){var s=n.value,o=zr.fromLabelClass(s,t);r.set(s.index,o)}}catch(p){a.e(p)}finally{a.f()}return r}for(var u in e.classes){var l,h=e.classes[u],c=(0,i.Z)(h);try{for(c.s();!(l=c.n()).done;){var f=l.value,v=zr.fromLabelClass(f,t);r.set(f.index,v)}}catch(p){c.e(p)}finally{c.f()}}return r}},{key:"templates",get:function(){return this._templateStore}},{key:"analyze",value:function(){var e=(0,n.Z)(l.mark((function e(t,r,n,a,s,o,u){var h,c,f,v,p,d,m;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,_.Hc)(u)){e.next=2;break}return e.abrupt("return");case 2:if(e.t0="dictionary"===n.type,!e.t0){e.next=7;break}return e.next=6,n.analyze(this._idField,t.copy(),r,s,o,u);case 6:h=e.sent;case 7:for(c=0;t.next();)if(void 0,f=h?h[c++]:(0,y.pC)(a)&&(0,k.nE)(t.getDisplayId())&&1!==t.readAttribute("cluster_count")?a.match(this._idField,t,this._geometryType,s,o):n.match(this._idField,t,this._geometryType,s,o),t.setGroupId(f),Ha(f)){v=this._templateStore.getDynamicTemplateGroup(f),p=(0,i.Z)(v);try{for(p.s();!(d=p.n()).done;)(m=d.value)&&m.analyze&&m.analyze(this._templateStore,t,s,o)}catch(l){p.e(l)}finally{p.f()}}return e.next=11,this._loadPromise;case 11:return e.abrupt("return",this._templateStore.finalize(u));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,s,o){return e.apply(this,arguments)}}()},{key:"analyzeGraphics",value:function(){var e=(0,n.Z)(l.mark((function e(t,r,n,a,s,o){var u,h,c,f,v,p;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,_.Hc)(o)){e.next=2;break}return e.abrupt("return");case 2:if(u=t.getCursor(),e.t0=n,!e.t0){e.next=7;break}return e.next=7,n.analyze(this._idField,u.copy(),r,a,s,o);case 7:if(!u.next()){e.next=13;break}if(null!=(h=u.getGroupId())&&-1!==h||(h=n.match(this._idField,u,u.geometryType,a,s),u.setGroupId(h)),Ha(h)){c=this._templateStore.getDynamicTemplateGroup(h),f=(0,i.Z)(c);try{for(f.s();!(v=f.n()).done;)(p=v.value)&&p.analyze&&p.analyze(this._templateStore,u,a,s)}catch(l){f.e(l)}finally{f.f()}}u.setGroupId(h);case 11:e.next=7;break;case 13:return e.next=15,this._loadPromise;case 15:return e.abrupt("return",this._templateStore.finalize(o));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,s){return e.apply(this,arguments)}}()},{key:"writeGraphic",value:function(e,t,r,n){var a=t.getGroupId(),s=t.getDisplayId(),o=this._templateStore.getTemplateGroup(a);if(e.featureStart(t.insertAfter,0),null!=s){if(Ha(a)){var u,l=(0,i.Z)(o);try{for(l.s();!(u=l.n()).done;){var h=u.value;h&&h.bindFeature(t,null,null)}}catch(p){l.e(p)}finally{l.f()}}if(o){var c,f=(0,i.Z)(o);try{for(f.s();!(c=f.n()).done;){var v=c.value;v&&v.write(e,t,r,n)}}catch(p){f.e(p)}finally{f.f()}e.featureEnd()}}}},{key:"writeCursor",value:function(e,t,r,n,a,s,o){var u=t.getGroupId(),l=t.getDisplayId(),h=this._templateStore.getTemplateGroup(u),c=this._schema.mesh.sortKey,f=0;if((0,y.pC)(c)&&(f=null!=c.fieldIndex?t.getComputedNumericAtIndex(c.fieldIndex):null!=c.field?t.readAttribute(c.field):t.readAttribute(this._idField),f*="asc"===c.order?1:-1),e.featureStart(0,null==f||isNaN(f)?0:f),null!=l&&h){if(Ha(u)){var v,p=(0,i.Z)(h);try{for(p.s();!(v=p.n()).done;){v.value.bindFeature(t,r,n)}}catch(g){p.e(g)}finally{p.f()}}var d,_=(0,i.Z)(h);try{for(_.s();!(d=_.n()).done;){d.value.write(e,t,a,o)}}catch(g){_.e(g)}finally{_.f()}if((0,y.pC)(s)&&e.hasRecords){var m=s&&this._findLabelRef(h);this._writeLabels(e,t,s,m,a,o)}e.featureEnd()}}},{key:"_findLabelRef",value:function(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n instanceof Ar)return n}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"_writeLabels",value:function(e,t,r,n,a,s){var o,u=(0,i.Z)(r);try{for(u.s();!(o=u.n()).done;){var l=o.value;if((0,y.pC)(l)&&l){var h=l.glyphs,c=l.rtl,f=l.index,v=this._labelTemplates.get(f);v.setZoomLevel(a),v.bindReferenceTemplate(n),v.bindTextInfo(h,c),v.write(e,t,null,s)}}}catch(p){u.e(p)}finally{u.f()}}}]),e}(),Ka=r(16054),ja=d.Z.getLogger("esri/views/2d/engine/webgl/util/Matcher");function $a(e,t,r,i){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,n.Z)(l.mark((function e(t,r,i,n){return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="simple"===e.t0?3:"map"===e.t0?4:"interval"===e.t0?5:"dictionary"===e.t0?6:"subtype"===e.t0?7:8;break;case 3:return e.abrupt("return",ts.fromBasicRenderer(t,r,i,n));case 4:return e.abrupt("return",ns.fromUVRenderer(t,r,i,n));case 5:return e.abrupt("return",is.fromCBRenderer(t,r,i,n));case 6:return e.abrupt("return",ls.fromDictionaryRenderer(t,r,i,n));case 7:return e.abrupt("return",rs.fromSubtypes(t,r,i,n));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var es,ts=function(){function e(){(0,a.Z)(this,e),this.type="feature",this._defaultResult=null}return(0,s.Z)(e,[{key:"size",value:function(){return 1}},{key:"getDefault",value:function(){return this._defaultResult}},{key:"setDefault",value:function(e){this._defaultResult=e}},{key:"match",value:function(e,t,r,i,n){return this.getDefault()}},{key:"analyze",value:function(){var e=(0,n.Z)(l.mark((function e(t,r,i,n,a,s){return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t,r,i,n,a,s){return e.apply(this,arguments)}}()}],[{key:"fromBasicRenderer",value:function(){var t=(0,n.Z)(l.mark((function t(r,i,n,a){var s,o,u;return l.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new e,!r.symbol){t.next=7;break}return t.next=4,Oa(r.symbol,n,a);case 4:o=t.sent,u=i.createTemplateGroup(o,null),s.setDefault(u);case 7:return t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})));return function(e,r,i,n){return t.apply(this,arguments)}}()}]),e}(),rs=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i){var n;return(0,a.Z)(this,r),(n=t.call(this))._subMatchers=e,n._subtypeField=i,n}return(0,s.Z)(r,[{key:"match",value:function(e,t,r,i,n){var a=t.readAttribute(this._subtypeField),s=this._subMatchers.get(a);return s?s.match(e,t,r,i,n):null}}],[{key:"fromSubtypes",value:function(){var e=(0,n.Z)(l.mark((function e(t,i,n,a){var s,o,u,h;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(h in s=new Map,o=[],u=function(e){var r=parseInt(e,10),u=$a(t.renderers[e],i,n,a).then((function(e){return s.set(r,e)}));o.push(u)},t.renderers)u(h);return e.next=5,Promise.all(o);case 5:return e.abrupt("return",new r(s,t.subtypeField));case 6:case"end":return e.stop()}}),e)})));return function(t,r,i,n){return e.apply(this,arguments)}}()}]),r}(ts),is=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n,s){var o;return(0,a.Z)(this,r),(o=t.call(this)).type="interval",o._intervals=[],o._isMaxInclusive=i,o._fieldIndex=s,o._field=e,o._normalizationInfo=n,o}return(0,s.Z)(r,[{key:"add",value:function(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((function(e,t){return e.interval.min-t.interval.min}))}},{key:"size",value:function(){return(0,pa.Z)((0,da.Z)(r.prototype),"size",this).call(this)+this._intervals.length}},{key:"match",value:function(e,t,r,i,n){if(null==this._fieldIndex&&!this._field)return this.getDefault();var a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(!a&&(null==a||isNaN(a)))return this.getDefault();for(var s=0;s<this._intervals.length;s++){var o=this._intervals[s],u=o.interval,l=o.result,h=a>=u.min,c=this._isMaxInclusive?a<=u.max:a<u.max;if(h&&c)return l}return this.getDefault()}},{key:"_needsNormalization",value:function(){var e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}},{key:"_getValueFromField",value:function(e){var t=e.readAttribute(this._field);if(!this._needsNormalization()||null==t)return t;var r=this._normalizationInfo,i=r.normalizationField,n=r.normalizationTotal,a=r.normalizationType,s=!!i&&e.readAttribute(i);if(a)switch(a){case"esriNormalizeByField":return s?t/s:void 0;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return t/n*100;default:return void ja.error("Found unknown normalization type: ".concat(a))}else ja.error("Normalization is required, but no type was set!")}}],[{key:"fromCBRenderer",value:function(){var e=(0,n.Z)(l.mark((function e(t,i,a,s){var o,u,h,c,f,v,p,d,y;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.isMaxInclusive,u=t.normalizationField,h=t.normalizationTotal,c=t.normalizationType,f=t.field,v=new r(f,o,{normalizationField:u,normalizationTotal:h,normalizationType:c},t.fieldIndex),e.next=8,Oa(t.backgroundFillSymbol,a,s);case 8:return p=e.sent,e.next=11,Promise.all(t.intervals.map(function(){var e=(0,n.Z)(l.mark((function e(t){var r,n,o;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oa(t.symbol,a,s);case 2:return r=e.sent,e.next=5,i.createTemplateGroup(r,p);case 5:n=e.sent,o={min:t.min,max:t.max},v.add(o,n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.next=13,Oa(t.defaultSymbol,a,s);case 13:if(!(d=e.sent)){e.next=19;break}return e.next=17,i.createTemplateGroup(d,p);case 17:y=e.sent,v.setDefault(y);case 19:return e.abrupt("return",v);case 20:case"end":return e.stop()}}),e)})));return function(t,r,i,n){return e.apply(this,arguments)}}()}]),r}(ts),ns=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n){var s;return(0,a.Z)(this,r),(s=t.call(this)).type="map",s._nullResult=null,s._resultsMap=new Map,s._fieldsIndex=n,s._fields=e,s._seperator=i||"",s}return(0,s.Z)(r,[{key:"setNullResult",value:function(e){this._nullResult=e}},{key:"add",value:function(e,t){this._resultsMap.set(e.toString(),t)}},{key:"size",value:function(){return(0,pa.Z)((0,da.Z)(r.prototype),"size",this).call(this)+this._resultsMap.size}},{key:"match",value:function(e,t,r,i,n){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();var a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||""===a||"<Null>"===a))return this._nullResult;if(!a&&null==a)return this.getDefault();var s=a.toString();return this._resultsMap.has(s)?this._resultsMap.get(s):this.getDefault()}},{key:"_getValueFromFields",value:function(e){var t,r=[],n=(0,i.Z)(this._fields);try{for(n.s();!(t=n.n()).done;){var a=t.value,s=e.readAttribute(a);null==s||""===s?r.push("<Null>"):r.push(s)}}catch(o){n.e(o)}finally{n.f()}return r.join(this._seperator)}}],[{key:"fromUVRenderer",value:function(){var e=(0,n.Z)(l.mark((function e(t,i,a,s){var o,u,h,c,f,v;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.fieldDelimiter,u=[t.field],t.field2&&u.push(t.field2),t.field3&&u.push(t.field3),e.next=4,Oa(t.backgroundFillSymbol,a,s);case 4:return h=e.sent,c=new r(u,o,t.fieldIndex),e.next=8,Promise.all(t.map.map(function(){var e=(0,n.Z)(l.mark((function e(t){var r,n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oa(t.symbol,a,s);case 2:return r=e.sent,e.next=5,i.createTemplateGroup(r,h);case 5:n=e.sent,"<Null>"===t.value?c.setNullResult(n):c.add(t.value,n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.next=10,Oa(t.defaultSymbol,a,s);case 10:if(!(f=e.sent)){e.next=16;break}return e.next=14,i.createTemplateGroup(f,h);case 14:v=e.sent,c.setDefault(v);case 16:return e.abrupt("return",c);case 17:case"end":return e.stop()}}),e)})));return function(t,r,i,n){return e.apply(this,arguments)}}()}]),r}(ts);function as(e,t){return ss.apply(this,arguments)}function ss(){return(ss=(0,n.Z)(l.mark((function e(t,r){var i,n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!=typeof(i=t||1)){e.next=3;break}return e.abrupt("return",(function(e,t,r){return i}));case 3:return e.next=5,(0,Ii.Yi)(i,r.spatialReference,r.fields);case 5:return n=e.sent,e.abrupt("return",(function(e,t,i){return kn(n,e,{$view:i},r.geometryType,t)||1}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function os(){return us.apply(this,arguments)}function us(){return(us=(0,n.Z)(l.mark((function e(){return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(es||(es=r.e(5164).then(r.bind(r,85164))),es));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ls=function(e){(0,o.Z)(h,e);var t=(0,u.Z)(h);function h(e,r,i,n,s,o){var u;return(0,a.Z)(this,h),(u=t.call(this)).type="dictionary",u._groupIdCache=new Ka.Z(100),u._loader=e,u._fieldMap=e.fieldMap,u._symbolFields=e.getSymbolFields(),u._templates=r,u._info=i,u._scaleFn=n,u._schemaUtilsModule=s,u._symbolOptions=o,u}return(0,s.Z)(h,[{key:"_analyzeFeature",value:function(){var e=(0,n.Z)(l.mark((function e(t,r,n,a,s){var o,u,h,c,f,p,d,y,_=this;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.readLegacyFeature(),u=this._scaleFn(o,n,a),h=this._attributeHash(o)+"-"+u,!(c=this._groupIdCache.get(h))){e.next=3;break}return e.abrupt("return",c);case 3:return f=(0,Rr.Z)((0,Rr.Z)({},a),{},{spatialReference:this._info.spatialReference,abortOptions:s,fields:this._info.fields}),e.next=6,this._loader.getSymbolAsync(o,f);case 6:return p=e.sent,d=this._schemaUtilsModule.createSymbolSchema(p,this._symbolOptions),y=Oa(d,this._info,r,s).then((function(e){if("expanded-cim"!==e.type)return ja.error(new v.Z("mapview-bad-type","Found unexpected type ".concat(e.type," in dictionary response"))),null;e.hash+="-"+u;var t,r=(0,i.Z)(e.layers);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.scaleFactor=u,n.templateHash+="-"+u}}catch(a){r.e(a)}finally{r.f()}return _._templates.createTemplateGroup(e,null)})),e.abrupt("return",(this._groupIdCache.put(h,y,1),y));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"analyze",value:function(){var e=(0,n.Z)(l.mark((function e(t,r,i,n,a,s){var o,u;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=r.getCursor(),u=[];o.next();)u.push(this._analyzeFeature(o,i,n,a,s));return e.abrupt("return",Promise.all(u));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,s){return e.apply(this,arguments)}}()},{key:"match",value:function(e,t,r,i,n){return null}},{key:"_attributeHash",value:function(e){var t,r="",n=(0,i.Z)(this._symbolFields);try{for(n.s();!(t=n.n()).done;){var a=t.value,s=this._fieldMap[a];s&&(r+=e.attributes[s]+"-")}}catch(o){n.e(o)}finally{n.f()}return r}}],[{key:"fromDictionaryRenderer",value:function(){var e=(0,n.Z)(l.mark((function e(t,i,n,a){var s,o,u,c,f,v;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Promise.resolve().then(r.bind(r,75465)),os()]);case 2:return s=e.sent,o=(0,j.Z)(s,2),u=o[0].DictionaryLoader,c=o[1],f=new u(t.url,t.config,t.fieldMap),e.next=9,f.fetchResources({spatialReference:n.spatialReference,fields:n.fields});case 9:return e.next=11,as(t.scaleExpression,n);case 11:return v=e.sent,e.abrupt("return",new h(f,i,n,v,c,t.symbolOptions));case 13:case"end":return e.stop()}}),e)})));return function(t,r,i,n){return e.apply(this,arguments)}}()}]),h}(ts),hs=r(81735),cs=function(){function e(t){(0,a.Z)(this,e),this._remoteClient=t,this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null}return(0,s.Z)(e,[{key:"destroy",value:function(){}},{key:"fetchResource",value:function(){var e=(0,n.Z)(l.mark((function e(t,r){var i,n,a,s=this;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._resourceMap,!(n=i.get(t))){e.next=3;break}return e.abrupt("return",n);case 3:if(!(a=this._inFlightResourceMap.get(t))){e.next=6;break}return e.abrupt("return",a);case 6:e.prev=6,a=this._remoteClient.invoke("tileRenderer.fetchResource",{url:t},(0,Rr.Z)({},r)),this._inFlightResourceMap.set(t,a),a.then((function(e){return s._inFlightResourceMap.delete(t),i.set(t,e),e})),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(6),e.abrupt("return",(0,_.D_)(e.t0)?null:{width:0,height:0});case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getResource",value:function(e){var t;return null!=(t=this._resourceMap.get(e))?t:null}}]),e}();function fs(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}function vs(e){var t=e.message,r={message:{data:{},tileKey:t.tileKey,tileKeyOrigin:t.tileKeyOrigin},transferList:new Array};for(var i in t.data){var n=t.data[i];if(r.message.data[i]=null,(0,y.pC)(n)){var a=n.stride,s=n.indices.slice(0),o=n.vertices.slice(0),u=n.records.slice(0),l={stride:a,indices:s,vertices:o,records:u,metrics:(0,y.yw)(n.metrics,(function(e){return e.slice(0)}))};r.transferList.push(s,o,u),r.message.data[i]=l}}return r}d.Z.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");var ps=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).type="symbol",e._matchers={feature:null,aggregate:null},e._bufferData=new Map,e._bufferIds=new Map,e}return(0,s.Z)(r,[{key:"initialize",value:function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new cs(this.remoteClient)}},{key:"destroy",value:function(){this._resourceManagerProxy.destroy()}},{key:"supportsTileUpdates",get:function(){return!0}},{key:"forEachBufferId",value:function(e){this._bufferIds.forEach((function(t){t.forEach(e)}))}},{key:"update",value:function(){var e=(0,n.Z)(l.mark((function e(t,r){var i,n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("symbol"===(i=r.schema.processors[0]).type){e.next=3;break}return e.abrupt("return");case 3:n=(0,g.Hg)(this._schema,i),(0,g.uD)(n,"mesh")&&((0,p.Z)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",n),t.mesh=!0,t.why.mesh.push("Symbology changed"),this._schema=i,this._factory=this._createFactory(i),this._factory.update(i,this.tileStore.tileScheme.tileInfo));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"onTileMessage",value:function(e,t,r,i){return(0,_.k_)(i),this._onTileData(e,t,r,i)}},{key:"onTileClear",value:function(e){return this._bufferData.delete(e.key.id),this._bufferIds.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}},{key:"onTileError",value:function(e,t,r){var i=r.signal,n={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",n,{signal:i})}},{key:"onTileUpdate",value:function(e){var t,r=this,n=(0,i.Z)(e.removed);try{for(n.s();!(t=n.n()).done;){var a=t.value;this._bufferData.has(a.key.id)&&this._bufferData.delete(a.key.id),this._bufferIds.has(a.key.id)&&this._bufferIds.delete(a.key.id)}}catch(l){n.e(l)}finally{n.f()}var s,o=(0,i.Z)(e.added);try{var u=function(){var e=s.value;r._bufferData.forEach((function(t){var n,a=(0,i.Z)(t);try{for(a.s();!(n=a.n()).done;){var s=n.value;s.message.tileKey===e.id&&r._updateTileMesh("append",e,vs(s),[],!1,!1,null)}}catch(l){a.e(l)}finally{a.f()}}))};for(o.s();!(s=o.n()).done;)u()}catch(l){o.e(l)}finally{o.f()}}},{key:"_addBufferData",value:function(e,t){this._bufferData.has(e)||this._bufferData.set(e,[]),this._bufferData.get(e).push(vs(t))}},{key:"_createFactory",value:function(e){var t=this,r=this.service,i=r.geometryType,n=r.objectIdField,a={geometryType:i,fields:r.fields,spatialReference:x.Z.fromJSON(this.spatialReference)},s=new Ya((function(e,r){return t.remoteClient.invoke("tileRenderer.getMaterialItems",e,r)}),this.tileStore.tileScheme.tileInfo),o=e.mesh,u=o.matcher,l=o.aggregateMatcher;return this._store=s,this._matchers.feature=$a(u,s,a,this._resourceManagerProxy),this._matchers.aggregate=(0,y.yw)(l,(function(e){return $a(e,s,a,t._resourceManagerProxy)})),new qa(i,n,s)}},{key:"_onTileData",value:function(){var e=(0,n.Z)(l.mark((function e(t,r,n,a){var s,o,u,h,c,f,v,p,d,m,g,x,k,b,M,S,w,P,C,Z,L,I,T=this;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_.k_)(a),s=r.type,o=r.addOrUpdate,u=r.remove,h=r.end,c=!!this._schema.mesh.sortKey,o){e.next=5;break}return f={type:s,addOrUpdate:null,remove:u,clear:!1,end:h,sort:c},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:f},a));case 5:return v=this._processFeatures(t,o,n,a),e.prev=6,e.next=9,v;case 9:if(p=e.sent,!(0,y.Wi)(p)){e.next=13;break}return d={type:s,addOrUpdate:null,remove:u,clear:!1,end:h,sort:c},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:d},a));case 13:m=[],g=(0,i.Z)(p),e.prev=15,g.s();case 17:if((x=g.n()).done){e.next=41;break}if(k=x.value,b=!1,M=k.message.bufferIds,S=t.key.id,w=k.message.tileKey,S===w||!(0,y.pC)(M)){e.next=38;break}if(this.tileStore.get(w)){e.next=25;break}return this._addBufferData(S,k),m.push(k),e.abrupt("continue",39);case 25:(P=this._bufferIds.get(w))||(P=new Set,this._bufferIds.set(w,P)),C=Array.from(M),Z=0,L=C;case 29:if(!(Z<L.length)){e.next=38;break}if(I=L[Z],!P.has(I)){e.next=34;break}return b=!0,e.abrupt("break",38);case 34:P.add(I);case 35:Z++,e.next=29;break;case 38:b||(this._addBufferData(S,k),m.push(k));case 39:e.next=17;break;case 41:e.next=46;break;case 43:e.prev=43,e.t0=e.catch(15),g.e(e.t0);case 46:return e.prev=46,g.f(),e.finish(46);case 49:return e.next=51,(0,_.$6)(m.map((function(e){var i=t.key.id===e.message.tileKey,n=i?r.remove:[],o=i&&r.end;return T._updateTileMesh(s,t,e,n,o,r.clear,a.signal)})));case 51:e.next=56;break;case 53:e.prev=53,e.t1=e.catch(6),this._handleError(t,e.t1,a);case 56:case"end":return e.stop()}}),e,this,[[6,53],[15,43,46,49]])})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"_updateTileMesh",value:function(){var e=(0,n.Z)(l.mark((function e(t,r,i,n,a,s,o){var u,h,c,f,v,p,d;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t,h=i.message.tileKey,c=!!this._schema.mesh.sortKey,h!==r.key.id&&(a=!1),f=(0,y.yw)(i,(function(e){return e.message})),v=(0,y.yw)(i,(function(e){return e.transferList}))||[],p={type:u,addOrUpdate:f,remove:n,clear:!1,end:a,sort:c},d={transferList:(0,y.Wg)(v)||[],signal:o},e.abrupt("return",((0,_.k_)(d),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:h,data:p},d)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,s,o){return e.apply(this,arguments)}}()},{key:"_processFeatures",value:function(){var e=(0,n.Z)(l.mark((function e(t,r,i,n){var a,s,o,u,h,c;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,y.Wi)(r)&&r.hasFeatures){e.next=2;break}return e.abrupt("return",null);case 2:return a={transform:t.transform,hasZ:!1,hasM:!1},s=this._factory,o={viewingMode:"",scale:t.scale},e.next=7,this._matchers.feature;case 7:return u=e.sent,e.next=10,this._matchers.aggregate;case 10:return h=e.sent,(0,_.k_)(n),c=this._getLabelInfos(t,r),e.next=15,s.analyze(r.getCursor(),this._resourceManagerProxy,u,h,a,o);case 15:return(0,_.k_)(n),e.abrupt("return",this._writeFeatureSet(t,r,a,c,s,i));case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"_writeFeatureSet",value:function(e,t,r,i,n,a){for(var s=t.getSize(),o=new q(e.key.id,{features:s,records:s,metrics:0},this._schema.mesh.matcher.stride,a,!0),u={viewingMode:"",scale:e.scale},l=t.getCursor();l.next();)try{var h=l.getDisplayId(),c=(0,y.pC)(i)?i.get(h):null;n.writeCursor(o,l,r,u,e.level,c,this._resourceManagerProxy)}catch(v){}var f=e.tileInfoView.tileInfo.isWrappable;return o.serialize(f)}},{key:"_handleError",value:function(e,t,r){if(!(0,_.D_)(t)){var i={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:r.signal})}}},{key:"_getLabelingSchemaForScale",value:function(e){var t=this._schema.mesh.labels;if((0,y.Wi)(t))return null;if("subtype"===t.type){var r={type:"subtype",classes:{}},i=!1;for(var n in t.classes){var a=t.classes[n].filter((function(t){return fs(t,e.scale)}));i=i||!!a.length,r.classes[n]=a}return i?r:null}var s=t.classes.filter((function(t){return fs(t,e.scale)}));return s.length?{type:"simple",classes:s}:null}},{key:"_getLabels",value:function(e,t){if("subtype"===t.type){var r,i=this.service.subtypeField,n=(0,y.s3)(i,"Expected to find subtype Field"),a=e.readAttribute(n);return null==a?[]:null!=(r=t.classes[a])?r:[]}return t.classes}},{key:"_getLabelInfos",value:function(e,t){var r=this,n=this._getLabelingSchemaForScale(e);if((0,y.Wi)(n))return null;for(var a=new Map,s=t.getCursor(),o=function(){var e,t=s.getDisplayId(),o=[],u=(0,k.nE)(t),l=u&&1!==s.readAttribute("cluster_count")?"aggregate":"feature",h=r._getLabels(s,n),c=(0,i.Z)(h);try{var v=function(){var i=e.value;if(i.target!==l)return"continue";var n=s.getStorage(),a=u&&"feature"===l?n.getComputedStringAtIndex(s.readAttribute("referenceId"),i.fieldIndex):n.getComputedStringAtIndex(t,i.fieldIndex);if(!a)return"continue";var h=f(a.toString()),c=h[0],v=h[1];r._store.getMosaicItem(i.symbol,ya(c)).then((function(e){o[i.index]={glyphs:e.glyphMosaicItems,rtl:v,index:i.index}}))};for(c.s();!(e=c.n()).done;)v()}catch(p){c.e(p)}finally{c.f()}a.set(t,o)};s.next();)o();return a}}]),r}(hs.Z),ds=ps=(0,h._)([(0,m.j)("esri.views.2d.layers.features.processors.SymbolProcessor")],ps)},35092:function(e,t,r){r.d(t,{M:function(){return i}});r(67906);function i(e,t,r,i){var n=e.clone(),a=1<<n.level,s=n.col+t,o=n.row+r;return i&&s<0?(n.col=s+a,n.world-=1):s>=a?(n.col=s-a,n.world+=1):n.col=s,n.row=o,n}}}]);
//# sourceMappingURL=0.46ca72de.chunk.js.map